<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="“大实例”重构" href="app-overview.html" /><link rel="prev" title="内部的 worker" href="worker.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>消息协议 - Celery 5.5.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=3ee1c6c6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/my.css?v=112ca36d" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Celery 5.5.1 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/celery_512_1.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Celery 5.5.1 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">版权</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting-started/index.html">快速开始</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 快速开始</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/introduction.html">Celery 简介</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../getting-started/backends-and-brokers/index.html">Backends 和 Brokers</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Backends 和 Brokers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/rabbitmq.html">使用 RabbitMQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/redis.html">使用 Redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/sqs.html">使用 Amazon SQS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/kafka.html">使用 Kafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/gcpubsub.html">使用 Google Pub/Sub</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/first-steps-with-celery.html">使用 Celery 的第一步</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/next-steps.html">下一步</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/resources.html">资源</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../userguide/index.html">用户指南</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 用户指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../userguide/application.html">应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/tasks.html">任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/calling.html">调用任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/canvas.html">Canvas：设计工作流</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/workers.html">Workers 指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/daemonizing.html">守护进程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/periodic-tasks.html">周期性任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/routing.html">路由任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/monitoring.html">监控和管理指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/security.html">安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/optimizing.html">优化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/debugging.html">调试</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../userguide/concurrency/index.html">并发</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 并发</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/concurrency/eventlet.html">Eventlet 并发</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/concurrency/gevent.html">gevent 并发</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/signals.html">信号</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/testing.html">使用 Celery 进行测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/extending.html">扩展 和 Bootsteps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/configuration.html">配置和默认值</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/sphinx.html">使用 Sphinx 文档化任务</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../django/index.html">Django</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Django</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../django/first-steps-with-django.html">使用 Django 的第一步</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">社区资源</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">教程</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/task-cookbook.html">Task Cookbook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">更改历史</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API 参考</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API 参考</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli.html">命令行接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery</span></code> --- Distributed processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.html">Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.task.html"><code class="docutils literal notranslate"><span class="pre">celery.app.task</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.amqp.html">AMQP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.amqp.html#queues">Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.defaults.html"><code class="docutils literal notranslate"><span class="pre">celery.app.defaults</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.control.html"><code class="docutils literal notranslate"><span class="pre">celery.app.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.registry.html"><code class="docutils literal notranslate"><span class="pre">celery.app.registry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.backends.html"><code class="docutils literal notranslate"><span class="pre">celery.app.backends</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.builtins.html"><code class="docutils literal notranslate"><span class="pre">celery.app.builtins</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.events.html"><code class="docutils literal notranslate"><span class="pre">celery.app.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.log.html"><code class="docutils literal notranslate"><span class="pre">celery.app.log</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.app.utils</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.autoretry.html"><code class="docutils literal notranslate"><span class="pre">celery.app.autoretry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bootsteps.html"><code class="docutils literal notranslate"><span class="pre">celery.bootsteps</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.result.html"><code class="docutils literal notranslate"><span class="pre">celery.result</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.schedules.html"><code class="docutils literal notranslate"><span class="pre">celery.schedules</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.signals.html"><code class="docutils literal notranslate"><span class="pre">celery.signals</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.security.html"><code class="docutils literal notranslate"><span class="pre">celery.security</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.utils.debug.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.debug</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.exceptions.html"><code class="docutils literal notranslate"><span class="pre">celery.exceptions</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.app.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.app</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.default.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.default</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.base.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.base</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html">States</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#sets">Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#misc">Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.FAILURE"><code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.PENDING"><code class="docutils literal notranslate"><span class="pre">PENDING</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.RECEIVED"><code class="docutils literal notranslate"><span class="pre">RECEIVED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.RETRY"><code class="docutils literal notranslate"><span class="pre">RETRY</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.REVOKED"><code class="docutils literal notranslate"><span class="pre">REVOKED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.STARTED"><code class="docutils literal notranslate"><span class="pre">STARTED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.SUCCESS"><code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.precedence"><code class="docutils literal notranslate"><span class="pre">precedence()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.state"><code class="docutils literal notranslate"><span class="pre">state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.abortable.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.abortable</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.django.task.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.django.task</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.migrate.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.migrate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.pytest.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.pytest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.sphinx.html">celery.contrib.sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.app.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.app</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.manager.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.manager</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.mocks.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.mocks</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.rdb.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.rdb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.html"><code class="docutils literal notranslate"><span class="pre">celery.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.receiver.html"><code class="docutils literal notranslate"><span class="pre">celery.events.receiver</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.dispatcher.html"><code class="docutils literal notranslate"><span class="pre">celery.events.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.event.html"><code class="docutils literal notranslate"><span class="pre">celery.events.event</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.state.html"><code class="docutils literal notranslate"><span class="pre">celery.events.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.apps.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.apps.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.apps.multi.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.multi</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.request.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.request</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.state.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.strategy.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.strategy</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.agent.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.agent</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.connection.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.connection</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.consumer.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.consumer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.control.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.events.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.gossip.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.gossip</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.heart.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.heart</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.mingle.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.mingle</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.tasks.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.tasks</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.base.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.base</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.celery.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.celery</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.events.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.logtool.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.logtool</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.amqp.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.amqp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.graph.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.graph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.multi.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.multi</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.call.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.call</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.control.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.list.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.list</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.migrate.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.migrate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.purge.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.purge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.result.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.result</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.shell.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.shell</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.upgrade.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.upgrade</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">内部</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="guide.html">代码贡献指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecation.html">Celery 弃用时间表</a></li>
<li class="toctree-l2"><a class="reference internal" href="worker.html">内部的 worker</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">消息协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="app-overview.html">“大实例”重构</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="reference/index.html">内部模块参考</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 内部模块参考</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.worker.components.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.components</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.worker.loops.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.loops</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.worker.heartbeat.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.heartbeat</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.worker.control.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.control</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.worker.pidbox.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.pidbox</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.worker.autoscale.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.autoscale</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.solo.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.solo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.prefork.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.prefork</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.eventlet.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.eventlet</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.gevent.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.gevent</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.thread.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.thread</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.concurrency.base.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.html"><code class="docutils literal notranslate"><span class="pre">celery.backends</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.base.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.asynchronous.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.asynchronous</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.azureblockblob.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.azureblockblob</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.rpc.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.rpc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.database.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.cache.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cache</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.consul.html">celery.backends.consul</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.couchdb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.couchdb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.mongodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.mongodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.elasticsearch.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.elasticsearch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.redis.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.redis</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.cassandra.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cassandra</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.couchbase.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.couchbase</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.arangodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.arangodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.dynamodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.dynamodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.filesystem.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.filesystem</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.cosmosdbsql.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cosmosdbsql</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.s3.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.s3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.gcs.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.gcs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.app.trace.html"><code class="docutils literal notranslate"><span class="pre">celery.app.trace</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.app.annotations.html"><code class="docutils literal notranslate"><span class="pre">celery.app.annotations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.app.routes.html"><code class="docutils literal notranslate"><span class="pre">celery.app.routes</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.security.certificate.html"><code class="docutils literal notranslate"><span class="pre">celery.security.certificate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.security.key.html"><code class="docutils literal notranslate"><span class="pre">celery.security.key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.security.serialization.html"><code class="docutils literal notranslate"><span class="pre">celery.security.serialization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.security.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.security.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.events.snapshot.html"><code class="docutils literal notranslate"><span class="pre">celery.events.snapshot</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.events.cursesmon.html"><code class="docutils literal notranslate"><span class="pre">celery.events.cursesmon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.events.dumper.html"><code class="docutils literal notranslate"><span class="pre">celery.events.dumper</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.database.models.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database.models</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.backends.database.session.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database.session</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.abstract.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.abstract</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.collections.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.collections</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.nodenames.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.nodenames</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.deprecated.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.functional.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.functional</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.graph.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.graph</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.objects.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.objects</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.term.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.term</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.time.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.iso8601.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.iso8601</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.saferepr.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.saferepr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.serialization.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.serialization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.sysinfo.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.sysinfo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.threads.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.threads</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.timer2.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.timer2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.imports.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.imports</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.log.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.text.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.text</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.dispatch.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.dispatch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.utils.dispatch.signal.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.dispatch.signal</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery.platforms.html"><code class="docutils literal notranslate"><span class="pre">celery.platforms</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/celery._state.html"><code class="docutils literal notranslate"><span class="pre">celery._state</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../history/index.html">历史</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 历史</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-5.5.html">What's new in Celery 5.5 (Immunity)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-5.5.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-5.4.html">What's new in Celery 5.4 (Opalescent)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-5.4.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-5.3.html">What's new in Celery 5.3 (Emerald Rush)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-5.3.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-5.1.html">What's new in Celery 5.1 (Sun Harmonics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-5.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-5.0.html">What's new in Celery 5.0 (singularity)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-5.0.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-4.4.html">What's new in Celery 4.4 (Cliffs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-4.4.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-4.3.html">What's new in Celery 4.3 (rhubarb)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-4.3.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-4.2.html">What's new in Celery 4.2 (windowlicker)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-4.2.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-4.1.html">What's new in Celery 4.1 (latentcall)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-4.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-4.0.html">What's new in Celery 4.0 (latentcall)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-4.0.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-3.1.html">What's new in Celery 3.1 (Cipater)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-3.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-3.0.html">What's new in Celery 3.0 (Chiastic Slide)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-3.0.html">Change history for Celery 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/whatsnew-2.5.html">What's new in Celery 2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-2.5.html">Change history for Celery 2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-2.4.html">Change history for Celery 2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-2.3.html">Change history for Celery 2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-2.2.html">Change history for Celery 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-2.1.html">Change history for Celery 2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-2.0.html">Change history for Celery 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/changelog-1.0.html">Change history for Celery 1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语</a></li>
</ul>

</div>
<!-- <iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe> -->
<div id="donate">
  <h5>捐赠</h5>
  <p>请捐赠以支持这个社区项目</p>
  <a href="https://opencollective.com/celery/donate" target="_blank">
    <!-- <img src="https://opencollective.com/celery/donate/button@2x.png?color=blue" /> -->
    <img src="https://opencollective.com/celery/donate/button.png?color=blue" />
  </a>
</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/internals/protocol.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="message-protocol">
<span id="id1"></span><h1>消息协议<a class="headerlink" href="#message-protocol" title="Link to this heading">¶</a></h1>
<p>Message Protocol</p>
<section id="task">
<span id="internals-task-message-protocol"></span><span id="message-protocol-task"></span><h2>Task 消息<a class="headerlink" href="#task" title="Link to this heading">¶</a></h2>
<p>Task messages</p>
<section id="message-protocol-task-v2">
<span id="id2"></span><h3>版本 2<a class="headerlink" href="#message-protocol-task-v2" title="Link to this heading">¶</a></h3>
<p>Version 2</p>
<section id="id3">
<h4>定义<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<p>Definition</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;correlation_id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">task_id</span><span class="p">,</span>
    <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">mimetype</span><span class="p">,</span>
    <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">encoding</span><span class="p">,</span>

    <span class="c1"># optional</span>
    <span class="s1">&#39;reply_to&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">queue_or_url</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="s1">&#39;py&#39;</span>
    <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">task</span><span class="p">,</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">task_id</span><span class="p">,</span>
    <span class="s1">&#39;root_id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">root_id</span><span class="p">,</span>
    <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">parent_id</span><span class="p">,</span>
    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="n">uuid</span> <span class="n">group_id</span><span class="p">,</span>

    <span class="c1"># optional</span>
    <span class="s1">&#39;meth&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">method_name</span><span class="p">,</span>
    <span class="s1">&#39;shadow&#39;</span><span class="p">:</span> <span class="n">string</span> <span class="n">alias_name</span><span class="p">,</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="n">iso8601</span> <span class="n">ETA</span><span class="p">,</span>
    <span class="s1">&#39;expires&#39;</span><span class="p">:</span> <span class="n">iso8601</span> <span class="n">expires</span><span class="p">,</span>
    <span class="s1">&#39;retries&#39;</span><span class="p">:</span> <span class="nb">int</span> <span class="n">retries</span><span class="p">,</span>
    <span class="s1">&#39;timelimit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">soft</span><span class="p">,</span> <span class="n">hard</span><span class="p">),</span>
    <span class="s1">&#39;argsrepr&#39;</span><span class="p">:</span> <span class="nb">str</span> <span class="nb">repr</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
    <span class="s1">&#39;kwargsrepr&#39;</span><span class="p">:</span> <span class="nb">str</span> <span class="nb">repr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span>
    <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="nb">str</span> <span class="n">nodename</span><span class="p">,</span>
    <span class="s1">&#39;replaced_task_nesting&#39;</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">}</span>

<span class="n">body</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">object</span><span class="p">[]</span> <span class="n">args</span><span class="p">,</span>
    <span class="n">Mapping</span> <span class="n">kwargs</span><span class="p">,</span>
    <span class="n">Mapping</span> <span class="n">embed</span> <span class="p">{</span>
        <span class="s1">&#39;callbacks&#39;</span><span class="p">:</span> <span class="n">Signature</span><span class="p">[]</span> <span class="n">callbacks</span><span class="p">,</span>
        <span class="s1">&#39;errbacks&#39;</span><span class="p">:</span> <span class="n">Signature</span><span class="p">[]</span> <span class="n">errbacks</span><span class="p">,</span>
        <span class="s1">&#39;chain&#39;</span><span class="p">:</span> <span class="n">Signature</span><span class="p">[]</span> <span class="n">chain</span><span class="p">,</span>
        <span class="s1">&#39;chord&#39;</span><span class="p">:</span> <span class="n">Signature</span> <span class="n">chord_callback</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h4>示例<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<p>Example</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>此示例使用协议版本 2 发送任务消息：</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>This example sends a task message using version 2 of the protocol:</p>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># chain: add(add(add(2, 2), 4), 8) == 2 + 2 + 4 + 8</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>

<span class="n">task_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">()</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">basic_publish</span><span class="p">(</span>
    <span class="n">message</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
    <span class="n">application_headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;py&#39;</span><span class="p">,</span>
        <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;proj.tasks.add&#39;</span><span class="p">,</span>
        <span class="s1">&#39;argsrepr&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
        <span class="s1">&#39;kwargsrepr&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;@&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()])</span>
    <span class="p">}</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;correlation_id&#39;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span>
        <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h4>与版本 1 的变更<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<p>Changes from version 1</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<ul>
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">task</span></code> 消息头检测协议版本。</p></li>
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">lang</span></code> 消息头支持多语言。
Worker 可以将消息重定向给支持该语言的其他 worker。</p></li>
<li><p>元数据迁移至消息头（headers）。
这意味着 worker 或中间件可以在不解码消息主体（payload）的情况下
基于消息头内容做出决策，例如 payload 使用了 Python 特有的 pickle 序列化方式。</p></li>
<li><p>始终使用 UTC 时间
不再使用 <code class="docutils literal notranslate"><span class="pre">utc</span></code> 标志，因此任何缺失时区信息的时间值将被视为 UTC 时间。</p></li>
<li><p>消息体（body）仅用于语言相关的数据。
- Python 将 args/kwargs 和嵌入的签名存储于消息体中。
- 如果消息使用原始编码（raw encoding），则原始数据会作为单一参数传递给函数。
- Java/C 等语言可以使用 Thrift/protobuf 文档作为消息体内容。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">origin</span></code> 表示发送任务的节点名称。</p></li>
<li><p>基于 <code class="docutils literal notranslate"><span class="pre">task</span></code> 与 <code class="docutils literal notranslate"><span class="pre">meth</span></code> 消息头分发给对应 actor。
<code class="docutils literal notranslate"><span class="pre">meth</span></code> 在 Python 中未使用，但将来可能用于指定类+方法对。</p></li>
<li><p>Chain（链式调用）获得了专用字段。
之前将 chain 递归地嵌套在 <code class="docutils literal notranslate"><span class="pre">callbacks</span></code> 参数中，
会在递归层级过深时导致问题。</p>
<p>新消息协议通过指定一个签名列表来解决此问题，
每个任务在发送下一个消息时从列表中弹出一个签名：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">execute_task</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">embed</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">chain</span><span class="p">:</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">maybe_signature</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
    <span class="n">sig</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">correlation_id</span></code> 替代了原先的 <code class="docutils literal notranslate"><span class="pre">task_id</span></code> 字段。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_id</span></code> 和 <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> 字段用于追踪完整的工作流链路。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shadow</span></code> 允许为日志指定不同的任务名称，
监控工具可用于表示某些以函数作为参数调用的任务概念：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.utils.imports</span><span class="w"> </span><span class="kn">import</span> <span class="n">qualname</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PickleTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unpack_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">return</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">fun</span><span class="p">,</span> <span class="n">real_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span>
            <span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">real_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="n">qualname</span><span class="p">(</span><span class="n">fun</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span>
        <span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">PickleTask</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<ul>
<li><p>Protocol version detected by the presence of a <code class="docutils literal notranslate"><span class="pre">task</span></code> message header.</p></li>
<li><dl class="simple">
<dt>Support for multiple languages via the <code class="docutils literal notranslate"><span class="pre">lang</span></code> header.</dt><dd><p>Worker may redirect the message to a worker that supports
the language.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Meta-data moved to headers.</dt><dd><p>This means that workers/intermediates can inspect the message
and make decisions based on the headers without decoding
the payload (that may be language specific, for example serialized by the
Python specific pickle serializer).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Always UTC</dt><dd><p>There's no <code class="docutils literal notranslate"><span class="pre">utc</span></code> flag anymore, so any time information missing timezone
will be expected to be in UTC time.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Body is only for language specific data.</dt><dd><ul class="simple">
<li><p>Python stores args/kwargs and embedded signatures in body.</p></li>
<li><p>If a message uses raw encoding then the raw data</p></li>
</ul>
<p>will be passed as a single argument to the function.</p>
<ul class="simple">
<li><p>Java/C, etc. can use a Thrift/protobuf document as the body</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">origin</span></code> is the name of the node sending the task.</p></li>
<li><dl class="simple">
<dt>Dispatches to actor based on <code class="docutils literal notranslate"><span class="pre">task</span></code>, <code class="docutils literal notranslate"><span class="pre">meth</span></code> headers</dt><dd><p><code class="docutils literal notranslate"><span class="pre">meth</span></code> is unused by Python, but may be used in the future
to specify class+method pairs.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Chain gains a dedicated field.</dt><dd><p>Reducing the chain into a recursive <code class="docutils literal notranslate"><span class="pre">callbacks</span></code> argument
causes problems when the recursion limit is exceeded.</p>
<p>This is fixed in the new message protocol by specifying
a list of signatures, each task will then pop a task off the list
when sending the next message:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">execute_task</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">embed</span><span class="p">[</span><span class="s1">&#39;chain&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">chain</span><span class="p">:</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">maybe_signature</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
    <span class="n">sig</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">correlation_id</span></code> replaces <code class="docutils literal notranslate"><span class="pre">task_id</span></code> field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_id</span></code> and <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> fields helps keep track of work-flows.</p></li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">shadow</span></code> lets you specify a different name for logs, monitors can be used for concepts like tasks that calls a function specified as argument:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.utils.imports</span><span class="w"> </span><span class="kn">import</span> <span class="n">qualname</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PickleTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unpack_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">return</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">fun</span><span class="p">,</span> <span class="n">real_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span>
            <span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">real_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="n">qualname</span><span class="p">(</span><span class="n">fun</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span>
        <span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">PickleTask</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
</section>
<section id="task-message-protocol-v1">
<span id="message-protocol-task-v1"></span><span id="id6"></span><h3>版本 1<a class="headerlink" href="#task-message-protocol-v1" title="Link to this heading">¶</a></h3>
<p>Version 1</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>在协议的第 1 版中，所有字段都存储在消息体中：
这意味着 worker 和中间消费者必须反序列化 payload 才能读取字段内容。</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>In version 1 of the protocol all fields are stored in the message body:
meaning workers and intermediate consumers must deserialize the payload
to read the fields.</p>
</div>
</div>
<section id="id7">
<h4>消息正文<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<p>Message body</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<ul>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">task</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>任务名称。<strong>必需</strong></p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>任务的唯一标识（UUID）。<strong>必需</strong></p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">args</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>list</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>参数列表。如果未提供则为一个空列表。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">kwargs</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>dictionary</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>关键字参数字典。如果未提供则为一个空字典。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">retries</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>int</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>当前任务已重试的次数。如果未指定则默认为 <cite>0</cite>。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">eta</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite> (ISO 8601)<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>预计到达时间，采用 ISO 8601 格式的日期和时间。
如果未提供，该消息不会被调度，而是尽快执行。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">expires</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite> (ISO 8601)<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.0.2.</span></p>
</div>
<p>过期时间，采用 ISO 8601 格式的日期和时间。
如果未提供，该消息将永不过期。
当消息被接收时若已超出过期时间，则该消息将被视为已过期。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">taskset</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>此任务所属的任务组（如果有）。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">chord</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>Signature</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.3.</span></p>
</div>
<p>表示该任务是 chord 的 header 部分之一。
该字段的值是 chord 的 body，
它将在所有 header 中的任务完成后被执行。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">utc</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>bool</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.5.</span></p>
</div>
<p>若为 true，则时间使用 UTC 时区；否则应使用当前本地时区。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">callbacks</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>&lt;list&gt;Signature</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.0.</span></p>
</div>
<p>当任务成功完成时将调用的签名列表。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">errbacks</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>&lt;list&gt;Signature</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.0.</span></p>
</div>
<p>当任务执行出错时将调用的签名列表。</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">timelimit</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>&lt;tuple&gt;(float, float)</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.1.</span></p>
</div>
<p>任务执行时间限制配置。此字段是一个包含软/硬超时的元组
（可为 <cite>int</cite>/<cite>float</cite>，或使用 <code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code> 表示不限制）。</p>
<p>以下示例表示软时间限制为 3 秒，硬时间限制为 10 秒:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;timelimit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<ul>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">task</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Name of the task. <strong>required</strong></p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Unique id of the task (UUID). <strong>required</strong></p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">args</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>list</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>List of arguments. Will be an empty list if not provided.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">kwargs</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>dictionary</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Dictionary of keyword arguments. Will be an empty dictionary if not
provided.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">retries</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>int</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Current number of times this task has been retried.
Defaults to <cite>0</cite> if not specified.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">eta</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite> (ISO 8601)<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Estimated time of arrival. This is the date and time in ISO 8601
format. If not provided the message isn't scheduled, but will be
executed asap.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">expires</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite> (ISO 8601)<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.0.2.</span></p>
</div>
<p>Expiration date. This is the date and time in ISO 8601 format.
If not provided the message will never expire. The message
will be expired when the message is received and the expiration date
has been exceeded.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">taskset</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>string</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>The group this task is part of (if any).</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">chord</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>Signature</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.3.</span></p>
</div>
<p>Signifies that this task is one of the header parts of a chord. The value
of this key is the body of the cord that should be executed when all of
the tasks in the header has returned.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">utc</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>bool</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 2.5.</span></p>
</div>
<p>If true time uses the UTC timezone, if not the current local timezone
should be used.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">callbacks</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>&lt;list&gt;Signature</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.0.</span></p>
</div>
<p>A list of signatures to call if the task exited successfully.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">errbacks</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>&lt;list&gt;Signature</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.0.</span></p>
</div>
<p>A list of signatures to call if an error occurs while executing the task.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">timelimit</span></code></dt><dd><dl class="field-list simple">
<dt class="field-odd"><cite>&lt;tuple&gt;(float, float)</cite><span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 3.1.</span></p>
</div>
<p>Task execution time limit settings. This is a tuple of hard and soft time
limit value (<cite>int</cite>/<cite>float</cite> or <code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code> for no limit).</p>
<p>Example value specifying a soft time limit of 3 seconds, and a hard time
limit of 10 seconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;timelimit&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
<section id="id8">
<h4>示例消息<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h4>
<p>Example message</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>以下是以 JSON 格式调用 <cite>celery.task.ping</cite> 任务的示例：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;4cc7438e-afd4-4f8f-a2f3-f46567e7ca77&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;task&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;celery.task.PingTask&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;args&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w"> </span><span class="s2">&quot;kwargs&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w"> </span><span class="s2">&quot;retries&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;eta&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2009-11-17T12:30:56.527191&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>This is an example invocation of a <cite>celery.task.ping</cite> task in json
format:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;4cc7438e-afd4-4f8f-a2f3-f46567e7ca77&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;task&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;celery.task.PingTask&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;args&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w"> </span><span class="s2">&quot;kwargs&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w"> </span><span class="s2">&quot;retries&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;eta&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2009-11-17T12:30:56.527191&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id9">
<h3>任务序列化<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p>Task Serialization</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>使用 <cite>content_type</cite> 消息头支持多种类型的序列化格式。</p>
<p>默认支持的 MIME 类型如下表所示：</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>MIME 类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>json</p></td>
<td><p>application/json</p></td>
</tr>
<tr class="row-odd"><td><p>yaml</p></td>
<td><p>application/x-yaml</p></td>
</tr>
<tr class="row-even"><td><p>pickle</p></td>
<td><p>application/x-python-serialize</p></td>
</tr>
<tr class="row-odd"><td><p>msgpack</p></td>
<td><p>application/x-msgpack</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>Several types of serialization formats are supported using the
<cite>content_type</cite> message header.</p>
<p>The MIME-types supported by default are shown in the following table.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Scheme</p></th>
<th class="head"><p>MIME Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>json</p></td>
<td><p>application/json</p></td>
</tr>
<tr class="row-odd"><td><p>yaml</p></td>
<td><p>application/x-yaml</p></td>
</tr>
<tr class="row-even"><td><p>pickle</p></td>
<td><p>application/x-python-serialize</p></td>
</tr>
<tr class="row-odd"><td><p>msgpack</p></td>
<td><p>application/x-msgpack</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="event">
<span id="message-protocol-event"></span><h2>Event 消息<a class="headerlink" href="#event" title="Link to this heading">¶</a></h2>
<p>Event Messages</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p>事件消息始终使用 JSON 进行序列化，并可包含任意的消息体字段。</p>
<p>自 4.0 版本起，消息体可以是单个映射（单个事件），也可以是映射列表（多个事件）。</p>
<p>此外，事件消息中还必须包含一些标准字段：</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>Event messages are always JSON serialized and can contain arbitrary message
body fields.</p>
<p>Since version 4.0. the body can consist of either a single mapping (one event),
or a list of mappings (multiple events).</p>
<p>There are also standard fields that must always be present in an event
message:</p>
</div>
</div>
<section id="id10">
<h3>标准正文字段<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>Standard body fields</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<ul class="simple">
<li><dl class="simple">
<dt><em>string</em> <code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>事件类型。该字段是一个字符串，包含 <em>类别</em> 与 <em>动作</em>，
两者之间以连字符分隔（例如：<code class="docutils literal notranslate"><span class="pre">task-succeeded</span></code>）。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>string</em> <code class="docutils literal notranslate"><span class="pre">hostname</span></code></dt><dd><p>发生事件的完整主机名。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>unsigned long long</em> <code class="docutils literal notranslate"><span class="pre">clock</span></code></dt><dd><p>此事件的逻辑时钟值（Lamport 时间戳）。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>float</em> <code class="docutils literal notranslate"><span class="pre">timestamp</span></code></dt><dd><p>事件发生时对应的 UNIX 时间戳。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>signed short</em> <code class="docutils literal notranslate"><span class="pre">utcoffset</span></code></dt><dd><p>描述事件源主机的时区。该字段表示相对于 UTC 的时差小时数
（例如：-2 或 +1）。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>unsigned long long</em> <code class="docutils literal notranslate"><span class="pre">pid</span></code></dt><dd><p>事件来源进程的进程 ID。</p>
</dd>
</dl>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<ul class="simple">
<li><dl class="simple">
<dt><em>string</em> <code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>The type of event. This is a string containing the <em>category</em> and
<em>action</em> separated by a dash delimiter (e.g., <code class="docutils literal notranslate"><span class="pre">task-succeeded</span></code>).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>string</em> <code class="docutils literal notranslate"><span class="pre">hostname</span></code></dt><dd><p>The fully qualified hostname of where the event occurred at.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>unsigned long long</em> <code class="docutils literal notranslate"><span class="pre">clock</span></code></dt><dd><p>The logical clock value for this event (Lamport time-stamp).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>float</em> <code class="docutils literal notranslate"><span class="pre">timestamp</span></code></dt><dd><p>The UNIX time-stamp corresponding to the time of when the event occurred.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>signed short</em> <code class="docutils literal notranslate"><span class="pre">utcoffset</span></code></dt><dd><p>This field describes the timezone of the originating host, and is
specified as the number of hours ahead of/behind UTC (e.g., -2 or
+1).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>unsigned long long</em> <code class="docutils literal notranslate"><span class="pre">pid</span></code></dt><dd><p>The process id of the process the event originated in.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
<section id="id11">
<h3>标准事件类型<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<p>Standard event types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>有关标准事件类型及其字段的完整列表，请参阅 <a class="reference internal" href="../userguide/monitoring.html#event-reference"><span class="std std-ref">事件参考</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>For a list of standard event types and their fields see the <a class="reference internal" href="../userguide/monitoring.html#event-reference"><span class="std std-ref">事件参考</span></a>.</p>
</div>
</div>
</section>
<section id="id12">
<h3>示例消息<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<p>Example message</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>以下是 <code class="docutils literal notranslate"><span class="pre">task-succeeded</span></code> 事件的消息字段示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;routing_key&#39;</span><span class="p">:</span> <span class="s1">&#39;task.succeeded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="s1">&#39;celeryev&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delivery_mode&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;worker1@george.vandelay.com&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;task-succeeded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;worker1@george.vandelay.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="mi">6335</span><span class="p">,</span>
    <span class="s1">&#39;clock&#39;</span><span class="p">:</span> <span class="mi">393912923921</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mf">1401717709.101747</span><span class="p">,</span>
    <span class="s1">&#39;utcoffset&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;9011d855-fdd1-4f8f-adb3-a413b499eafb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;retval&#39;</span><span class="p">:</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="mf">0.0003212</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>This is the message fields for a <code class="docutils literal notranslate"><span class="pre">task-succeeded</span></code> event:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;routing_key&#39;</span><span class="p">:</span> <span class="s1">&#39;task.succeeded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="s1">&#39;celeryev&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delivery_mode&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;worker1@george.vandelay.com&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;task-succeeded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;worker1@george.vandelay.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="mi">6335</span><span class="p">,</span>
    <span class="s1">&#39;clock&#39;</span><span class="p">:</span> <span class="mi">393912923921</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mf">1401717709.101747</span><span class="p">,</span>
    <span class="s1">&#39;utcoffset&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;9011d855-fdd1-4f8f-adb3-a413b499eafb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;retval&#39;</span><span class="p">:</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;runtime&#39;</span><span class="p">:</span> <span class="mf">0.0003212</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="app-overview.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">“大实例”重构</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="worker.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">内部的 worker</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2009-2023, Ask Solem &amp; contributors
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">消息协议</a><ul>
<li><a class="reference internal" href="#task">Task 消息</a><ul>
<li><a class="reference internal" href="#message-protocol-task-v2">版本 2</a><ul>
<li><a class="reference internal" href="#id3">定义</a></li>
<li><a class="reference internal" href="#id4">示例</a></li>
<li><a class="reference internal" href="#id5">与版本 1 的变更</a></li>
</ul>
</li>
<li><a class="reference internal" href="#task-message-protocol-v1">版本 1</a><ul>
<li><a class="reference internal" href="#id7">消息正文</a></li>
<li><a class="reference internal" href="#id8">示例消息</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9">任务序列化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#event">Event 消息</a><ul>
<li><a class="reference internal" href="#id10">标准正文字段</a></li>
<li><a class="reference internal" href="#id11">标准事件类型</a></li>
<li><a class="reference internal" href="#id12">示例消息</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=8156d91f"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=5eb1bb1e"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>