<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="Change history" href="changelog-4.0.html" /><link rel="prev" title="Change history" href="changelog-4.1.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>What&#39;s new in Celery 4.0 (latentcall) - Celery 5.5.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=3ee1c6c6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/my.css?v=112ca36d" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Celery 5.5.1 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/celery_512_1.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Celery 5.5.1 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">版权</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting-started/index.html">快速开始</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 快速开始</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/introduction.html">Celery 简介</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../getting-started/backends-and-brokers/index.html">Backends 和 Brokers</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Backends 和 Brokers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/rabbitmq.html">使用 RabbitMQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/redis.html">使用 Redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/sqs.html">使用 Amazon SQS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/kafka.html">使用 Kafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/backends-and-brokers/gcpubsub.html">使用 Google Pub/Sub</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/first-steps-with-celery.html">使用 Celery 的第一步</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/next-steps.html">下一步</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/resources.html">资源</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../userguide/index.html">用户指南</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 用户指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../userguide/application.html">应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/tasks.html">任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/calling.html">调用任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/canvas.html">Canvas：设计工作流</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/workers.html">Workers 指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/daemonizing.html">守护进程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/periodic-tasks.html">周期性任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/routing.html">路由任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/monitoring.html">监控和管理指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/security.html">安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/optimizing.html">优化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/debugging.html">调试</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../userguide/concurrency/index.html">并发</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 并发</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/concurrency/eventlet.html">Eventlet 并发</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/concurrency/gevent.html">gevent 并发</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/signals.html">信号</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/testing.html">使用 Celery 进行测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/extending.html">扩展 和 Bootsteps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/configuration.html">配置和默认值</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/sphinx.html">使用 Sphinx 文档化任务</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../django/index.html">Django</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Django</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../django/first-steps-with-django.html">使用 Django 的第一步</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">社区资源</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">教程</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/task-cookbook.html">Task Cookbook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">更改历史</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API 参考</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API 参考</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/cli.html">命令行接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery</span></code> --- Distributed processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.html">Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.task.html"><code class="docutils literal notranslate"><span class="pre">celery.app.task</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.amqp.html">AMQP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.amqp.html#queues">Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.defaults.html"><code class="docutils literal notranslate"><span class="pre">celery.app.defaults</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.control.html"><code class="docutils literal notranslate"><span class="pre">celery.app.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.registry.html"><code class="docutils literal notranslate"><span class="pre">celery.app.registry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.backends.html"><code class="docutils literal notranslate"><span class="pre">celery.app.backends</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.builtins.html"><code class="docutils literal notranslate"><span class="pre">celery.app.builtins</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.events.html"><code class="docutils literal notranslate"><span class="pre">celery.app.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.log.html"><code class="docutils literal notranslate"><span class="pre">celery.app.log</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.app.utils</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.app.autoretry.html"><code class="docutils literal notranslate"><span class="pre">celery.app.autoretry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bootsteps.html"><code class="docutils literal notranslate"><span class="pre">celery.bootsteps</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.result.html"><code class="docutils literal notranslate"><span class="pre">celery.result</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.schedules.html"><code class="docutils literal notranslate"><span class="pre">celery.schedules</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.signals.html"><code class="docutils literal notranslate"><span class="pre">celery.signals</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.security.html"><code class="docutils literal notranslate"><span class="pre">celery.security</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.utils.debug.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.debug</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.exceptions.html"><code class="docutils literal notranslate"><span class="pre">celery.exceptions</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.app.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.app</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.default.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.default</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.loaders.base.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.base</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html">States</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#sets">Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#misc">Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.FAILURE"><code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.PENDING"><code class="docutils literal notranslate"><span class="pre">PENDING</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.RECEIVED"><code class="docutils literal notranslate"><span class="pre">RECEIVED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.RETRY"><code class="docutils literal notranslate"><span class="pre">RETRY</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.REVOKED"><code class="docutils literal notranslate"><span class="pre">REVOKED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.STARTED"><code class="docutils literal notranslate"><span class="pre">STARTED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.SUCCESS"><code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.precedence"><code class="docutils literal notranslate"><span class="pre">precedence()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.states.html#celery.states.state"><code class="docutils literal notranslate"><span class="pre">state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.abortable.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.abortable</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.django.task.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.django.task</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.migrate.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.migrate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.pytest.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.pytest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.sphinx.html">celery.contrib.sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.app.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.app</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.manager.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.manager</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.testing.mocks.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.mocks</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.contrib.rdb.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.rdb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.html"><code class="docutils literal notranslate"><span class="pre">celery.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.receiver.html"><code class="docutils literal notranslate"><span class="pre">celery.events.receiver</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.dispatcher.html"><code class="docutils literal notranslate"><span class="pre">celery.events.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.event.html"><code class="docutils literal notranslate"><span class="pre">celery.events.event</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.events.state.html"><code class="docutils literal notranslate"><span class="pre">celery.events.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.apps.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.apps.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.apps.multi.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.multi</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.request.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.request</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.state.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.strategy.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.strategy</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.agent.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.agent</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.connection.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.connection</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.consumer.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.consumer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.control.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.events.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.gossip.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.gossip</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.heart.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.heart</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.mingle.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.mingle</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.consumer.tasks.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.tasks</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.worker.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.base.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.base</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.celery.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.celery</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.events.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.logtool.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.logtool</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.amqp.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.amqp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.graph.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.graph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.multi.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.multi</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.call.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.call</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.control.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.list.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.list</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.migrate.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.migrate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.purge.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.purge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.result.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.result</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.shell.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.shell</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/celery.bin.upgrade.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.upgrade</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../internals/index.html">内部</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../internals/guide.html">代码贡献指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/deprecation.html">Celery 弃用时间表</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/worker.html">内部的 worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/protocol.html">消息协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/app-overview.html">“大实例”重构</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../internals/reference/index.html">内部模块参考</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 内部模块参考</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.worker.components.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.components</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.worker.loops.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.loops</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.worker.heartbeat.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.heartbeat</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.worker.control.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.control</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.worker.pidbox.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.pidbox</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.worker.autoscale.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.autoscale</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.solo.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.solo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.prefork.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.prefork</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.eventlet.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.eventlet</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.gevent.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.gevent</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.thread.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.thread</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.concurrency.base.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.html"><code class="docutils literal notranslate"><span class="pre">celery.backends</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.base.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.asynchronous.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.asynchronous</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.azureblockblob.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.azureblockblob</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.rpc.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.rpc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.database.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.cache.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cache</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.consul.html">celery.backends.consul</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.couchdb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.couchdb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.mongodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.mongodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.elasticsearch.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.elasticsearch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.redis.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.redis</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.cassandra.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cassandra</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.couchbase.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.couchbase</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.arangodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.arangodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.dynamodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.dynamodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.filesystem.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.filesystem</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.cosmosdbsql.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cosmosdbsql</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.s3.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.s3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.gcs.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.gcs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.app.trace.html"><code class="docutils literal notranslate"><span class="pre">celery.app.trace</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.app.annotations.html"><code class="docutils literal notranslate"><span class="pre">celery.app.annotations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.app.routes.html"><code class="docutils literal notranslate"><span class="pre">celery.app.routes</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.security.certificate.html"><code class="docutils literal notranslate"><span class="pre">celery.security.certificate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.security.key.html"><code class="docutils literal notranslate"><span class="pre">celery.security.key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.security.serialization.html"><code class="docutils literal notranslate"><span class="pre">celery.security.serialization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.security.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.security.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.events.snapshot.html"><code class="docutils literal notranslate"><span class="pre">celery.events.snapshot</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.events.cursesmon.html"><code class="docutils literal notranslate"><span class="pre">celery.events.cursesmon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.events.dumper.html"><code class="docutils literal notranslate"><span class="pre">celery.events.dumper</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.database.models.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database.models</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.backends.database.session.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database.session</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.abstract.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.abstract</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.collections.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.collections</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.nodenames.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.nodenames</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.deprecated.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.functional.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.functional</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.graph.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.graph</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.objects.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.objects</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.term.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.term</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.time.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.iso8601.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.iso8601</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.saferepr.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.saferepr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.serialization.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.serialization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.sysinfo.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.sysinfo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.threads.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.threads</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.timer2.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.timer2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.imports.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.imports</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.log.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.text.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.text</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.dispatch.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.dispatch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.utils.dispatch.signal.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.dispatch.signal</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery.platforms.html"><code class="docutils literal notranslate"><span class="pre">celery.platforms</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals/reference/celery._state.html"><code class="docutils literal notranslate"><span class="pre">celery._state</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">历史</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 历史</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="whatsnew-5.5.html">What's new in Celery 5.5 (Immunity)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-5.5.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-5.4.html">What's new in Celery 5.4 (Opalescent)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-5.4.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-5.3.html">What's new in Celery 5.3 (Emerald Rush)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-5.3.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-5.1.html">What's new in Celery 5.1 (Sun Harmonics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-5.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-5.0.html">What's new in Celery 5.0 (singularity)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-5.0.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-4.4.html">What's new in Celery 4.4 (Cliffs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-4.4.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-4.3.html">What's new in Celery 4.3 (rhubarb)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-4.3.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-4.2.html">What's new in Celery 4.2 (windowlicker)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-4.2.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-4.1.html">What's new in Celery 4.1 (latentcall)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-4.1.html">Change history</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">What's new in Celery 4.0 (latentcall)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-4.0.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-3.1.html">What's new in Celery 3.1 (Cipater)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-3.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-3.0.html">What's new in Celery 3.0 (Chiastic Slide)</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-3.0.html">Change history for Celery 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew-2.5.html">What's new in Celery 2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-2.5.html">Change history for Celery 2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-2.4.html">Change history for Celery 2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-2.3.html">Change history for Celery 2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-2.2.html">Change history for Celery 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-2.1.html">Change history for Celery 2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-2.0.html">Change history for Celery 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog-1.0.html">Change history for Celery 1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语</a></li>
</ul>

</div>
<!-- <iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe> -->
<div id="donate">
  <h5>捐赠</h5>
  <p>请捐赠以支持这个社区项目</p>
  <a href="https://opencollective.com/celery/donate" target="_blank">
    <!-- <img src="https://opencollective.com/celery/donate/button@2x.png?color=blue" /> -->
    <img src="https://opencollective.com/celery/donate/button.png?color=blue" />
  </a>
</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/history/whatsnew-4.0.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="what-s-new-in-celery-4-0-latentcall">
<span id="whatsnew-4-0"></span><h1>What's new in Celery 4.0 (latentcall)<a class="headerlink" href="#what-s-new-in-celery-4-0-latentcall" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Ask Solem (<code class="docutils literal notranslate"><span class="pre">ask</span> <span class="pre">at</span> <span class="pre">celeryproject.org</span></code>)</p>
</dd>
</dl>
<aside class="sidebar">
<p class="sidebar-title">Change history</p>
<p>What's new documents describe the changes in major versions,
we also have a <a class="reference internal" href="../changelog.html#changelog"><span class="std std-ref">更改历史</span></a> that lists the changes in bugfix
releases (0.0.x), while older series are archived under the <a class="reference internal" href="index.html#history"><span class="std std-ref">历史</span></a>
section.</p>
</aside>
<p>Celery is a simple, flexible, and reliable distributed system to
process vast amounts of messages, while providing operations with
the tools required to maintain such a system.</p>
<p>It's a task queue with focus on real-time processing, while also
supporting task scheduling.</p>
<p>Celery has a large and diverse community of users and contributors,
you should come join us <span class="xref std std-ref">on IRC</span>
or <span class="xref std std-ref">our mailing-list</span>.</p>
<p>To read more about Celery you should go read the <a class="reference internal" href="../getting-started/introduction.html#intro"><span class="std std-ref">introduction</span></a>.</p>
<p>While this version is backward compatible with previous versions
it's important that you read the following section.</p>
<p>This version is officially supported on CPython 2.7, 3.4, and 3.5.
and also supported on PyPy.</p>
<aside class="topic">
<p class="topic-title">Table of Contents</p>
<p>Make sure you read the important notes before upgrading to this version.</p>
<dl class="field-list simple">
<dt class="field-odd">depth<span class="colon">:</span></dt>
<dd class="field-odd"><p>3</p>
</dd>
</dl>
</aside>
<section id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Link to this heading">¶</a></h2>
<p>Welcome to Celery 4!</p>
<p>This is a massive release with over two years of changes.
Not only does it come with many new features, but it also fixes
a massive list of bugs, so in many ways you could call it
our &quot;Snow Leopard&quot; release.</p>
<p>The next major version of Celery will support Python 3.5 only, where
we are planning to take advantage of the new asyncio library.</p>
<p>This release would not have been possible without the support
of my employer, <a class="reference external" href="https://robinhood.com">Robinhood</a> (we're hiring!).</p>
<ul class="simple">
<li><p>Ask Solem</p></li>
</ul>
<p>Dedicated to Sebastian &quot;Zeb&quot; Bjørnerud (RIP),
with special thanks to <a class="reference external" href="http://tywilkins.com">Ty Wilkins</a>, for designing our new logo,
all the contributors who help make this happen, and my colleagues
at <a class="reference external" href="https://robinhood.com">Robinhood</a>.</p>
<section id="wall-of-contributors">
<h3>Wall of Contributors<a class="headerlink" href="#wall-of-contributors" title="Link to this heading">¶</a></h3>
<p>Aaron McMillin, Adam Chainz, Adam Renberg, Adriano Martins de Jesus,
Adrien Guinet, Ahmet Demir, Aitor Gómez-Goiri, Alan Justino,
Albert Wang, Alex Koshelev, Alex Rattray, Alex Williams, Alexander Koshelev,
Alexander Lebedev, Alexander Oblovatniy, Alexey Kotlyarov, Ali Bozorgkhan,
Alice Zoë Bevan–McGregor, Allard Hoeve, Alman One, Amir Rustamzadeh,
Andrea Rabbaglietti, Andrea Rosa, Andrei Fokau, Andrew Rodionoff,
Andrew Stewart, Andriy Yurchuk, Aneil Mallavarapu, Areski Belaid,
Armenak Baburyan, Arthur Vuillard, Artyom Koval, Asif Saifuddin Auvi,
Ask Solem, Balthazar Rouberol, Batiste Bieler, Berker Peksag,
Bert Vanderbauwhede, Brendan Smithyman, Brian Bouterse, Bryce Groff,
Cameron Will, ChangBo Guo, Chris Clark, Chris Duryee, Chris Erway,
Chris Harris, Chris Martin, Chillar Anand, Colin McIntosh, Conrad Kramer,
Corey Farwell, Craig Jellick, Cullen Rhodes, Dallas Marlow, Daniel Devine,
Daniel Wallace, Danilo Bargen, Davanum Srinivas, Dave Smith, David Baumgold,
David Harrigan, David Pravec, Dennis Brakhane, Derek Anderson,
Dmitry Dygalo, Dmitry Malinovsky, Dongweiming, Dudás Ádám,
Dustin J. Mitchell, Ed Morley, Edward Betts, Éloi Rivard, Emmanuel Cazenave,
Fahad Siddiqui, Fatih Sucu, Feanil Patel, Federico Ficarelli, Felix Schwarz,
Felix Yan, Fernando Rocha, Flavio Grossi, Frantisek Holop, Gao Jiangmiao,
George Whewell, Gerald Manipon, Gilles Dartiguelongue, Gino Ledesma, Greg Wilbur,
Guillaume Seguin, Hank John, Hogni Gylfason, Ilya Georgievsky,
Ionel Cristian Mărieș, Ivan Larin, James Pulec, Jared Lewis, Jason Veatch,
Jasper Bryant-Greene, Jeff Widman, Jeremy Tillman, Jeremy Zafran,
Jocelyn Delalande, Joe Jevnik, Joe Sanford, John Anderson, John Barham,
John Kirkham, John Whitlock, Jonathan Vanasco, Joshua Harlow, João Ricardo,
Juan Carlos Ferrer, Juan Rossi, Justin Patrin, Kai Groner, Kevin Harvey,
Kevin Richardson, Komu Wairagu, Konstantinos Koukopoulos, Kouhei Maeda,
Kracekumar Ramaraju, Krzysztof Bujniewicz, Latitia M. Haskins, Len Buckens,
Lev Berman, lidongming, Lorenzo Mancini, Lucas Wiman, Luke Pomfrey,
Luyun Xie, Maciej Obuchowski, Manuel Kaufmann, Marat Sharafutdinov,
Marc Sibson, Marcio Ribeiro, Marin Atanasov Nikolov, Mathieu Fenniak,
Mark Parncutt, Mauro Rocco, Maxime Beauchemin, Maxime Vdb, Mher Movsisyan,
Michael Aquilina, Michael Duane Mooring, Michael Permana, Mickaël Penhard,
Mike Attwood, Mitchel Humpherys, Mohamed Abouelsaoud, Morris Tweed, Morton Fox,
Môshe van der Sterre, Nat Williams, Nathan Van Gheem, Nicolas Unravel,
Nik Nyby, Omer Katz, Omer Korner, Ori Hoch, Paul Pearce, Paulo Bu,
Pavlo Kapyshin, Philip Garnero, Pierre Fersing, Piotr Kilczuk,
Piotr Maślanka, Quentin Pradet, Radek Czajka, Raghuram Srinivasan,
Randy Barlow, Raphael Michel, Rémy Léone, Robert Coup, Robert Kolba,
Rockallite Wulf, Rodolfo Carvalho, Roger Hu, Romuald Brunet, Rongze Zhu,
Ross Deane, Ryan Luckie, Rémy Greinhofer, Samuel Giffard, Samuel Jaillet,
Sergey Azovskov, Sergey Tikhonov, Seungha Kim, Simon Peeters,
Spencer E. Olson, Srinivas Garlapati, Stephen Milner, Steve Peak, Steven Sklar,
Stuart Axon, Sukrit Khera, Tadej Janež, Taha Jahangir, Takeshi Kanemoto,
Tayfun Sen, Tewfik Sadaoui, Thomas French, Thomas Grainger, Tomas Machalek,
Tobias Schottdorf, Tocho Tochev, Valentyn Klindukh, Vic Kumar,
Vladimir Bolshakov, Vladimir Gorbunov, Wayne Chang, Wieland Hoffmann,
Wido den Hollander, Wil Langford, Will Thompson, William King, Yury Selivanov,
Vytis Banaitis, Zoran Pavlovic, Xin Li, 許邱翔, <a class="extlink-github_user reference external" href="https://github.com/allenling/">&#64;allenling</a>,
<a class="extlink-github_user reference external" href="https://github.com/alzeih/">&#64;alzeih</a>, <a class="extlink-github_user reference external" href="https://github.com/bastb/">&#64;bastb</a>, <a class="extlink-github_user reference external" href="https://github.com/bee-keeper/">&#64;bee-keeper</a>,
<a class="extlink-github_user reference external" href="https://github.com/ffeast/">&#64;ffeast</a>, <a class="extlink-github_user reference external" href="https://github.com/firefly4268/">&#64;firefly4268</a>,
<a class="extlink-github_user reference external" href="https://github.com/flyingfoxlee/">&#64;flyingfoxlee</a>, <a class="extlink-github_user reference external" href="https://github.com/gdw2/">&#64;gdw2</a>, <a class="extlink-github_user reference external" href="https://github.com/gitaarik/">&#64;gitaarik</a>,
<a class="extlink-github_user reference external" href="https://github.com/hankjin/">&#64;hankjin</a>, <a class="extlink-github_user reference external" href="https://github.com/lvh/">&#64;lvh</a>, <a class="extlink-github_user reference external" href="https://github.com/m-vdb/">&#64;m-vdb</a>,
<a class="extlink-github_user reference external" href="https://github.com/kindule/">&#64;kindule</a>, <a class="extlink-github_user reference external" href="https://github.com/mdk/">&#64;mdk</a>:, <a class="extlink-github_user reference external" href="https://github.com/michael-k/">&#64;michael-k</a>,
<a class="extlink-github_user reference external" href="https://github.com/mozillazg/">&#64;mozillazg</a>, <a class="extlink-github_user reference external" href="https://github.com/nokrik/">&#64;nokrik</a>, <a class="extlink-github_user reference external" href="https://github.com/ocean1/">&#64;ocean1</a>,
<a class="extlink-github_user reference external" href="https://github.com/orlo666/">&#64;orlo666</a>, <a class="extlink-github_user reference external" href="https://github.com/raducc/">&#64;raducc</a>, <a class="extlink-github_user reference external" href="https://github.com/wanglei/">&#64;wanglei</a>,
<a class="extlink-github_user reference external" href="https://github.com/worldexception/">&#64;worldexception</a>, <a class="extlink-github_user reference external" href="https://github.com/xBeAsTx/">&#64;xBeAsTx</a>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This wall was automatically generated from git history,
so sadly it doesn't not include the people who help with more important
things like answering mailing-list questions.</p>
</div>
</section>
</section>
<section id="upgrading-from-celery-3-1">
<h2>Upgrading from Celery 3.1<a class="headerlink" href="#upgrading-from-celery-3-1" title="Link to this heading">¶</a></h2>
<section id="step-1-upgrade-to-celery-3-1-25">
<h3>Step 1: Upgrade to Celery 3.1.25<a class="headerlink" href="#step-1-upgrade-to-celery-3-1-25" title="Link to this heading">¶</a></h3>
<p>If you haven't already, the first step is to upgrade to Celery 3.1.25.</p>
<p>This version adds forward compatibility to the new message protocol,
so that you can incrementally upgrade from 3.1 to 4.0.</p>
<p>Deploy the workers first by upgrading to 3.1.25, this means these
workers can process messages sent by clients using both 3.1 and 4.0.</p>
<p>After the workers are upgraded you can upgrade the clients (e.g. web servers).</p>
</section>
<section id="step-2-update-your-configuration-with-the-new-setting-names">
<h3>Step 2: Update your configuration with the new setting names<a class="headerlink" href="#step-2-update-your-configuration-with-the-new-setting-names" title="Link to this heading">¶</a></h3>
<p>This version radically changes the configuration setting names,
to be more consistent.</p>
<p>The changes are fully backwards compatible, so you have the option to wait
until the old setting names are deprecated, but to ease the transition
we have included a command-line utility that rewrites your settings
automatically.</p>
<p>See <a class="reference internal" href="#v400-upgrade-settings"><span class="std std-ref">Lowercase setting names</span></a> for more information.</p>
</section>
<section id="step-3-read-the-important-notes-in-this-document">
<h3>Step 3: Read the important notes in this document<a class="headerlink" href="#step-3-read-the-important-notes-in-this-document" title="Link to this heading">¶</a></h3>
<p>Make sure you are not affected by any of the important upgrade notes
mentioned in the following section.</p>
<p>An especially important note is that Celery now checks the arguments
you send to a task by matching it to the signature (<a class="reference internal" href="#v400-typing"><span class="std std-ref">Task argument checking</span></a>).</p>
</section>
<section id="step-4-upgrade-to-celery-4-0">
<h3>Step 4: Upgrade to Celery 4.0<a class="headerlink" href="#step-4-upgrade-to-celery-4-0" title="Link to this heading">¶</a></h3>
<p>At this point you can upgrade your workers and clients with the new version.</p>
</section>
</section>
<section id="important-notes">
<span id="v400-important"></span><h2>Important Notes<a class="headerlink" href="#important-notes" title="Link to this heading">¶</a></h2>
<section id="dropped-support-for-python-2-6">
<h3>Dropped support for Python 2.6<a class="headerlink" href="#dropped-support-for-python-2-6" title="Link to this heading">¶</a></h3>
<p>Celery now requires Python 2.7 or later,
and also drops support for Python 3.3 so supported versions are:</p>
<ul class="simple">
<li><p>CPython 2.7</p></li>
<li><p>CPython 3.4</p></li>
<li><p>CPython 3.5</p></li>
<li><p>PyPy 5.4 (<code class="docutils literal notranslate"><span class="pre">pypy2</span></code>)</p></li>
<li><p>PyPy 5.5-alpha (<code class="docutils literal notranslate"><span class="pre">pypy3</span></code>)</p></li>
</ul>
</section>
<section id="last-major-version-to-support-python-2">
<h3>Last major version to support Python 2<a class="headerlink" href="#last-major-version-to-support-python-2" title="Link to this heading">¶</a></h3>
<p>Starting from Celery 5.0 only Python 3.5+ will be supported.</p>
<p>To make sure you're not affected by this change you should pin
the Celery version in your requirements file, either to a specific
version: <code class="docutils literal notranslate"><span class="pre">celery==4.0.0</span></code>, or a range: <code class="docutils literal notranslate"><span class="pre">celery&gt;=4.0,&lt;5.0</span></code>.</p>
<p>Dropping support for Python 2 will enable us to remove massive
amounts of compatibility code, and going with Python 3.5 allows
us to take advantage of typing, async/await, asyncio, and similar
concepts there's no alternative for in older versions.</p>
<p>Celery 4.x will continue to work on Python 2.7, 3.4, 3.5; just as Celery 3.x
still works on Python 2.6.</p>
</section>
<section id="django-support">
<h3>Django support<a class="headerlink" href="#django-support" title="Link to this heading">¶</a></h3>
<p>Celery 4.x requires Django 1.8 or later, but we really recommend
using at least Django 1.9 for the new <code class="docutils literal notranslate"><span class="pre">transaction.on_commit</span></code> feature.</p>
<p>A common problem when calling tasks from Django is when the task is related
to a model change, and you wish to cancel the task if the transaction is
rolled back, or ensure the task is only executed after the changes have been
written to the database.</p>
<p><code class="docutils literal notranslate"><span class="pre">transaction.atomic</span></code> enables you to solve this problem by adding
the task as a callback to be called only when the transaction is committed.</p>
<p>Example usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">transaction</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span><span class="p">,</span> <span class="n">Log</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">send_article_created_notification</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_article</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
        <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c1"># send this task only if the rest of the transaction succeeds.</span>
        <span class="n">transaction</span><span class="o">.</span><span class="n">on_commit</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">send_article_created_notification</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="n">article_id</span><span class="o">=</span><span class="n">article</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">Log</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Log</span><span class="o">.</span><span class="n">ARTICLE_CREATED</span><span class="p">,</span> <span class="n">object_pk</span><span class="o">=</span><span class="n">article</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="removed-features">
<h3>Removed features<a class="headerlink" href="#removed-features" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Microsoft Windows is no longer supported.</p>
<p>The test suite is passing, and Celery seems to be working with Windows,
but we make no guarantees as we are unable to diagnose issues on this
platform.  If you are a company requiring support on this platform,
please get in touch.</p>
</li>
<li><p>Jython is no longer supported.</p></li>
</ul>
<section id="features-removed-for-simplicity">
<h4>Features removed for simplicity<a class="headerlink" href="#features-removed-for-simplicity" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Webhook task machinery (<code class="docutils literal notranslate"><span class="pre">celery.task.http</span></code>) has been removed.</p>
<blockquote>
<div><p>Nowadays it's easy to use the <a class="extlink-pypi reference external" href="https://pypi.org/project/requests/">https://pypi.org/project/requests/</a> module to write
webhook tasks manually. We would love to use requests but we
are simply unable to as there's a very vocal 'anti-dependency'
mob in the Python community</p>
<p>If you need backwards compatibility
you can simply copy + paste the 3.1 version of the module and make sure
it's imported by the worker:
<a class="reference external" href="https://github.com/celery/celery/blob/3.1/celery/task/http.py">https://github.com/celery/celery/blob/3.1/celery/task/http.py</a></p>
</div></blockquote>
</li>
<li><p>Tasks no longer sends error emails.</p>
<blockquote>
<div><p>This also removes support for <code class="docutils literal notranslate"><span class="pre">app.mail_admins</span></code>, and any functionality
related to sending emails.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.contrib.batches</span></code> has been removed.</p>
<blockquote>
<div><p>This was an experimental feature, so not covered by our deprecation
timeline guarantee.</p>
<p>You can copy and pass the existing batches code for use within your projects:
<a class="reference external" href="https://github.com/celery/celery/blob/3.1/celery/contrib/batches.py">https://github.com/celery/celery/blob/3.1/celery/contrib/batches.py</a></p>
</div></blockquote>
</li>
</ul>
</section>
<section id="features-removed-for-lack-of-funding">
<h4>Features removed for lack of funding<a class="headerlink" href="#features-removed-for-lack-of-funding" title="Link to this heading">¶</a></h4>
<p>We announced with the 3.1 release that some transports were
moved to experimental status, and that there'd be no official
support for the transports.</p>
<p>As this subtle hint for the need of funding failed
we've removed them completely, breaking backwards compatibility.</p>
<ul>
<li><p>Using the Django ORM as a broker is no longer supported.</p>
<blockquote>
<div><p>You can still use the Django ORM as a result backend:
see <a class="reference internal" href="../django/first-steps-with-django.html#django-celery-results"><span class="std std-ref">django-celery-results - 使用 Django ORM/Cache 作为结果后端</span></a> section for more information.</p>
</div></blockquote>
</li>
<li><p>Using SQLAlchemy as a broker is no longer supported.</p>
<blockquote>
<div><p>You can still use SQLAlchemy as a result backend.</p>
</div></blockquote>
</li>
<li><p>Using CouchDB as a broker is no longer supported.</p>
<blockquote>
<div><p>You can still use CouchDB as a result backend.</p>
</div></blockquote>
</li>
<li><p>Using IronMQ as a broker is no longer supported.</p></li>
<li><p>Using Beanstalk as a broker is no longer supported.</p></li>
</ul>
<p>In addition some features have been removed completely so that
attempting to use them will raise an exception:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--autoreload</span></code> feature has been removed.</p>
<p>This was an experimental feature, and not covered by our deprecation
timeline guarantee. The flag is removed completely so the worker
will crash at startup when present. Luckily this
flag isn't used in production systems.</p>
</li>
<li><p>The experimental <code class="docutils literal notranslate"><span class="pre">threads</span></code> pool is no longer supported and has been removed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">force_execv</span></code> feature is no longer supported.</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">celery</span> <span class="pre">worker</span></code> command now ignores the <code class="docutils literal notranslate"><span class="pre">--no-execv</span></code>,
<code class="docutils literal notranslate"><span class="pre">--force-execv</span></code>, and the <code class="docutils literal notranslate"><span class="pre">CELERYD_FORCE_EXECV</span></code> setting.</p>
<p>This flag will be removed completely in 5.0 and the worker
will raise an error.</p>
</div></blockquote>
</li>
<li><p>The old legacy &quot;amqp&quot; result backend has been deprecated, and will
be removed in Celery 5.0.</p>
<blockquote>
<div><p>Please use the <code class="docutils literal notranslate"><span class="pre">rpc</span></code> result backend for RPC-style calls, and a
persistent result backend for multi-consumer results.</p>
</div></blockquote>
</li>
</ul>
<p>We think most of these can be fixed without considerable effort, so if you're
interested in getting any of these features back, please get in touch.</p>
<p><strong>Now to the good news</strong>...</p>
</section>
</section>
<section id="new-task-message-protocol">
<h3>New Task Message Protocol<a class="headerlink" href="#new-task-message-protocol" title="Link to this heading">¶</a></h3>
<p>This version introduces a brand new task message protocol,
the first major change to the protocol since the beginning of the project.</p>
<p>The new protocol is enabled by default in this version and since the new
version isn't backwards compatible you have to be careful when upgrading.</p>
<p>The 3.1.25 version was released to add compatibility with the new protocol
so the easiest way to upgrade is to upgrade to that version first, then
upgrade to 4.0 in a second deployment.</p>
<p>If you wish to keep using the old protocol you may also configure
the protocol version number used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">task_protocol</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Read more about the features available in the new protocol in the news
section found later in this document.</p>
</section>
<section id="lowercase-setting-names">
<span id="v400-upgrade-settings"></span><h3>Lowercase setting names<a class="headerlink" href="#lowercase-setting-names" title="Link to this heading">¶</a></h3>
<p>In the pursuit of beauty all settings are now renamed to be in all
lowercase and some setting names have been renamed for consistency.</p>
<p>This change is fully backwards compatible so you can still use the uppercase
setting names, but we would like you to upgrade as soon as possible and
you can do this automatically using the <strong class="program">celery upgrade settings</strong>
command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>upgrade<span class="w"> </span>settings<span class="w"> </span>proj/settings.py
</pre></div>
</div>
<p>This command will modify your module in-place to use the new lower-case
names (if you want uppercase with a &quot;<code class="docutils literal notranslate"><span class="pre">CELERY</span></code>&quot; prefix see block below),
and save a backup in <code class="file docutils literal notranslate"><span class="pre">proj/settings.py.orig</span></code>.</p>
<div class="admonition-for-django-users-and-others-who-want-to-keep-uppercase-names admonition" id="latentcall-django-admonition">
<p class="admonition-title">For Django users and others who want to keep uppercase names</p>
<p>If you're loading Celery configuration from the Django settings module
then you'll want to keep using the uppercase names.</p>
<p>You also want to use a <code class="docutils literal notranslate"><span class="pre">CELERY_</span></code> prefix so that no Celery settings
collide with Django settings used by other apps.</p>
<p>To do this, you'll first need to convert your settings file
to use the new consistent naming scheme, and add the prefix to all
Celery related settings:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>upgrade<span class="w"> </span>settings<span class="w"> </span>proj/settings.py<span class="w"> </span>--django
</pre></div>
</div>
<p>After upgrading the settings file, you need to set the prefix explicitly
in your <code class="docutils literal notranslate"><span class="pre">proj/celery.py</span></code> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="s1">&#39;django.conf:settings&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;CELERY&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can find the most up to date Django Celery integration example
here: <a class="reference internal" href="../django/first-steps-with-django.html#django-first-steps"><span class="std std-ref">使用 Django 的第一步</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This will also add a prefix to settings that didn't previously
have one, for example <code class="docutils literal notranslate"><span class="pre">BROKER_URL</span></code> should be written
<code class="docutils literal notranslate"><span class="pre">CELERY_BROKER_URL</span></code> with a namespace of <code class="docutils literal notranslate"><span class="pre">CELERY</span></code>
<code class="docutils literal notranslate"><span class="pre">CELERY_BROKER_URL</span></code>.</p>
</div>
<p>Luckily you don't have to manually change the files, as
the <strong class="program">celery upgrade settings --django</strong> program should do the
right thing.</p>
</div>
<p>The loader will try to detect if your configuration is using the new format,
and act accordingly, but this also means you're not allowed to mix and
match new and old setting names, that's unless you provide a value for both
alternatives.</p>
<p>The major difference between previous versions, apart from the lower case
names, are the renaming of some prefixes, like <code class="docutils literal notranslate"><span class="pre">celerybeat_</span></code> to <code class="docutils literal notranslate"><span class="pre">beat_</span></code>,
<code class="docutils literal notranslate"><span class="pre">celeryd_</span></code> to <code class="docutils literal notranslate"><span class="pre">worker_</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">celery_</span></code> prefix has also been removed, and task related settings
from this name-space is now prefixed by <code class="docutils literal notranslate"><span class="pre">task_</span></code>, worker related settings
with <code class="docutils literal notranslate"><span class="pre">worker_</span></code>.</p>
<p>Apart from this most of the settings will be the same in lowercase, apart from
a few special ones:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Setting name</strong></p></th>
<th class="head"><p><strong>Replace with</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_MAX_CACHED_RESULTS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-result_cache_max"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_cache_max</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_MESSAGE_COMPRESSION</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-result_compression"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_compression</span></code></a>/<a class="reference internal" href="../userguide/configuration.html#std-setting-task_compression"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_compression</span></code></a>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_TASK_RESULT_EXPIRES</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-result_expires"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_expires</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_RESULT_DBURI</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-result_backend"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_backend</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_RESULT_ENGINE_OPTIONS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-database_engine_options"><code class="xref std std-setting docutils literal notranslate"><span class="pre">database_engine_options</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-*-_DB_SHORT_LIVED_SESSIONS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-database_short_lived_sessions"><code class="xref std std-setting docutils literal notranslate"><span class="pre">database_short_lived_sessions</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_RESULT_DB_TABLE_NAMES</span></code></p></td>
<td><p><code class="xref std std-setting docutils literal notranslate"><span class="pre">database_db_names</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_ACKS_LATE</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_acks_late"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_acks_late</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_ALWAYS_EAGER</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_always_eager"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_always_eager</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_ANNOTATIONS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_annotations"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_annotations</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_MESSAGE_COMPRESSION</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_compression"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_compression</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_CREATE_MISSING_QUEUES</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_create_missing_queues"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_create_missing_queues</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DEFAULT_DELIVERY_MODE</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_delivery_mode"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_delivery_mode</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DEFAULT_EXCHANGE</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_exchange"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_exchange</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DEFAULT_EXCHANGE_TYPE</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_exchange_type"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_exchange_type</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DEFAULT_QUEUE</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_queue"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_queue</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DEFAULT_RATE_LIMIT</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_rate_limit"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_rate_limit</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DEFAULT_ROUTING_KEY</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_routing_key"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_routing_key</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-&quot;-_EAGER_PROPAGATES_EXCEPTIONS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_eager_propagates"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_eager_propagates</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_IGNORE_RESULT</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_ignore_result"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_ignore_result</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_TASK_PUBLISH_RETRY</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_publish_retry"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_publish_retry</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_TASK_PUBLISH_RETRY_POLICY</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_publish_retry_policy"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_publish_retry_policy</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_QUEUES</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_queues"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_queues</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_ROUTES</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_routes"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_routes</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_SEND_TASK_SENT_EVENT</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_send_sent_event"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_send_sent_event</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_TASK_SERIALIZER</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_serializer"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_serializer</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYD_TASK_SOFT_TIME_LIMIT</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_soft_time_limit"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_soft_time_limit</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYD_TASK_TIME_LIMIT</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_time_limit"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_time_limit</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_TRACK_STARTED</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-task_track_started"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_track_started</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_DISABLE_RATE_LIMITS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-worker_disable_rate_limits"><code class="xref std std-setting docutils literal notranslate"><span class="pre">worker_disable_rate_limits</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_ENABLE_REMOTE_CONTROL</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-worker_enable_remote_control"><code class="xref std std-setting docutils literal notranslate"><span class="pre">worker_enable_remote_control</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYD_SEND_EVENTS</span></code></p></td>
<td><p><a class="reference internal" href="../userguide/configuration.html#std-setting-worker_send_task_events"><code class="xref std std-setting docutils literal notranslate"><span class="pre">worker_send_task_events</span></code></a></p></td>
</tr>
</tbody>
</table>
</div>
<p>You can see a full table of the changes in <a class="reference internal" href="../userguide/configuration.html#conf-old-settings-map"><span class="std std-ref">新的小写设置</span></a>.</p>
</section>
<section id="json-is-now-the-default-serializer">
<h3>Json is now the default serializer<a class="headerlink" href="#json-is-now-the-default-serializer" title="Link to this heading">¶</a></h3>
<p>The time has finally come to end the reign of <a class="reference external" href="https://docs.python.org/dev/library/pickle.html#module-pickle" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> as the default
serialization mechanism, and json is the default serializer starting from this
version.</p>
<p>This change was <a class="reference internal" href="whatsnew-3.1.html#last-version-to-enable-pickle"><span class="std std-ref">announced with the release of Celery 3.1</span></a>.</p>
<p>If you're still depending on <a class="reference external" href="https://docs.python.org/dev/library/pickle.html#module-pickle" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> being the default serializer,
then you have to configure your app before upgrading to 4.0:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task_serializer</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
<span class="n">result_serializer</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
<span class="n">accept_content</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pickle&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The Json serializer now also supports some additional types:</p>
<ul>
<li><p><a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.datetime" title="（在 Python v3.15）"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a>, <a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.time" title="（在 Python v3.15）"><code class="xref py py-class docutils literal notranslate"><span class="pre">time</span></code></a>, <a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.date" title="（在 Python v3.15）"><code class="xref py py-class docutils literal notranslate"><span class="pre">date</span></code></a></p>
<blockquote>
<div><p>Converted to json text, in ISO-8601 format.</p>
</div></blockquote>
</li>
<li><p><a class="reference external" href="https://docs.python.org/dev/library/decimal.html#decimal.Decimal" title="（在 Python v3.15）"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decimal</span></code></a></p>
<blockquote>
<div><p>Converted to json text.</p>
</div></blockquote>
</li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">django.utils.functional.Promise</span></code></p>
<blockquote>
<div><p>Django only: Lazy strings used for translation etc., are evaluated
and conversion to a json type is attempted.</p>
</div></blockquote>
</li>
<li><p><a class="reference external" href="https://docs.python.org/dev/library/uuid.html#uuid.UUID" title="（在 Python v3.15）"><code class="xref py py-class docutils literal notranslate"><span class="pre">uuid.UUID</span></code></a></p>
<blockquote>
<div><p>Converted to json text.</p>
</div></blockquote>
</li>
</ul>
<p>You can also define a <code class="docutils literal notranslate"><span class="pre">__json__</span></code> method on your custom classes to support
JSON serialization (must return a json compatible type):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">:</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">address</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__json__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
            <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
            <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="the-task-base-class-no-longer-automatically-register-tasks">
<h3>The Task base class no longer automatically register tasks<a class="headerlink" href="#the-task-base-class-no-longer-automatically-register-tasks" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../reference/celery.app.task.html#celery.app.task.Task" title="celery.app.task.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code></a> class is no longer using a special meta-class
that automatically registers the task in the task registry.</p>
<p>Instead this is now handled by the <a class="reference internal" href="../reference/celery.html#celery.Celery.task" title="celery.Celery.task"><code class="xref py py-class docutils literal notranslate"><span class="pre">app.task</span></code></a> decorators.</p>
<p>If you're still using class based tasks, then you need to register
these manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CustomTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running&#39;</span><span class="p">)</span>
<span class="n">CustomTask</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">register_task</span><span class="p">(</span><span class="n">CustomTask</span><span class="p">())</span>
</pre></div>
</div>
<p>The best practice is to use custom task classes only for overriding
general behavior, and then using the task decorator to realize the task:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">CustomTask</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This change also means that the <code class="docutils literal notranslate"><span class="pre">abstract</span></code> attribute of the task
no longer has any effect.</p>
</section>
<section id="task-argument-checking">
<span id="v400-typing"></span><h3>Task argument checking<a class="headerlink" href="#task-argument-checking" title="Link to this heading">¶</a></h3>
<p>The arguments of the task are now verified when calling the task,
even asynchronously:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="go">&lt;AsyncResult: f59d71ca-1549-43e0-be41-4e8821a83c0c&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;celery/app/task.py&quot;</span>, line <span class="m">376</span>, in <span class="n">delay</span>
<span class="w">    </span><span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
  File <span class="nb">&quot;celery/app/task.py&quot;</span>, line <span class="m">485</span>, in <span class="n">apply_async</span>
<span class="w">    </span><span class="n">check_arguments</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">args</span> <span class="ow">or</span> <span class="p">()),</span> <span class="o">**</span><span class="p">(</span><span class="n">kwargs</span> <span class="ow">or</span> <span class="p">{}))</span>
<span class="gr">TypeError</span>: <span class="n">add() takes exactly 2 arguments (1 given)</span>
</pre></div>
</div>
<p>You can disable the argument checking for any task by setting its
<a class="reference internal" href="../reference/celery.app.task.html#celery.app.task.Task.typing" title="celery.app.task.Task.typing"><code class="xref py py-attr docutils literal notranslate"><span class="pre">typing</span></code></a> attribute to <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">typing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>Or if you would like to disable this completely for all tasks
you can pass <code class="docutils literal notranslate"><span class="pre">strict_typing=False</span></code> when creating the app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">strict_typing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="redis-events-not-backward-compatible">
<h3>Redis Events not backward compatible<a class="headerlink" href="#redis-events-not-backward-compatible" title="Link to this heading">¶</a></h3>
<p>The Redis <code class="docutils literal notranslate"><span class="pre">fanout_patterns</span></code> and <code class="docutils literal notranslate"><span class="pre">fanout_prefix</span></code> transport
options are now enabled by default.</p>
<p>Workers/monitors without these flags enabled won't be able to
see workers with this flag disabled. They can still execute tasks,
but they cannot receive each others monitoring messages.</p>
<p>You can upgrade in a backward compatible manner by first configuring
your 3.1 workers and monitors to enable the settings, before the final
upgrade to 4.0:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BROKER_TRANSPORT_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fanout_patterns&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;fanout_prefix&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="redis-priorities-reversed">
<h3>Redis Priorities Reversed<a class="headerlink" href="#redis-priorities-reversed" title="Link to this heading">¶</a></h3>
<p>Priority 0 is now lowest, 9 is highest.</p>
<p>This change was made to make priority support consistent with how
it works in AMQP.</p>
<p>Contributed by <strong>Alex Koshelev</strong>.</p>
</section>
<section id="django-auto-discover-now-supports-django-app-configurations">
<h3>Django: Auto-discover now supports Django app configurations<a class="headerlink" href="#django-auto-discover-now-supports-django-app-configurations" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">autodiscover_tasks()</span></code> function can now be called without arguments,
and the Django handler will automatically find your installed apps:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">autodiscover_tasks</span><span class="p">()</span>
</pre></div>
</div>
<p>The Django integration <a class="reference internal" href="../django/first-steps-with-django.html#django-first-steps"><span class="std std-ref">example in the documentation</span></a> has been updated to use the argument-less call.</p>
<p>This also ensures compatibility with the new, ehm, <code class="docutils literal notranslate"><span class="pre">AppConfig</span></code> stuff
introduced in recent Django versions.</p>
</section>
<section id="worker-direct-queues-no-longer-use-auto-delete">
<h3>Worker direct queues no longer use auto-delete<a class="headerlink" href="#worker-direct-queues-no-longer-use-auto-delete" title="Link to this heading">¶</a></h3>
<p>Workers/clients running 4.0 will no longer be able to send
worker direct messages to workers running older versions, and vice versa.</p>
<p>If you're relying on worker direct messages you should upgrade
your 3.x workers and clients to use the new routing settings first,
by replacing <a class="reference internal" href="../internals/reference/celery.utils.html#celery.utils.worker_direct" title="celery.utils.worker_direct"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.worker_direct()</span></code></a> with this implementation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">kombu</span><span class="w"> </span><span class="kn">import</span> <span class="n">Exchange</span><span class="p">,</span> <span class="n">Queue</span>

<span class="n">worker_direct_exchange</span> <span class="o">=</span> <span class="n">Exchange</span><span class="p">(</span><span class="s1">&#39;C.dq2&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">worker_direct</span><span class="p">(</span><span class="n">hostname</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Queue</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="si">{hostname}</span><span class="s1">.dq2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostname</span><span class="p">),</span>
        <span class="n">exchange</span><span class="o">=</span><span class="n">worker_direct_exchange</span><span class="p">,</span>
        <span class="n">routing_key</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This feature closed <span class="xref issue">Issue #2492</span>.</p>
</section>
<section id="old-command-line-programs-removed">
<h3>Old command-line programs removed<a class="headerlink" href="#old-command-line-programs-removed" title="Link to this heading">¶</a></h3>
<p>Installing Celery will no longer install the <code class="docutils literal notranslate"><span class="pre">celeryd</span></code>,
<code class="docutils literal notranslate"><span class="pre">celerybeat</span></code> and <code class="docutils literal notranslate"><span class="pre">celeryd-multi</span></code> programs.</p>
<p>This was announced with the release of Celery 3.1, but you may still
have scripts pointing to the old names, so make sure you update these
to use the new umbrella command:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Program</p></th>
<th class="head"><p>New Status</p></th>
<th class="head"><p>Replacement</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">celeryd</span></code></p></td>
<td><p><strong>REMOVED</strong></p></td>
<td><p><strong class="program">celery worker</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">celerybeat</span></code></p></td>
<td><p><strong>REMOVED</strong></p></td>
<td><p><strong class="program">celery beat</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">celeryd-multi</span></code></p></td>
<td><p><strong>REMOVED</strong></p></td>
<td><p><strong class="program">celery multi</strong></p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="news">
<span id="v400-news"></span><h2>News<a class="headerlink" href="#news" title="Link to this heading">¶</a></h2>
<section id="new-protocol-highlights">
<h3>New protocol highlights<a class="headerlink" href="#new-protocol-highlights" title="Link to this heading">¶</a></h3>
<p>The new protocol fixes many problems with the old one, and enables
some long-requested features:</p>
<ul>
<li><p>Most of the data are now sent as message headers, instead of being
serialized with the message body.</p>
<blockquote>
<div><p>In version 1 of the protocol the worker always had to deserialize
the message to be able to read task meta-data like the task id,
name, etc. This also meant that the worker was forced to double-decode
the data, first deserializing the message on receipt, serializing
the message again to send to child process, then finally the child process
deserializes the message again.</p>
<p>Keeping the meta-data fields in the message headers means the worker
doesn't actually have to decode the payload before delivering
the task to the child process, and also that it's now possible
for the worker to reroute a task written in a language different
from Python to a different worker.</p>
</div></blockquote>
</li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">lang</span></code> message header can be used to specify the programming
language the task is written in.</p></li>
<li><p>Worker stores results for internal errors like <code class="docutils literal notranslate"><span class="pre">ContentDisallowed</span></code>,
and other deserialization errors.</p></li>
<li><p>Worker stores results and sends monitoring events for unregistered
task errors.</p></li>
<li><p>Worker calls callbacks/errbacks even when the result is sent by the
parent process (e.g., <code class="xref py py-exc docutils literal notranslate"><span class="pre">WorkerLostError</span></code> when a child process
terminates, deserialization errors, unregistered tasks).</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">origin</span></code> header contains information about the process sending
the task (worker node-name, or PID and host-name information).</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">shadow</span></code> header allows you to modify the task name used in logs.</p>
<blockquote>
<div><p>This is useful for dispatch like patterns, like a task that calls
any function using pickle (don't do this at home):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">Task</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery.utils.imports</span><span class="w"> </span><span class="kn">import</span> <span class="n">qualname</span>

<span class="k">class</span><span class="w"> </span><span class="nc">call_as_task</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shadow_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;call_as_task:</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qualname</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">call_as_task</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">register_task</span><span class="p">(</span><span class="n">call_as_task</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">argsrepr</span></code> and <code class="docutils literal notranslate"><span class="pre">kwargsrepr</span></code> fields contain textual representations
of the task arguments (possibly truncated) for use in logs, monitors, etc.</p>
<blockquote>
<div><p>This means the worker doesn't have to deserialize the message payload
to display the task arguments for informational purposes.</p>
</div></blockquote>
</li>
<li><p>Chains now use a dedicated <code class="docutils literal notranslate"><span class="pre">chain</span></code> field enabling support for chains
of thousands and more tasks.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> and <code class="docutils literal notranslate"><span class="pre">root_id</span></code> headers adds information about
a tasks relationship with other tasks.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parent_id</span></code> is the task id of the task that called this task</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_id</span></code> is the first task in the work-flow.</p></li>
</ul>
<p>These fields can be used to improve monitors like flower to group
related messages together (like chains, groups, chords, complete
work-flows, etc).</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">app.TaskProducer</span></code> replaced by <a class="reference internal" href="../reference/celery.app.amqp.html#celery.app.amqp.AMQP.create_task_message" title="celery.app.amqp.AMQP.create_task_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.amqp.create_task_message()</span></code></a> and
<a class="reference internal" href="../reference/celery.app.amqp.html#celery.app.amqp.AMQP.send_task_message" title="celery.app.amqp.AMQP.send_task_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.amqp.send_task_message()</span></code></a>.</p>
<blockquote>
<div><p>Dividing the responsibilities into creating and sending means that
people who want to send messages using a Python AMQP client directly,
don't have to implement the protocol.</p>
<p>The <a class="reference internal" href="../reference/celery.app.amqp.html#celery.app.amqp.AMQP.create_task_message" title="celery.app.amqp.AMQP.create_task_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.amqp.create_task_message()</span></code></a> method calls either
<code class="xref py py-meth docutils literal notranslate"><span class="pre">app.amqp.as_task_v2()</span></code>, or <code class="xref py py-meth docutils literal notranslate"><span class="pre">app.amqp.as_task_v1()</span></code> depending
on the configured task protocol, and returns a special
<code class="xref py py-class docutils literal notranslate"><span class="pre">task_message</span></code> tuple containing the
headers, properties and body of the task message.</p>
</div></blockquote>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p>The new task protocol is documented in full here:
<a class="reference internal" href="../internals/protocol.html#message-protocol-task-v2"><span class="std std-ref">版本 2</span></a>.</p>
</div>
</section>
<section id="prefork-pool-improvements">
<h3>Prefork Pool Improvements<a class="headerlink" href="#prefork-pool-improvements" title="Link to this heading">¶</a></h3>
<section id="tasks-now-log-from-the-child-process">
<h4>Tasks now log from the child process<a class="headerlink" href="#tasks-now-log-from-the-child-process" title="Link to this heading">¶</a></h4>
<p>Logging of task success/failure now happens from the child process
executing the task.  As a result logging utilities,
like Sentry can get full information about tasks, including
variables in the traceback stack.</p>
</section>
<section id="ofair-is-now-the-default-scheduling-strategy">
<h4><code class="docutils literal notranslate"><span class="pre">-Ofair</span></code> is now the default scheduling strategy<a class="headerlink" href="#ofair-is-now-the-default-scheduling-strategy" title="Link to this heading">¶</a></h4>
<p>To re-enable the default behavior in 3.1 use the <code class="docutils literal notranslate"><span class="pre">-Ofast</span></code> command-line
option.</p>
<p>There's been lots of confusion about what the <code class="docutils literal notranslate"><span class="pre">-Ofair</span></code> command-line option
does, and using the term &quot;prefetch&quot; in explanations have probably not helped
given how confusing this terminology is in AMQP.</p>
<p>When a Celery worker using the prefork pool receives a task, it needs to
delegate that task to a child process for execution.</p>
<p>The prefork pool has a configurable number of child processes
(<code class="docutils literal notranslate"><span class="pre">--concurrency</span></code>) that can be used to execute tasks, and each child process
uses pipes/sockets to communicate with the parent process:</p>
<ul class="simple">
<li><p>inqueue (pipe/socket): parent sends task to the child process</p></li>
<li><p>outqueue (pipe/socket): child sends result/return value to the parent.</p></li>
</ul>
<p>In Celery 3.1 the default scheduling mechanism was simply to send
the task to the first <code class="docutils literal notranslate"><span class="pre">inqueue</span></code> that was writable, with some heuristics
to make sure we round-robin between them to ensure each child process
would receive the same amount of tasks.</p>
<p>This means that in the default scheduling strategy, a worker may send
tasks to the same child process that is already executing a task.  If that
task is long running, it may block the waiting task for a long time.  Even
worse, hundreds of short-running tasks may be stuck behind a long running task
even when there are child processes free to do work.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-Ofair</span></code> scheduling strategy was added to avoid this situation,
and when enabled it adds the rule that no task should be sent to the a child
process that is already executing a task.</p>
<p>The fair scheduling strategy may perform slightly worse if you have only
short running tasks.</p>
</section>
<section id="limit-child-process-resident-memory-size">
<h4>Limit child process resident memory size<a class="headerlink" href="#limit-child-process-resident-memory-size" title="Link to this heading">¶</a></h4>
<p>You can now limit the maximum amount of memory allocated per prefork
pool child process by setting the worker
<a class="reference internal" href="../reference/cli.html#cmdoption-celery-worker-max-memory-per-child"><code class="xref std std-option docutils literal notranslate"><span class="pre">--max-memory-per-child</span></code></a> option,
or the <a class="reference internal" href="../userguide/configuration.html#std-setting-worker_max_memory_per_child"><code class="xref std std-setting docutils literal notranslate"><span class="pre">worker_max_memory_per_child</span></code></a> setting.</p>
<p>The limit is for RSS/resident memory size and is specified in kilobytes.</p>
<p>A child process having exceeded the limit will be terminated and replaced
with a new process after the currently executing task returns.</p>
<p>See <a class="reference internal" href="../userguide/workers.html#worker-max-memory-per-child"><span class="std std-ref">每个子进程的最大内存设置</span></a> for more information.</p>
<p>Contributed by <strong>Dave Smith</strong>.</p>
</section>
<section id="one-log-file-per-child-process">
<h4>One log-file per child process<a class="headerlink" href="#one-log-file-per-child-process" title="Link to this heading">¶</a></h4>
<p>Init-scrips and <strong class="program">celery multi</strong> now uses the <cite>%I</cite> log file format
option (e.g., <code class="file docutils literal notranslate"><span class="pre">/var/log/celery/%n%I.log</span></code>).</p>
<p>This change was necessary to ensure each child
process has a separate log file after moving task logging
to the child process, as multiple processes writing to the same
log file can cause corruption.</p>
<p>You're encouraged to upgrade your init-scripts and
<strong class="program">celery multi</strong> arguments to use this new option.</p>
</section>
</section>
<section id="transports">
<h3>Transports<a class="headerlink" href="#transports" title="Link to this heading">¶</a></h3>
<section id="rabbitmq-priority-queue-support">
<h4>RabbitMQ priority queue support<a class="headerlink" href="#rabbitmq-priority-queue-support" title="Link to this heading">¶</a></h4>
<p>See <a class="reference internal" href="../userguide/routing.html#routing-options-rabbitmq-priorities"><span class="std std-ref">RabbitMQ 消息优先级</span></a> for more information.</p>
<p>Contributed by <strong>Gerald Manipon</strong>.</p>
</section>
<section id="configure-broker-url-for-read-write-separately">
<h4>Configure broker URL for read/write separately<a class="headerlink" href="#configure-broker-url-for-read-write-separately" title="Link to this heading">¶</a></h4>
<p>New <a class="reference internal" href="../userguide/configuration.html#std-setting-broker_read_url"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_read_url</span></code></a> and <a class="reference internal" href="../userguide/configuration.html#std-setting-broker_write_url"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_write_url</span></code></a> settings
have been added so that separate broker URLs can be provided
for connections used for consuming/publishing.</p>
<p>In addition to the configuration options, two new methods have been
added the app API:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">app.connection_for_read()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">app.connection_for_write()</span></code></p></li>
</ul>
</div></blockquote>
<p>These should now be used in place of <code class="docutils literal notranslate"><span class="pre">app.connection()</span></code> to specify
the intent of the required connection.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Two connection pools are available: <code class="docutils literal notranslate"><span class="pre">app.pool</span></code> (read), and
<code class="docutils literal notranslate"><span class="pre">app.producer_pool</span></code> (write). The latter doesn't actually give connections
but full <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Producer" title="（在 Kombu v5.5）"><code class="xref py py-class docutils literal notranslate"><span class="pre">kombu.Producer</span></code></a> instances.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">publish_some_message</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">producer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">producer_or_acquire</span><span class="p">(</span><span class="n">producer</span><span class="p">)</span> <span class="k">as</span> <span class="n">producer</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">consume_messages</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">connection_or_acquire</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
</section>
<section id="rabbitmq-queue-extensions-support">
<h4>RabbitMQ queue extensions support<a class="headerlink" href="#rabbitmq-queue-extensions-support" title="Link to this heading">¶</a></h4>
<p>Queue declarations can now set a message TTL and queue expiry time directly,
by using the <code class="docutils literal notranslate"><span class="pre">message_ttl</span></code> and <code class="docutils literal notranslate"><span class="pre">expires</span></code> arguments</p>
<p>New arguments have been added to <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue" title="（在 Kombu v5.5）"><code class="xref py py-class docutils literal notranslate"><span class="pre">Queue</span></code></a> that lets
you directly and conveniently configure RabbitMQ queue extensions
in queue declarations:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Queue(expires=20.0)</span></code></p>
<blockquote>
<div><p>Set queue expiry time in float seconds.</p>
<p>See <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue.expires" title="（在 Kombu v5.5）"><code class="xref py py-attr docutils literal notranslate"><span class="pre">kombu.Queue.expires</span></code></a>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Queue(message_ttl=30.0)</span></code></p>
<blockquote>
<div><p>Set queue message time-to-live float seconds.</p>
<p>See <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue.message_ttl" title="（在 Kombu v5.5）"><code class="xref py py-attr docutils literal notranslate"><span class="pre">kombu.Queue.message_ttl</span></code></a>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Queue(max_length=1000)</span></code></p>
<blockquote>
<div><p>Set queue max length (number of messages) as int.</p>
<p>See <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue.max_length" title="（在 Kombu v5.5）"><code class="xref py py-attr docutils literal notranslate"><span class="pre">kombu.Queue.max_length</span></code></a>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Queue(max_length_bytes=1000)</span></code></p>
<blockquote>
<div><p>Set queue max length (message size total in bytes) as int.</p>
<p>See <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue.max_length_bytes" title="（在 Kombu v5.5）"><code class="xref py py-attr docutils literal notranslate"><span class="pre">kombu.Queue.max_length_bytes</span></code></a>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Queue(max_priority=10)</span></code></p>
<blockquote>
<div><p>Declare queue to be a priority queue that routes messages
based on the <code class="docutils literal notranslate"><span class="pre">priority</span></code> field of the message.</p>
<p>See <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue.max_priority" title="（在 Kombu v5.5）"><code class="xref py py-attr docutils literal notranslate"><span class="pre">kombu.Queue.max_priority</span></code></a>.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="amazon-sqs-transport-now-officially-supported">
<h4>Amazon SQS transport now officially supported<a class="headerlink" href="#amazon-sqs-transport-now-officially-supported" title="Link to this heading">¶</a></h4>
<p>The SQS broker transport has been rewritten to use async I/O and as such
joins RabbitMQ, Redis and QPid as officially supported transports.</p>
<p>The new implementation also takes advantage of long polling,
and closes several issues related to using SQS as a broker.</p>
<p>This work was sponsored by Nextdoor.</p>
</section>
<section id="apache-qpid-transport-now-officially-supported">
<h4>Apache QPid transport now officially supported<a class="headerlink" href="#apache-qpid-transport-now-officially-supported" title="Link to this heading">¶</a></h4>
<p>Contributed by <strong>Brian Bouterse</strong>.</p>
</section>
</section>
<section id="redis-support-for-sentinel">
<h3>Redis: Support for Sentinel<a class="headerlink" href="#redis-support-for-sentinel" title="Link to this heading">¶</a></h3>
<p>You can point the connection to a list of sentinel URLs like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sentinel://0.0.0.0:26379;sentinel://0.0.0.0:26380/...
</pre></div>
</div>
<p>where each sentinel is separated by a <cite>;</cite>. Multiple sentinels are handled
by <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Connection" title="（在 Kombu v5.5）"><code class="xref py py-class docutils literal notranslate"><span class="pre">kombu.Connection</span></code></a> constructor, and placed in the alternative
list of servers to connect to in case of connection failure.</p>
<p>Contributed by <strong>Sergey Azovskov</strong>, and <strong>Lorenzo Mancini</strong>.</p>
</section>
<section id="tasks">
<h3>Tasks<a class="headerlink" href="#tasks" title="Link to this heading">¶</a></h3>
<section id="task-auto-retry-decorator">
<h4>Task Auto-retry Decorator<a class="headerlink" href="#task-auto-retry-decorator" title="Link to this heading">¶</a></h4>
<p>Writing custom retry handling for exception events is so common
that we now have built-in support for it.</p>
<p>For this a new <code class="docutils literal notranslate"><span class="pre">autoretry_for</span></code> argument is now supported by
the task decorators, where you can specify a tuple of exceptions
to automatically retry for:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">twitter.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">FailWhaleError</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">autoretry_for</span><span class="o">=</span><span class="p">(</span><span class="n">FailWhaleError</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">refresh_timeline</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">twitter</span><span class="o">.</span><span class="n">refresh_timeline</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/tasks.html#task-autoretry"><span class="std std-ref">已知异常的自动重试</span></a> for more information.</p>
<p>Contributed by <strong>Dmitry Malinovsky</strong>.</p>
</section>
<section id="task-replace-improvements">
<h4><code class="docutils literal notranslate"><span class="pre">Task.replace</span></code> Improvements<a class="headerlink" href="#task-replace-improvements" title="Link to this heading">¶</a></h4>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">self.replace(signature)</span></code> can now replace any task, chord or group,
and the signature to replace with can be a chord, group or any other
type of signature.</p></li>
<li><p>No longer inherits the callbacks and errbacks of the existing task.</p>
<blockquote>
<div><p>If you replace a node in a tree, then you wouldn't expect the new node to
inherit the children of the old node.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.replace_in_chord</span></code> has been removed, use <code class="docutils literal notranslate"><span class="pre">.replace</span></code> instead.</p></li>
<li><p>If the replacement is a group, that group will be automatically converted
to a chord, where the callback &quot;accumulates&quot; the results of the group tasks.</p>
<blockquote>
<div><p>A new built-in task (<cite>celery.accumulate</cite> was added for this purpose)</p>
</div></blockquote>
</li>
</ul>
<p>Contributed by <strong>Steeve Morin</strong>, and <strong>Ask Solem</strong>.</p>
</section>
<section id="remote-task-tracebacks">
<h4>Remote Task Tracebacks<a class="headerlink" href="#remote-task-tracebacks" title="Link to this heading">¶</a></h4>
<p>The new <a class="reference internal" href="../userguide/configuration.html#std-setting-task_remote_tracebacks"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_remote_tracebacks</span></code></a> will make task tracebacks more
useful by injecting the stack of the remote worker.</p>
<p>This feature requires the additional <a class="extlink-pypi reference external" href="https://pypi.org/project/tblib/">https://pypi.org/project/tblib/</a> library.</p>
<p>Contributed by <strong>Ionel Cristian Mărieș</strong>.</p>
</section>
<section id="handling-task-connection-errors">
<h4>Handling task connection errors<a class="headerlink" href="#handling-task-connection-errors" title="Link to this heading">¶</a></h4>
<p>Connection related errors occurring while sending a task is now re-raised
as a <a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.OperationalError" title="kombu.exceptions.OperationalError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">kombu.exceptions.OperationalError</span></code></a> error:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="n">add</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not send task </span><span class="si">%r</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/calling.html#calling-connection-errors"><span class="std std-ref">连接错误处理</span></a> for more information.</p>
</section>
<section id="gevent-eventlet-dedicated-thread-for-consuming-results">
<h4>Gevent/Eventlet: Dedicated thread for consuming results<a class="headerlink" href="#gevent-eventlet-dedicated-thread-for-consuming-results" title="Link to this heading">¶</a></h4>
<p>When using <a class="extlink-pypi reference external" href="https://pypi.org/project/gevent/">https://pypi.org/project/gevent/</a>, or <a class="extlink-pypi reference external" href="https://pypi.org/project/eventlet/">https://pypi.org/project/eventlet/</a> there is now a single
thread responsible for consuming events.</p>
<p>This means that if you have many calls retrieving results, there will be
a dedicated thread for consuming them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># this call will delegate to the result consumer thread:</span>
<span class="c1">#   once the consumer thread has received the result this greenlet can</span>
<span class="c1"># continue.</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>This makes performing RPC calls when using gevent/eventlet perform much
better.</p>
</section>
<section id="asyncresult-then-on-success-on-error">
<h4><code class="docutils literal notranslate"><span class="pre">AsyncResult.then(on_success,</span> <span class="pre">on_error)</span></code><a class="headerlink" href="#asyncresult-then-on-success-on-error" title="Link to this heading">¶</a></h4>
<p>The AsyncResult API has been extended to support the <code class="xref py py-class docutils literal notranslate"><span class="pre">promise</span></code> protocol.</p>
<p>This currently only works with the RPC (amqp) and Redis result backends, but
lets you attach callbacks to when tasks finish:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gevent.monkey</span>
<span class="n">monkey</span><span class="o">.</span><span class="n">patch_all</span><span class="p">()</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">Celery</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">broker</span><span class="o">=</span><span class="s1">&#39;amqp://&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;rpc&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_result_ready</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received result for id </span><span class="si">%r</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">,))</span>

<span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">on_result_ready</span><span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># run gevent event loop for a while.</span>
</pre></div>
</div>
<p>Demonstrated using <a class="extlink-pypi reference external" href="https://pypi.org/project/gevent/">https://pypi.org/project/gevent/</a> here, but really this is an API that's more
useful in callback-based event loops like <a class="extlink-pypi reference external" href="https://pypi.org/project/twisted/">https://pypi.org/project/twisted/</a>, or <a class="extlink-pypi reference external" href="https://pypi.org/project/tornado/">https://pypi.org/project/tornado/</a>.</p>
</section>
<section id="new-task-router-api">
<h4>New Task Router API<a class="headerlink" href="#new-task-router-api" title="Link to this heading">¶</a></h4>
<p>The <a class="reference internal" href="../userguide/configuration.html#std-setting-task_routes"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_routes</span></code></a> setting can now hold functions, and map routes
now support glob patterns and regexes.</p>
<p>Instead of using router classes you can now simply define a function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">route_for_task</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">proj</span><span class="w"> </span><span class="kn">import</span> <span class="n">tasks</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="s1">&#39;hipri&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>If you don't need the arguments you can use start arguments, just make
sure you always also accept star arguments so that we have the ability
to add more features in the future:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">route_for_task</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">proj</span><span class="w"> </span><span class="kn">import</span> <span class="n">tasks</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">tasks</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="s1">&#39;hipri&#39;</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
</pre></div>
</div>
<p>Both the <code class="docutils literal notranslate"><span class="pre">options</span></code> argument and the new <code class="docutils literal notranslate"><span class="pre">task</span></code> keyword argument
are new to the function-style routers, and will make it easier to write
routers based on execution options, or properties of the task.</p>
<p>The optional <code class="docutils literal notranslate"><span class="pre">task</span></code> keyword argument won't be set if a task is called
by name using <a class="reference internal" href="../reference/celery.html#celery.Celery.send_task" title="celery.Celery.send_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.send_task()</span></code></a>.</p>
<p>For more examples, including using glob/regexes in routers please see
<a class="reference internal" href="../userguide/configuration.html#std-setting-task_routes"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_routes</span></code></a> and <a class="reference internal" href="../userguide/routing.html#routing-automatic"><span class="std std-ref">自动路由</span></a>.</p>
</section>
<section id="canvas-refactor">
<h4>Canvas Refactor<a class="headerlink" href="#canvas-refactor" title="Link to this heading">¶</a></h4>
<p>The canvas/work-flow implementation have been heavily refactored
to fix some long outstanding issues.</p>
<ul>
<li><p>Error callbacks can now take real exception and traceback instances
(<span class="xref issue">Issue #2538</span>).</p>
<blockquote>
<div><div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">on_error</span><span class="p">(</span><span class="n">log_error</span><span class="o">.</span><span class="n">s</span><span class="p">())</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">log_error</span></code> could be defined as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">log_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/var/errors&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--</span><span class="se">\n\n</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">task_id</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">traceback</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">fh</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/canvas.html#guide-canvas"><span class="std std-ref">Canvas：设计工作流</span></a> for more examples.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">chain(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code> now works the same as <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">|</span> <span class="pre">b</span> <span class="pre">|</span> <span class="pre">c</span></code>.</p>
<blockquote>
<div><p>This means chain may no longer return an instance of <code class="docutils literal notranslate"><span class="pre">chain</span></code>,
instead it may optimize the workflow so that e.g. two groups
chained together becomes one group.</p>
</div></blockquote>
</li>
<li><p>Now unrolls groups within groups into a single group (<span class="xref issue">Issue #1509</span>).</p></li>
<li><p>chunks/map/starmap tasks now routes based on the target task</p></li>
<li><p>chords and chains can now be immutable.</p></li>
<li><p>Fixed bug where serialized signatures weren't converted back into
signatures (<span class="xref issue">Issue #2078</span>)</p>
<blockquote>
<div><p>Fix contributed by <strong>Ross Deane</strong>.</p>
</div></blockquote>
</li>
<li><p>Fixed problem where chains and groups didn't work when using JSON
serialization (<span class="xref issue">Issue #2076</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Ross Deane</strong>.</p>
</div></blockquote>
</li>
<li><p>Creating a chord no longer results in multiple values for keyword
argument 'task_id' (<span class="xref issue">Issue #2225</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Aneil Mallavarapu</strong>.</p>
</div></blockquote>
</li>
<li><p>Fixed issue where the wrong result is returned when a chain
contains a chord as the penultimate task.</p>
<blockquote>
<div><p>Fix contributed by <strong>Aneil Mallavarapu</strong>.</p>
</div></blockquote>
</li>
<li><p>Special case of <code class="docutils literal notranslate"><span class="pre">group(A.s()</span> <span class="pre">|</span> <span class="pre">group(B.s()</span> <span class="pre">|</span> <span class="pre">C.s()))</span></code> now works.</p></li>
<li><p>Chain: Fixed bug with incorrect id set when a subtask is also a chain.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">|</span> <span class="pre">group</span></code> is now flattened into a single group (<span class="xref issue">Issue #2573</span>).</p></li>
<li><p>Fixed issue where <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">|</span> <span class="pre">task</span></code> wasn't upgrading correctly
to chord (<span class="xref issue">Issue #2922</span>).</p></li>
<li><p>Chords now properly sets <code class="docutils literal notranslate"><span class="pre">result.parent</span></code> links.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunks</span></code>/<code class="docutils literal notranslate"><span class="pre">map</span></code>/<code class="docutils literal notranslate"><span class="pre">starmap</span></code> are now routed based on the target task.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Signature.link</span></code> now works when argument is scalar (not a list)</dt><dd><p>(<span class="xref issue">Issue #2019</span>).</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">group()</span></code> now properly forwards keyword arguments (<span class="xref issue">Issue #3426</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Samuel Giffard</strong>.</p>
</div></blockquote>
</li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">chord</span></code> where the header group only consists of a single task
is now turned into a simple chain.</p></li>
<li><p>Passing a <code class="docutils literal notranslate"><span class="pre">link</span></code> argument to <code class="docutils literal notranslate"><span class="pre">group.apply_async()</span></code> now raises an error
(<span class="xref issue">Issue #3508</span>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chord</span> <span class="pre">|</span> <span class="pre">sig</span></code> now attaches to the chord callback (<span class="xref issue">Issue #3356</span>).</p></li>
</ul>
</section>
</section>
<section id="periodic-tasks">
<h3>Periodic Tasks<a class="headerlink" href="#periodic-tasks" title="Link to this heading">¶</a></h3>
<section id="new-api-for-configuring-periodic-tasks">
<h4>New API for configuring periodic tasks<a class="headerlink" href="#new-api-for-configuring-periodic-tasks" title="Link to this heading">¶</a></h4>
<p>This new API enables you to use signatures when defining periodic tasks,
removing the chance of mistyping task names.</p>
<p>An example of the new API is <a class="reference internal" href="../userguide/periodic-tasks.html#beat-entries"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="optimized-beat-implementation">
<h4>Optimized Beat implementation<a class="headerlink" href="#optimized-beat-implementation" title="Link to this heading">¶</a></h4>
<p>The <strong class="program">celery beat</strong> implementation has been optimized
for millions of periodic tasks by using a heap to schedule entries.</p>
<p>Contributed by <strong>Ask Solem</strong> and <strong>Alexander Koshelev</strong>.</p>
</section>
<section id="schedule-tasks-based-on-sunrise-sunset-dawn-and-dusk">
<h4>Schedule tasks based on sunrise, sunset, dawn and dusk<a class="headerlink" href="#schedule-tasks-based-on-sunrise-sunset-dawn-and-dusk" title="Link to this heading">¶</a></h4>
<p>See <a class="reference internal" href="../userguide/periodic-tasks.html#beat-solar"><span class="std std-ref">Solar 调度</span></a> for more information.</p>
<p>Contributed by <strong>Mark Parncutt</strong>.</p>
</section>
</section>
<section id="result-backends">
<h3>Result Backends<a class="headerlink" href="#result-backends" title="Link to this heading">¶</a></h3>
<section id="rpc-result-backend-matured">
<h4>RPC Result Backend matured<a class="headerlink" href="#rpc-result-backend-matured" title="Link to this heading">¶</a></h4>
<p>Lots of bugs in the previously experimental RPC result backend have been fixed
and can now be considered to production use.</p>
<p>Contributed by <strong>Ask Solem</strong>, <strong>Morris Tweed</strong>.</p>
</section>
<section id="redis-result-backend-optimizations">
<h4>Redis: Result backend optimizations<a class="headerlink" href="#redis-result-backend-optimizations" title="Link to this heading">¶</a></h4>
<section id="result-get-is-now-using-pub-sub-for-streaming-task-results">
<h5><code class="docutils literal notranslate"><span class="pre">result.get()</span></code> is now using pub/sub for streaming task results<a class="headerlink" href="#result-get-is-now-using-pub-sub-for-streaming-task-results" title="Link to this heading">¶</a></h5>
<p>Calling <code class="docutils literal notranslate"><span class="pre">result.get()</span></code> when using the Redis result backend
used to be extremely expensive as it was using polling to wait
for the result to become available. A default polling
interval of 0.5 seconds didn't help performance, but was
necessary to avoid a spin loop.</p>
<p>The new implementation is using Redis Pub/Sub mechanisms to
publish and retrieve results immediately, greatly improving
task round-trip times.</p>
<p>Contributed by <strong>Yaroslav Zhavoronkov</strong> and <strong>Ask Solem</strong>.</p>
</section>
<section id="new-optimized-chord-join-implementation">
<h5>New optimized chord join implementation<a class="headerlink" href="#new-optimized-chord-join-implementation" title="Link to this heading">¶</a></h5>
<p>This was an experimental feature introduced in Celery 3.1,
that could only be enabled by adding <code class="docutils literal notranslate"><span class="pre">?new_join=1</span></code> to the
result backend URL configuration.</p>
<p>We feel that the implementation has been tested thoroughly enough
to be considered stable and enabled by default.</p>
<p>The new implementation greatly reduces the overhead of chords,
and especially with larger chords the performance benefit can be massive.</p>
</section>
</section>
<section id="new-riak-result-backend-introduced">
<h4>New Riak result backend introduced<a class="headerlink" href="#new-riak-result-backend-introduced" title="Link to this heading">¶</a></h4>
<p>See <span class="xref std std-ref">conf-riak-result-backend</span> for more information.</p>
<p>Contributed by <strong>Gilles Dartiguelongue</strong>, <strong>Alman One</strong> and <strong>NoKriK</strong>.</p>
</section>
<section id="new-couchdb-result-backend-introduced">
<h4>New CouchDB result backend introduced<a class="headerlink" href="#new-couchdb-result-backend-introduced" title="Link to this heading">¶</a></h4>
<p>See <a class="reference internal" href="../userguide/configuration.html#conf-couchdb-result-backend"><span class="std std-ref">CouchDB 后端设置</span></a> for more information.</p>
<p>Contributed by <strong>Nathan Van Gheem</strong>.</p>
</section>
<section id="new-consul-result-backend-introduced">
<h4>New Consul result backend introduced<a class="headerlink" href="#new-consul-result-backend-introduced" title="Link to this heading">¶</a></h4>
<p>Add support for Consul as a backend using the Key/Value store of Consul.</p>
<p>Consul has an HTTP API where through you can store keys with their values.</p>
<p>The backend extends KeyValueStoreBackend and implements most of the methods.</p>
<p>Mainly to set, get and remove objects.</p>
<p>This allows Celery to store Task results in the K/V store of Consul.</p>
<p>Consul also allows to set a TTL on keys using the Sessions from Consul. This way
the backend supports auto expiry of Task results.</p>
<p>For more information on Consul visit <a class="reference external" href="https://consul.io/">https://consul.io/</a></p>
<p>The backend uses <a class="extlink-pypi reference external" href="https://pypi.org/project/python-consul/">https://pypi.org/project/python-consul/</a> for talking to the HTTP API.
This package is fully Python 3 compliant just as this backend is:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>python-consul
</pre></div>
</div>
<p>That installs the required package to talk to Consul's HTTP API from Python.</p>
<p>You can also specify consul as an extension in your dependency on Celery:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>celery<span class="o">[</span>consul<span class="o">]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../getting-started/introduction.html#bundles"><span class="std std-ref">软件包</span></a> for more information.</p>
<p>Contributed by <strong>Wido den Hollander</strong>.</p>
</section>
<section id="brand-new-cassandra-result-backend">
<h4>Brand new Cassandra result backend<a class="headerlink" href="#brand-new-cassandra-result-backend" title="Link to this heading">¶</a></h4>
<p>A brand new Cassandra backend utilizing the new <a class="extlink-pypi reference external" href="https://pypi.org/project/cassandra-driver/">https://pypi.org/project/cassandra-driver/</a>
library is replacing the old result backend using the older
<a class="extlink-pypi reference external" href="https://pypi.org/project/pycassa/">https://pypi.org/project/pycassa/</a> library.</p>
<p>See <a class="reference internal" href="../userguide/configuration.html#conf-cassandra-result-backend"><span class="std std-ref">Cassandra/AstraDB 后端设置</span></a> for more information.</p>
<p>To depend on Celery with Cassandra as the result backend use:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>celery<span class="o">[</span>cassandra<span class="o">]</span>
</pre></div>
</div>
<p>You can also combine multiple extension requirements,
please see <a class="reference internal" href="../getting-started/introduction.html#bundles"><span class="std std-ref">软件包</span></a> for more information.</p>
</section>
<section id="new-elasticsearch-result-backend-introduced">
<h4>New Elasticsearch result backend introduced<a class="headerlink" href="#new-elasticsearch-result-backend-introduced" title="Link to this heading">¶</a></h4>
<p>See <a class="reference internal" href="../userguide/configuration.html#conf-elasticsearch-result-backend"><span class="std std-ref">Elasticsearch 后端设置</span></a> for more information.</p>
<p>To depend on Celery with Elasticsearch as the result backend use:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>celery<span class="o">[</span>elasticsearch<span class="o">]</span>
</pre></div>
</div>
<p>You can also combine multiple extension requirements,
please see <a class="reference internal" href="../getting-started/introduction.html#bundles"><span class="std std-ref">软件包</span></a> for more information.</p>
<p>Contributed by <strong>Ahmet Demir</strong>.</p>
</section>
<section id="new-file-system-result-backend-introduced">
<h4>New File-system result backend introduced<a class="headerlink" href="#new-file-system-result-backend-introduced" title="Link to this heading">¶</a></h4>
<p>See <a class="reference internal" href="../userguide/configuration.html#conf-filesystem-result-backend"><span class="std std-ref">文件系统后端设置</span></a> for more information.</p>
<p>Contributed by <strong>Môshe van der Sterre</strong>.</p>
</section>
</section>
<section id="event-batching">
<h3>Event Batching<a class="headerlink" href="#event-batching" title="Link to this heading">¶</a></h3>
<p>Events are now buffered in the worker and sent as a list, reducing
the overhead required to send monitoring events.</p>
<p>For authors of custom event monitors there will be no action
required as long as you're using the Python Celery
helpers (<code class="xref py py-class docutils literal notranslate"><span class="pre">Receiver</span></code>) to implement your monitor.</p>
<p>However, if you're parsing raw event messages you must now account
for batched event messages,  as they differ from normal event messages
in the following way:</p>
<ul class="simple">
<li><p>The routing key for a batch of event messages will be set to
<code class="docutils literal notranslate"><span class="pre">&lt;event-group&gt;.multi</span></code> where the only batched event group
is currently <code class="docutils literal notranslate"><span class="pre">task</span></code> (giving a routing key of <code class="docutils literal notranslate"><span class="pre">task.multi</span></code>).</p></li>
<li><p>The message body will be a serialized list-of-dictionaries instead
of a dictionary. Each item in the list can be regarded
as a normal event message body.</p></li>
</ul>
</section>
<section id="in-other-news">
<h3>In Other News...<a class="headerlink" href="#in-other-news" title="Link to this heading">¶</a></h3>
<section id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Now depends on <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/changelog.html#version-4-0" title="（在 Kombu v5.5）"><span class="xref std std-ref">Kombu 4.0</span></a>.</p></li>
<li><p>Now depends on <a class="extlink-pypi reference external" href="https://pypi.org/project/billiard/">https://pypi.org/project/billiard/</a> version 3.5.</p></li>
<li><p>No longer depends on <a class="extlink-pypi reference external" href="https://pypi.org/project/anyjson/">https://pypi.org/project/anyjson/</a>. Good-bye old friend :(</p></li>
</ul>
</section>
<section id="id1">
<h4>Tasks<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<ul>
<li><p>The &quot;anon-exchange&quot; is now used for simple name-name direct routing.</p>
<p>This increases performance as it completely bypasses the routing table,
in addition it also improves reliability for the Redis broker transport.</p>
</li>
<li><p>An empty ResultSet now evaluates to True.</p>
<blockquote>
<div><p>Fix contributed by <strong>Colin McIntosh</strong>.</p>
</div></blockquote>
</li>
<li><p>The default routing key (<a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_routing_key"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_routing_key</span></code></a>) and exchange
name (<a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_exchange"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_exchange</span></code></a>) is now taken from the
<a class="reference internal" href="../userguide/configuration.html#std-setting-task_default_queue"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_default_queue</span></code></a> setting.</p>
<blockquote>
<div><p>This means that to change the name of the default queue, you now
only have to set a single setting.</p>
</div></blockquote>
</li>
<li><p>New <a class="reference internal" href="../userguide/configuration.html#std-setting-task_reject_on_worker_lost"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_reject_on_worker_lost</span></code></a> setting, and
<a class="reference internal" href="../reference/celery.app.task.html#celery.app.task.Task.reject_on_worker_lost" title="celery.app.task.Task.reject_on_worker_lost"><code class="xref py py-attr docutils literal notranslate"><span class="pre">reject_on_worker_lost</span></code></a> task attribute decides what happens
when the child worker process executing a late ack task is terminated.</p>
<blockquote>
<div><p>Contributed by <strong>Michael Permana</strong>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.subtask</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">Task.signature</span></code> with alias.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.subtask_from_request</span></code> renamed to
<code class="docutils literal notranslate"><span class="pre">Task.signature_from_request</span></code> with alias.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">delivery_mode</span></code> attribute for <a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue" title="（在 Kombu v5.5）"><code class="xref py py-class docutils literal notranslate"><span class="pre">kombu.Queue</span></code></a> is now
respected (<span class="xref issue">Issue #1953</span>).</p></li>
<li><p>Routes in <code class="xref std std-setting docutils literal notranslate"><span class="pre">task-routes</span></code> can now specify a
<a class="reference external" href="https://docs.celeryq.dev/projects/kombu/en/main/reference/kombu.html#kombu.Queue" title="（在 Kombu v5.5）"><code class="xref py py-class docutils literal notranslate"><span class="pre">Queue</span></code></a> instance directly.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">task_routes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proj.tasks.add&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="n">Queue</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">)}}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">AsyncResult</span></code> now raises <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#ValueError" title="（在 Python v3.15）"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> if task_id is None.
(<span class="xref issue">Issue #1996</span>).</p></li>
<li><p>Retried tasks didn't forward expires setting (<span class="xref issue">Issue #3297</span>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result.get()</span></code> now supports an <code class="docutils literal notranslate"><span class="pre">on_message</span></code> argument to set a
callback to be called for every message received.</p></li>
<li><p>New abstract classes added:</p>
<blockquote>
<div><ul>
<li><p><a class="reference internal" href="../internals/reference/celery.utils.abstract.html#celery.utils.abstract.CallableTask" title="celery.utils.abstract.CallableTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">CallableTask</span></code></a></p>
<blockquote>
<div><p>Looks like a task.</p>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="../internals/reference/celery.utils.abstract.html#celery.utils.abstract.CallableSignature" title="celery.utils.abstract.CallableSignature"><code class="xref py py-class docutils literal notranslate"><span class="pre">CallableSignature</span></code></a></p>
<blockquote>
<div><p>Looks like a task signature.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.replace</span></code> now properly forwards callbacks (<span class="xref issue">Issue #2722</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Nicolas Unravel</strong>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.replace</span></code>: Append to chain/chord (Closes #3232)</p>
<blockquote>
<div><p>Fixed <span class="xref issue">issue #3232</span>, adding the signature to the chain (if there's any).
Fixed the chord suppress if the given signature contains one.</p>
<p>Fix contributed by <a class="extlink-github_user reference external" href="https://github.com/honux/">&#64;honux</a>.</p>
</div></blockquote>
</li>
<li><p>Task retry now also throws in eager mode.</p>
<blockquote>
<div><p>Fix contributed by <strong>Feanil Patel</strong>.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="beat">
<h4>Beat<a class="headerlink" href="#beat" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Fixed crontab infinite loop with invalid date.</p>
<blockquote>
<div><p>When occurrence can never be reached (example, April, 31th), trying
to reach the next occurrence would trigger an infinite loop.</p>
<p>Try fixing that by raising a <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#RuntimeError" title="（在 Python v3.15）"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> after 2,000 iterations</p>
<p>(Also added a test for crontab leap years in the process)</p>
<p>Fix contributed by <strong>Romuald Brunet</strong>.</p>
</div></blockquote>
</li>
<li><p>Now ensures the program exits with a non-zero exit code when an
exception terminates the service.</p>
<blockquote>
<div><p>Fix contributed by <strong>Simon Peeters</strong>.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="app">
<h4>App<a class="headerlink" href="#app" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Dates are now always timezone aware even if
<a class="reference internal" href="../userguide/configuration.html#std-setting-enable_utc"><code class="xref std std-setting docutils literal notranslate"><span class="pre">enable_utc</span></code></a> is disabled (<span class="xref issue">Issue #943</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Omer Katz</strong>.</p>
</div></blockquote>
</li>
<li><p><strong>Config</strong>: App preconfiguration is now also pickled with the configuration.</p>
<blockquote>
<div><p>Fix contributed by <strong>Jeremy Zafran</strong>.</p>
</div></blockquote>
</li>
<li><dl>
<dt>The application can now change how task names are generated using</dt><dd><p>the <a class="reference internal" href="../reference/celery.html#celery.Celery.gen_task_name" title="celery.Celery.gen_task_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gen_task_name()</span></code></a> method.</p>
<p>Contributed by <strong>Dmitry Malinovsky</strong>.</p>
</dd>
</dl>
</li>
<li><p>App has new <code class="docutils literal notranslate"><span class="pre">app.current_worker_task</span></code> property that
returns the task that's currently being worked on (or <code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code>).
(<span class="xref issue">Issue #2100</span>).</p></li>
</ul>
</section>
<section id="logging">
<h4>Logging<a class="headerlink" href="#logging" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><a class="reference internal" href="../internals/reference/celery.utils.log.html#celery.utils.log.get_task_logger" title="celery.utils.log.get_task_logger"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_task_logger()</span></code></a> now raises an exception
if trying to use the name &quot;celery&quot; or &quot;celery.task&quot; (<span class="xref issue">Issue #3475</span>).</p></li>
</ul>
</section>
<section id="execution-pools">
<h4>Execution Pools<a class="headerlink" href="#execution-pools" title="Link to this heading">¶</a></h4>
<ul>
<li><p><strong>Eventlet/Gevent</strong>: now enables AMQP heartbeat (<span class="xref issue">Issue #3338</span>).</p></li>
<li><p><strong>Eventlet/Gevent</strong>: Fixed race condition leading to &quot;simultaneous read&quot;
errors (<span class="xref issue">Issue #2755</span>).</p></li>
<li><p><strong>Prefork</strong>: Prefork pool now uses <code class="docutils literal notranslate"><span class="pre">poll</span></code> instead of <code class="docutils literal notranslate"><span class="pre">select</span></code> where
available (<span class="xref issue">Issue #2373</span>).</p></li>
<li><p><strong>Prefork</strong>: Fixed bug where the pool would refuse to shut down the
worker (<span class="xref issue">Issue #2606</span>).</p></li>
<li><p><strong>Eventlet</strong>: Now returns pool size in <strong class="program">celery inspect stats</strong>
command.</p>
<blockquote>
<div><p>Contributed by <strong>Alexander Oblovatniy</strong>.</p>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Celery is now a <a class="extlink-pypi reference external" href="https://pypi.org/project/pytest/">https://pypi.org/project/pytest/</a> plugin, including fixtures
useful for unit and integration testing.</p>
<blockquote>
<div><p>See the <a class="reference internal" href="../userguide/testing.html#testing"><span class="std std-ref">testing user guide</span></a> for more information.</p>
</div></blockquote>
</li>
</ul>
<section id="id2">
<h4>Transports<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">amqps://</span></code> can now be specified to require SSL.</p></li>
<li><p><strong>Redis Transport</strong>: The Redis transport now supports the
<a class="reference internal" href="../userguide/configuration.html#std-setting-broker_use_ssl"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_use_ssl</span></code></a> option.</p>
<blockquote>
<div><p>Contributed by <strong>Robert Kolba</strong>.</p>
</div></blockquote>
</li>
<li><p>JSON serializer now calls <code class="docutils literal notranslate"><span class="pre">obj.__json__</span></code> for unsupported types.</p>
<blockquote>
<div><p>This means you can now define a <code class="docutils literal notranslate"><span class="pre">__json__</span></code> method for custom
types that can be reduced down to a built-in json type.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">:</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">address</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__json__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
            <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
            <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>JSON serializer now handles datetime's, Django promise, UUID and Decimal.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Queue.consumer_arguments</span></code> can be used for the ability to
set consumer priority via <code class="docutils literal notranslate"><span class="pre">x-priority</span></code>.</p>
<p>See <a class="reference external" href="https://www.rabbitmq.com/consumer-priority.html">https://www.rabbitmq.com/consumer-priority.html</a></p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">consumer</span> <span class="o">=</span> <span class="n">Consumer</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">consumer_arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x-priority&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
</pre></div>
</div>
</li>
<li><p>Queue/Exchange: <code class="docutils literal notranslate"><span class="pre">no_declare</span></code> option added (also enabled for
internal amq. exchanges).</p></li>
</ul>
</section>
<section id="programs">
<h4>Programs<a class="headerlink" href="#programs" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Celery is now using <a class="reference external" href="https://docs.python.org/dev/library/argparse.html#module-argparse" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a>, instead of <a class="reference external" href="https://docs.python.org/dev/library/optparse.html#module-optparse" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">optparse</span></code></a>.</p></li>
<li><p>All programs now disable colors if the controlling terminal is not a TTY.</p></li>
<li><p><strong class="program">celery worker</strong>: The <code class="docutils literal notranslate"><span class="pre">-q</span></code> argument now disables the startup
banner.</p></li>
<li><p><strong class="program">celery worker</strong>: The &quot;worker ready&quot; message is now logged
using severity info, instead of warn.</p></li>
<li><p><strong class="program">celery multi</strong>: <code class="docutils literal notranslate"><span class="pre">%n</span></code> format for is now synonym with
<code class="docutils literal notranslate"><span class="pre">%N</span></code> to be consistent with <strong class="program">celery worker</strong>.</p></li>
<li><p><strong class="program">celery inspect</strong>/<strong class="program">celery control</strong>: now supports a new
<a class="reference internal" href="../reference/cli.html#cmdoption-celery-inspect-j"><code class="xref std std-option docutils literal notranslate"><span class="pre">--json</span></code></a> option to give output in json format.</p></li>
<li><p><strong class="program">celery inspect registered</strong>: now ignores built-in tasks.</p></li>
<li><p><strong class="program">celery purge</strong> now takes <code class="docutils literal notranslate"><span class="pre">-Q</span></code> and <code class="docutils literal notranslate"><span class="pre">-X</span></code> options
used to specify what queues to include and exclude from the purge.</p></li>
<li><p>New <strong class="program">celery logtool</strong>: Utility for filtering and parsing
celery worker log-files</p></li>
<li><p><strong class="program">celery multi</strong>: now passes through <cite>%i</cite> and <cite>%I</cite> log
file formats.</p></li>
<li><p>General: <code class="docutils literal notranslate"><span class="pre">%p</span></code> can now be used to expand to the full worker node-name
in log-file/pid-file arguments.</p></li>
<li><dl>
<dt>A new command line option</dt><dd><p><a class="reference internal" href="../reference/cli.html#cmdoption-celery-worker-executable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--executable</span></code></a> is now
available for daemonizing programs (<strong class="program">celery worker</strong> and
<strong class="program">celery beat</strong>).</p>
<blockquote>
<div><p>Contributed by <strong>Bert Vanderbauwhede</strong>.</p>
</div></blockquote>
</dd>
</dl>
</li>
<li><p><strong class="program">celery worker</strong>: supports new
<a class="reference internal" href="../reference/cli.html#cmdoption-celery-worker-prefetch-multiplier"><code class="xref std std-option docutils literal notranslate"><span class="pre">--prefetch-multiplier</span></code></a> option.</p>
<blockquote>
<div><p>Contributed by <strong>Mickaël Penhard</strong>.</p>
</div></blockquote>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--loader</span></code> argument is now always effective even if an app argument is
set (<span class="xref issue">Issue #3405</span>).</p></li>
<li><p>inspect/control now takes commands from registry</p>
<blockquote>
<div><p>This means user remote-control commands can also be used from the
command-line.</p>
<p>Note that you need to specify the arguments/and type of arguments
for the arguments to be correctly passed on the command-line.</p>
<p>There are now two decorators, which use depends on the type of
command: <cite>&#64;inspect_command</cite> + <cite>&#64;control_command</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.worker.control</span><span class="w"> </span><span class="kn">import</span> <span class="n">control_command</span>

<span class="nd">@control_command</span><span class="p">(</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]</span>
    <span class="n">signature</span><span class="o">=</span><span class="s1">&#39;[N=1]&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">something</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">args</span></code> is a list of args supported by the command.
The list must contain tuples of <code class="docutils literal notranslate"><span class="pre">(argument_name,</span> <span class="pre">type)</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">signature</span></code> is just the command-line help used in e.g.
<code class="docutils literal notranslate"><span class="pre">celery</span> <span class="pre">-A</span> <span class="pre">proj</span> <span class="pre">control</span> <span class="pre">--help</span></code>.</p>
<p>Commands also support <cite>variadic</cite> arguments, which means that any
arguments left over will be added to a single variable.  Here demonstrated
by the <code class="docutils literal notranslate"><span class="pre">terminate</span></code> command which takes a signal argument and a variable
number of task_ids:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.worker.control</span><span class="w"> </span><span class="kn">import</span> <span class="n">control_command</span>

<span class="nd">@control_command</span><span class="p">(</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;signal&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)],</span>
    <span class="n">signature</span><span class="o">=</span><span class="s1">&#39;&lt;signal&gt; [id1, [id2, [..., [idN]]]]&#39;</span><span class="p">,</span>
    <span class="n">variadic</span><span class="o">=</span><span class="s1">&#39;ids&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">terminate</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This command can now be called using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>control<span class="w"> </span>terminate<span class="w"> </span>SIGKILL<span class="w"> </span>id1<span class="w"> </span>id2<span class="w"> </span>id3<span class="sb">`</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../userguide/workers.html#worker-custom-control-commands"><span class="std std-ref">编写您自己的远程控制命令</span></a> for more information.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="worker">
<h4>Worker<a class="headerlink" href="#worker" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Improvements and fixes for <a class="reference internal" href="../internals/reference/celery.utils.collections.html#celery.utils.collections.LimitedSet" title="celery.utils.collections.LimitedSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">LimitedSet</span></code></a>.</p>
<blockquote>
<div><p>Getting rid of leaking memory + adding <code class="docutils literal notranslate"><span class="pre">minlen</span></code> size of the set:
the minimal residual size of the set after operating for some time.
<code class="docutils literal notranslate"><span class="pre">minlen</span></code> items are kept, even if they should've been expired.</p>
<p>Problems with older and even more old code:</p>
<ol class="arabic simple">
<li><p>Heap would tend to grow in some scenarios
(like adding an item multiple times).</p></li>
<li><p>Adding many items fast wouldn't clean them soon enough (if ever).</p></li>
<li><p>When talking to other workers, revoked._data was sent, but
it was processed on the other side as iterable.
That means giving those keys new (current)
time-stamp. By doing this workers could recycle
items forever. Combined with 1) and 2), this means that in
large set of workers, you're getting out of memory soon.</p></li>
</ol>
<p>All those problems should be fixed now.</p>
<p>This should fix issues #3095, #3086.</p>
<p>Contributed by <strong>David Pravec</strong>.</p>
</div></blockquote>
</li>
<li><p>New settings to control remote control command queues.</p>
<blockquote>
<div><ul>
<li><p><a class="reference internal" href="../userguide/configuration.html#std-setting-control_queue_expires"><code class="xref std std-setting docutils literal notranslate"><span class="pre">control_queue_expires</span></code></a></p>
<blockquote>
<div><p>Set queue expiry time for both remote control command queues,
and remote control reply queues.</p>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="../userguide/configuration.html#std-setting-control_queue_ttl"><code class="xref std std-setting docutils literal notranslate"><span class="pre">control_queue_ttl</span></code></a></p>
<blockquote>
<div><p>Set message time-to-live for both remote control command queues,
and remote control reply queues.</p>
</div></blockquote>
</li>
</ul>
<p>Contributed by <strong>Alan Justino</strong>.</p>
</div></blockquote>
</li>
<li><p>The <a class="reference internal" href="../userguide/signals.html#std-signal-worker_shutdown"><code class="xref std std-signal docutils literal notranslate"><span class="pre">worker_shutdown</span></code></a> signal is now always called during shutdown.</p>
<blockquote>
<div><p>Previously it would not be called if the worker instance was collected
by gc first.</p>
</div></blockquote>
</li>
<li><p>Worker now only starts the remote control command consumer if the
broker transport used actually supports them.</p></li>
<li><p>Gossip now sets <code class="docutils literal notranslate"><span class="pre">x-message-ttl</span></code> for event queue to heartbeat_interval s.
(<span class="xref issue">Issue #2005</span>).</p></li>
<li><p>Now preserves exit code (<span class="xref issue">Issue #2024</span>).</p></li>
<li><p>Now rejects messages with an invalid ETA value (instead of ack, which means
they will be sent to the dead-letter exchange if one is configured).</p></li>
<li><p>Fixed crash when the <code class="docutils literal notranslate"><span class="pre">-purge</span></code> argument was used.</p></li>
<li><p>Log--level for unrecoverable errors changed from <code class="docutils literal notranslate"><span class="pre">error</span></code> to
<code class="docutils literal notranslate"><span class="pre">critical</span></code>.</p></li>
<li><p>Improved rate limiting accuracy.</p></li>
<li><p>Account for missing timezone information in task expires field.</p>
<blockquote>
<div><p>Fix contributed by <strong>Albert Wang</strong>.</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>The worker no longer has a <code class="docutils literal notranslate"><span class="pre">Queues</span></code> bootsteps, as it is now</dt><dd><p>superfluous.</p>
</dd>
</dl>
</li>
<li><p>Now emits the &quot;Received task&quot; line even for revoked tasks.
(<span class="xref issue">Issue #3155</span>).</p></li>
<li><p>Now respects <a class="reference internal" href="../userguide/configuration.html#std-setting-broker_connection_retry"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_connection_retry</span></code></a> setting.</p>
<blockquote>
<div><p>Fix contributed by <strong>Nat Williams</strong>.</p>
</div></blockquote>
</li>
<li><p>New <a class="reference internal" href="../userguide/configuration.html#std-setting-control_queue_ttl"><code class="xref std std-setting docutils literal notranslate"><span class="pre">control_queue_ttl</span></code></a> and <a class="reference internal" href="../userguide/configuration.html#std-setting-control_queue_expires"><code class="xref std std-setting docutils literal notranslate"><span class="pre">control_queue_expires</span></code></a>
settings now enables you to configure remote control command
message TTLs, and queue expiry time.</p>
<blockquote>
<div><p>Contributed by <strong>Alan Justino</strong>.</p>
</div></blockquote>
</li>
<li><p>New <code class="xref py py-data docutils literal notranslate"><span class="pre">celery.worker.state.requests</span></code> enables O(1) loookup
of active/reserved tasks by id.</p></li>
<li><p>Auto-scale didn't always update keep-alive when scaling down.</p>
<blockquote>
<div><p>Fix contributed by <strong>Philip Garnero</strong>.</p>
</div></blockquote>
</li>
<li><p>Fixed typo <code class="docutils literal notranslate"><span class="pre">options_list</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">option_list</span></code>.</p>
<blockquote>
<div><p>Fix contributed by <strong>Greg Wilbur</strong>.</p>
</div></blockquote>
</li>
<li><p>Some worker command-line arguments and <code class="docutils literal notranslate"><span class="pre">Worker()</span></code> class arguments have
been renamed for consistency.</p>
<blockquote>
<div><p>All of these have aliases for backward compatibility.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--send-events</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">--task-events</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--schedule</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">--schedule-filename</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--maxtasksperchild</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">--max-tasks-per-child</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Beat(scheduler_cls=)</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Beat(scheduler=)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker(send_events=True)</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Worker(task_events=True)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker(task_time_limit=)</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Worker(time_limit=</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker(task_soft_time_limit=)</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Worker(soft_time_limit=)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker(state_db=)</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Worker(statedb=)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker(working_directory=)</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Worker(workdir=)</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="debugging-utilities">
<h4>Debugging Utilities<a class="headerlink" href="#debugging-utilities" title="Link to this heading">¶</a></h4>
<ul>
<li><p><a class="reference internal" href="../reference/celery.contrib.rdb.html#module-celery.contrib.rdb" title="celery.contrib.rdb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.contrib.rdb</span></code></a>: Changed remote debugger banner so that you can copy and paste
the address easily (no longer has a period in the address).</p>
<blockquote>
<div><p>Contributed by <strong>Jonathan Vanasco</strong>.</p>
</div></blockquote>
</li>
<li><p>Fixed compatibility with recent <a class="extlink-pypi reference external" href="https://pypi.org/project/psutil/">https://pypi.org/project/psutil/</a> versions (<span class="xref issue">Issue #3262</span>).</p></li>
</ul>
</section>
<section id="signals">
<h4>Signals<a class="headerlink" href="#signals" title="Link to this heading">¶</a></h4>
<ul>
<li><p><strong>App</strong>: New signals for app configuration/finalization:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../reference/celery.html#celery.Celery.on_configure" title="celery.Celery.on_configure"><code class="xref py py-data docutils literal notranslate"><span class="pre">app.on_configure</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/celery.html#celery.Celery.on_after_configure" title="celery.Celery.on_after_configure"><code class="xref py py-data docutils literal notranslate"><span class="pre">app.on_after_configure</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/celery.html#celery.Celery.on_after_finalize" title="celery.Celery.on_after_finalize"><code class="xref py py-data docutils literal notranslate"><span class="pre">app.on_after_finalize</span></code></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Task</strong>: New task signals for rejected task messages:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">celery.signals.task_rejected</span></code>.</p></li>
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">celery.signals.task_unknown</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Worker</strong>: New signal for when a heartbeat event is sent.</p>
<blockquote>
<div><ul>
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">celery.signals.heartbeat_sent</span></code></p>
<blockquote>
<div><p>Contributed by <strong>Kevin Richardson</strong>.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="events">
<h4>Events<a class="headerlink" href="#events" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Event messages now uses the RabbitMQ <code class="docutils literal notranslate"><span class="pre">x-message-ttl</span></code> option
to ensure older event messages are discarded.</p>
<blockquote>
<div><p>The default is 5 seconds, but can be changed using the
<a class="reference internal" href="../userguide/configuration.html#std-setting-event_queue_ttl"><code class="xref std std-setting docutils literal notranslate"><span class="pre">event_queue_ttl</span></code></a> setting.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.send_event</span></code> now automatically retries sending the event
on connection failure, according to the task publish retry settings.</p></li>
<li><p>Event monitors now sets the <a class="reference internal" href="../userguide/configuration.html#std-setting-event_queue_expires"><code class="xref std std-setting docutils literal notranslate"><span class="pre">event_queue_expires</span></code></a>
setting by default.</p>
<blockquote>
<div><p>The queues will now expire after 60 seconds after the monitor stops
consuming from it.</p>
</div></blockquote>
</li>
<li><p>Fixed a bug where a None value wasn't handled properly.</p>
<blockquote>
<div><p>Fix contributed by <strong>Dongweiming</strong>.</p>
</div></blockquote>
</li>
<li><p>New <a class="reference internal" href="../userguide/configuration.html#std-setting-event_queue_prefix"><code class="xref std std-setting docutils literal notranslate"><span class="pre">event_queue_prefix</span></code></a> setting can now be used
to change the default <code class="docutils literal notranslate"><span class="pre">celeryev</span></code> queue prefix for event receiver queues.</p>
<blockquote>
<div><p>Contributed by <strong>Takeshi Kanemoto</strong>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">State.tasks_by_type</span></code> and <code class="docutils literal notranslate"><span class="pre">State.tasks_by_worker</span></code> can now be
used as a mapping for fast access to this information.</p></li>
</ul>
</section>
<section id="deployment">
<h4>Deployment<a class="headerlink" href="#deployment" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Generic init-scripts now support
<span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">CELERY_SU</span></code> and <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">CELERYD_SU_ARGS</span></code> environment variables
to set the path and arguments for <strong class="command">su</strong> (<em class="manpage">su(1)</em>).</p></li>
<li><p>Generic init-scripts now better support FreeBSD and other BSD
systems by searching <code class="file docutils literal notranslate"><span class="pre">/usr/local/etc/</span></code> for the configuration file.</p>
<blockquote>
<div><p>Contributed by <strong>Taha Jahangir</strong>.</p>
</div></blockquote>
</li>
<li><p>Generic init-script: Fixed strange bug for <code class="docutils literal notranslate"><span class="pre">celerybeat</span></code> where
restart didn't always work (<span class="xref issue">Issue #3018</span>).</p></li>
<li><p>The systemd init script now uses a shell when executing
services.</p>
<blockquote>
<div><p>Contributed by <strong>Tomas Machalek</strong>.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="id3">
<h4>Result Backends<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Redis: Now has a default socket timeout of 120 seconds.</p>
<blockquote>
<div><p>The default can be changed using the new <a class="reference internal" href="../userguide/configuration.html#std-setting-redis_socket_timeout"><code class="xref std std-setting docutils literal notranslate"><span class="pre">redis_socket_timeout</span></code></a>
setting.</p>
<p>Contributed by <strong>Raghuram Srinivasan</strong>.</p>
</div></blockquote>
</li>
<li><p>RPC Backend result queues are now auto delete by default (<span class="xref issue">Issue #2001</span>).</p></li>
<li><p>RPC Backend: Fixed problem where exception
wasn't deserialized properly with the json serializer (<span class="xref issue">Issue #2518</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Allard Hoeve</strong>.</p>
</div></blockquote>
</li>
<li><p>CouchDB: The backend used to double-json encode results.</p>
<blockquote>
<div><p>Fix contributed by <strong>Andrew Stewart</strong>.</p>
</div></blockquote>
</li>
<li><p>CouchDB: Fixed typo causing the backend to not be found
(<span class="xref issue">Issue #3287</span>).</p>
<blockquote>
<div><p>Fix contributed by <strong>Andrew Stewart</strong>.</p>
</div></blockquote>
</li>
<li><p>MongoDB: Now supports setting the <code class="xref std std-setting docutils literal notranslate"><span class="pre">result_serialzier</span></code> setting
to <code class="docutils literal notranslate"><span class="pre">bson</span></code> to use the MongoDB libraries own serializer.</p>
<blockquote>
<div><p>Contributed by <strong>Davide Quarta</strong>.</p>
</div></blockquote>
</li>
<li><dl>
<dt>MongoDB: URI handling has been improved to use</dt><dd><p>database name, user and password from the URI if provided.</p>
<p>Contributed by <strong>Samuel Jaillet</strong>.</p>
</dd>
</dl>
</li>
<li><p>SQLAlchemy result backend: Now ignores all result
engine options when using NullPool (<span class="xref issue">Issue #1930</span>).</p></li>
<li><p>SQLAlchemy result backend: Now sets max char size to 155 to deal
with brain damaged MySQL Unicode implementation (<span class="xref issue">Issue #1748</span>).</p></li>
<li><p><strong>General</strong>: All Celery exceptions/warnings now inherit from common
<a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.CeleryError" title="celery.exceptions.CeleryError"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeleryError</span></code></a>/<a class="reference internal" href="../reference/celery.exceptions.html#celery.exceptions.CeleryWarning" title="celery.exceptions.CeleryWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">CeleryWarning</span></code></a>.
(<span class="xref issue">Issue #2643</span>).</p></li>
</ul>
</section>
<section id="documentation-improvements">
<h4>Documentation Improvements<a class="headerlink" href="#documentation-improvements" title="Link to this heading">¶</a></h4>
<p>Contributed by:</p>
<ul class="simple">
<li><p>Adam Chainz</p></li>
<li><p>Amir Rustamzadeh</p></li>
<li><p>Arthur Vuillard</p></li>
<li><p>Batiste Bieler</p></li>
<li><p>Berker Peksag</p></li>
<li><p>Bryce Groff</p></li>
<li><p>Daniel Devine</p></li>
<li><p>Edward Betts</p></li>
<li><p>Jason Veatch</p></li>
<li><p>Jeff Widman</p></li>
<li><p>Maciej Obuchowski</p></li>
<li><p>Manuel Kaufmann</p></li>
<li><p>Maxime Beauchemin</p></li>
<li><p>Mitchel Humpherys</p></li>
<li><p>Pavlo Kapyshin</p></li>
<li><p>Pierre Fersing</p></li>
<li><p>Rik</p></li>
<li><p>Steven Sklar</p></li>
<li><p>Tayfun Sen</p></li>
<li><p>Wieland Hoffmann</p></li>
</ul>
</section>
</section>
</section>
<section id="reorganization-deprecations-and-removals">
<h2>Reorganization, Deprecations, and Removals<a class="headerlink" href="#reorganization-deprecations-and-removals" title="Link to this heading">¶</a></h2>
<section id="incompatible-changes">
<h3>Incompatible changes<a class="headerlink" href="#incompatible-changes" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Prefork: Calling <code class="docutils literal notranslate"><span class="pre">result.get()</span></code> or joining any result from within a task
now raises <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#RuntimeError" title="（在 Python v3.15）"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a>.</p>
<blockquote>
<div><p>In previous versions this would emit a warning.</p>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="../reference/celery.worker.consumer.html#module-celery.worker.consumer" title="celery.worker.consumer"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.worker.consumer</span></code></a> is now a package, not a module.</p></li>
<li><p>Module <code class="docutils literal notranslate"><span class="pre">celery.worker.job</span></code> renamed to <a class="reference internal" href="../reference/celery.worker.request.html#module-celery.worker.request" title="celery.worker.request"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.worker.request</span></code></a>.</p></li>
<li><p>Beat: <code class="docutils literal notranslate"><span class="pre">Scheduler.Publisher</span></code>/<code class="docutils literal notranslate"><span class="pre">.publisher</span></code> renamed to
<code class="docutils literal notranslate"><span class="pre">.Producer</span></code>/<code class="docutils literal notranslate"><span class="pre">.producer</span></code>.</p></li>
<li><p>Result: The task_name argument/attribute of <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">app.AsyncResult</span></code></a> was
removed.</p>
<blockquote>
<div><p>This was historically a field used for <a class="reference external" href="https://docs.python.org/dev/library/pickle.html#module-pickle" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> compatibility,
but is no longer needed.</p>
</div></blockquote>
</li>
<li><p>Backends: Arguments named <code class="docutils literal notranslate"><span class="pre">status</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">state</span></code>.</p></li>
<li><p>Backends: <code class="docutils literal notranslate"><span class="pre">backend.get_status()</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">backend.get_state()</span></code>.</p></li>
<li><p>Backends: <code class="docutils literal notranslate"><span class="pre">backend.maybe_reraise()</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">.maybe_throw()</span></code></p>
<blockquote>
<div><p>The promise API uses .throw(), so this change was made to make it more
consistent.</p>
<p>There's an alias available, so you can still use maybe_reraise until
Celery 5.0.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="unscheduled-removals">
<span id="v400-unscheduled-removals"></span><h3>Unscheduled Removals<a class="headerlink" href="#unscheduled-removals" title="Link to this heading">¶</a></h3>
<ul>
<li><p>The experimental <code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.contrib.methods</span></code> feature has been removed,
as there were far many bugs in the implementation to be useful.</p></li>
<li><p>The CentOS init-scripts have been removed.</p>
<blockquote>
<div><p>These didn't really add any features over the generic init-scripts,
so you're encouraged to use them instead, or something like
<a class="extlink-pypi reference external" href="https://pypi.org/project/supervisor/">https://pypi.org/project/supervisor/</a>.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="reorganization-deprecations">
<span id="v400-deprecations-reorg"></span><h3>Reorganization Deprecations<a class="headerlink" href="#reorganization-deprecations" title="Link to this heading">¶</a></h3>
<p>These symbols have been renamed, and while there's an alias available in this
version for backward compatibility, they will be removed in Celery 5.0, so
make sure you rename these ASAP to make sure it won't break for that release.</p>
<p>Chances are that you'll only use the first in this list, but you never
know:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.worker_direct</span></code> -&gt;
<a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.worker_direct" title="celery.utils.nodenames.worker_direct"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.worker_direct()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.nodename</span></code> -&gt; <a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.nodename" title="celery.utils.nodenames.nodename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.nodename()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.anon_nodename</span></code> -&gt;
<a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.anon_nodename" title="celery.utils.nodenames.anon_nodename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.anon_nodename()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.nodesplit</span></code> -&gt; <a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.nodesplit" title="celery.utils.nodenames.nodesplit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.nodesplit()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.default_nodename</span></code> -&gt;
<a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.default_nodename" title="celery.utils.nodenames.default_nodename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.default_nodename()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.node_format</span></code> -&gt; <a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.node_format" title="celery.utils.nodenames.node_format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.node_format()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.host_format</span></code> -&gt; <a class="reference internal" href="../internals/reference/celery.utils.nodenames.html#celery.utils.nodenames.host_format" title="celery.utils.nodenames.host_format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">celery.utils.nodenames.host_format()</span></code></a>.</p></li>
</ul>
</section>
<section id="scheduled-removals">
<span id="v400-removals"></span><h3>Scheduled Removals<a class="headerlink" href="#scheduled-removals" title="Link to this heading">¶</a></h3>
<section id="modules">
<h4>Modules<a class="headerlink" href="#modules" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Module <code class="docutils literal notranslate"><span class="pre">celery.worker.job</span></code> has been renamed to <a class="reference internal" href="../reference/celery.worker.request.html#module-celery.worker.request" title="celery.worker.request"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.worker.request</span></code></a>.</p>
<blockquote>
<div><p>This was an internal module so shouldn't have any effect.
It's now part of the public API so must not change again.</p>
</div></blockquote>
</li>
<li><p>Module <code class="docutils literal notranslate"><span class="pre">celery.task.trace</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">celery.app.trace</span></code>
as the <code class="docutils literal notranslate"><span class="pre">celery.task</span></code> package is being phased out. The module
will be removed in version 5.0 so please change any import from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.task.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">X</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.app.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">X</span>
</pre></div>
</div>
</li>
<li><p>Old compatibility aliases in the <a class="reference internal" href="../reference/celery.loaders.html#module-celery.loaders" title="celery.loaders"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.loaders</span></code></a> module
has been removed.</p>
<blockquote>
<div><ul class="simple">
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">celery.loaders.current_loader()</span></code>, use: <code class="docutils literal notranslate"><span class="pre">current_app.loader</span></code></p></li>
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">celery.loaders.load_settings()</span></code>, use: <code class="docutils literal notranslate"><span class="pre">current_app.conf</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="result">
<h4>Result<a class="headerlink" href="#result" title="Link to this heading">¶</a></h4>
<ul>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">AsyncResult.serializable()</span></code> and <code class="docutils literal notranslate"><span class="pre">celery.result.from_serializable</span></code></dt><dd><p>has been removed:</p>
<p>Use instead:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tup</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.result</span><span class="w"> </span><span class="kn">import</span> <span class="n">result_from_tuple</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">result_from_tuple</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">BaseAsyncResult</span></code>, use <code class="docutils literal notranslate"><span class="pre">AsyncResult</span></code> for instance checks
instead.</p></li>
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">TaskSetResult</span></code>, use <code class="docutils literal notranslate"><span class="pre">GroupResult</span></code> instead.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TaskSetResult.total</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">len(GroupResult)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TaskSetResult.taskset_id</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">GroupResult.id</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">ResultSet.subtasks</span></code>, use <code class="docutils literal notranslate"><span class="pre">ResultSet.results</span></code> instead.</p></li>
</ul>
</section>
<section id="taskset">
<h4>TaskSet<a class="headerlink" href="#taskset" title="Link to this heading">¶</a></h4>
<p>TaskSet has been removed, as it was replaced by the <code class="docutils literal notranslate"><span class="pre">group</span></code> construct in
Celery 3.0.</p>
<p>If you have code like this:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.task</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskSet</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">TaskSet</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">subtask</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
</pre></div>
</div>
<p>You need to replace that with:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">group</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">group</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">))()</span>
</pre></div>
</div>
</section>
<section id="id4">
<h4>Events<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Removals for class <a class="reference internal" href="../reference/celery.events.state.html#celery.events.state.Worker" title="celery.events.state.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">celery.events.state.Worker</span></code></a>:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker._defaults</span></code> attribute.</p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">{k:</span> <span class="pre">getattr(worker,</span> <span class="pre">k)</span> <span class="pre">for</span> <span class="pre">k</span> <span class="pre">in</span> <span class="pre">worker._fields}</span></code>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker.update_heartbeat</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Worker.event(None,</span> <span class="pre">timestamp,</span> <span class="pre">received)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker.on_online</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Worker.event('online',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker.on_offline</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Worker.event('offline',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Worker.on_heartbeat</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Worker.event('heartbeat',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Removals for class <a class="reference internal" href="../reference/celery.events.state.html#celery.events.state.Task" title="celery.events.state.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">celery.events.state.Task</span></code></a>:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Task._defaults</span></code> attribute.</p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">{k:</span> <span class="pre">getattr(task,</span> <span class="pre">k)</span> <span class="pre">for</span> <span class="pre">k</span> <span class="pre">in</span> <span class="pre">task._fields}</span></code>.</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_sent</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Worker.event('sent',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_received</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event('received',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_started</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event('started',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_failed</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event('failed',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_retried</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event('retried',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_succeeded</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event('succeeded',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_revoked</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event('revoked',</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.on_unknown_event</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event(short_type,</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.update</span></code></p>
<blockquote>
<div><p>Use <code class="docutils literal notranslate"><span class="pre">Task.event(short_type,</span> <span class="pre">timestamp,</span> <span class="pre">received,</span> <span class="pre">fields)</span></code></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Task.merge</span></code></p>
<blockquote>
<div><p>Contact us if you need this.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="magic-keyword-arguments">
<h4>Magic keyword arguments<a class="headerlink" href="#magic-keyword-arguments" title="Link to this heading">¶</a></h4>
<p>Support for the very old magic keyword arguments accepted by tasks is
finally removed in this version.</p>
<p>If you're still using these you have to rewrite any task still
using the old <code class="docutils literal notranslate"><span class="pre">celery.decorators</span></code> module and depending
on keyword arguments being passed to the task,
for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;My task id is </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,))</span>
</pre></div>
</div>
<p>should be rewritten into:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;My task id is </span><span class="si">{0.request.id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="removed-settings">
<h3>Removed Settings<a class="headerlink" href="#removed-settings" title="Link to this heading">¶</a></h3>
<p>The following settings have been removed, and is no longer supported:</p>
<section id="logging-settings">
<h4>Logging Settings<a class="headerlink" href="#logging-settings" title="Link to this heading">¶</a></h4>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Setting name</strong></p></th>
<th class="head"><p><strong>Replace with</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYD_LOG_LEVEL</span></code></p></td>
<td><p><a class="reference internal" href="../reference/cli.html#cmdoption-celery-worker-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">worker</span> <span class="pre">--loglevel</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYD_LOG_FILE</span></code></p></td>
<td><p><a class="reference internal" href="../reference/cli.html#cmdoption-celery-worker-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">worker</span> <span class="pre">--logfile</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_LOG_LEVEL</span></code></p></td>
<td><p><a class="reference internal" href="../reference/cli.html#cmdoption-celery-beat-l"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">beat</span> <span class="pre">--loglevel</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYBEAT_LOG_FILE</span></code></p></td>
<td><p><a class="reference internal" href="../reference/cli.html#cmdoption-celery-beat-f"><code class="xref std std-option docutils literal notranslate"><span class="pre">celery</span> <span class="pre">beat</span> <span class="pre">--logfile</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYMON_LOG_LEVEL</span></code></p></td>
<td><p>celerymon is deprecated, use flower</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYMON_LOG_FILE</span></code></p></td>
<td><p>celerymon is deprecated, use flower</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERYMON_LOG_FORMAT</span></code></p></td>
<td><p>celerymon is deprecated, use flower</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="task-settings">
<h4>Task Settings<a class="headerlink" href="#task-settings" title="Link to this heading">¶</a></h4>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Setting name</strong></p></th>
<th class="head"><p><strong>Replace with</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CELERY_CHORD_PROPAGATES</span></code></p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="changes-to-internal-api">
<h3>Changes to internal API<a class="headerlink" href="#changes-to-internal-api" title="Link to this heading">¶</a></h3>
<ul>
<li><p>Module <code class="docutils literal notranslate"><span class="pre">celery.datastructures</span></code> renamed to <a class="reference internal" href="../internals/reference/celery.utils.collections.html#module-celery.utils.collections" title="celery.utils.collections"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.utils.collections</span></code></a>.</p></li>
<li><p>Module <code class="docutils literal notranslate"><span class="pre">celery.utils.timeutils</span></code> renamed to <a class="reference internal" href="../internals/reference/celery.utils.time.html#module-celery.utils.time" title="celery.utils.time"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.utils.time</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.datastructures.DependencyGraph</span></code> moved to
<a class="reference internal" href="../internals/reference/celery.utils.graph.html#module-celery.utils.graph" title="celery.utils.graph"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery.utils.graph</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.jsonify</span></code> is now <code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.serialization.jsonify()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.strtobool</span></code> is now
<a class="reference internal" href="../internals/reference/celery.utils.serialization.html#celery.utils.serialization.strtobool" title="celery.utils.serialization.strtobool"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.serialization.strtobool()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.is_iterable</span></code> has been removed.</p>
<blockquote>
<div><p>Instead use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.lpmerge</span></code> is now <a class="reference internal" href="../internals/reference/celery.utils.collections.html#celery.utils.collections.lpmerge" title="celery.utils.collections.lpmerge"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.collections.lpmerge()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.cry</span></code> is now <code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.debug.cry()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.isatty</span></code> is now <a class="reference internal" href="../internals/reference/celery.platforms.html#celery.platforms.isatty" title="celery.platforms.isatty"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.platforms.isatty()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.gen_task_name</span></code> is now
<a class="reference internal" href="../internals/reference/celery.utils.imports.html#celery.utils.imports.gen_task_name" title="celery.utils.imports.gen_task_name"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.imports.gen_task_name()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.deprecated</span></code> is now <a class="reference internal" href="../internals/reference/celery.utils.deprecated.html#celery.utils.deprecated.Callable" title="celery.utils.deprecated.Callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.deprecated.Callable()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.deprecated_property</span></code> is now
<a class="reference internal" href="../internals/reference/celery.utils.deprecated.html#celery.utils.deprecated.Property" title="celery.utils.deprecated.Property"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.deprecated.Property()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">celery.utils.warn_deprecated</span></code> is now <a class="reference internal" href="../internals/reference/celery.utils.deprecated.html#celery.utils.deprecated.warn" title="celery.utils.deprecated.warn"><code class="xref py py-func docutils literal notranslate"><span class="pre">celery.utils.deprecated.warn()</span></code></a></p></li>
</ul>
</section>
</section>
<section id="deprecation-time-line-changes">
<span id="v400-deprecations"></span><h2>Deprecation Time-line Changes<a class="headerlink" href="#deprecation-time-line-changes" title="Link to this heading">¶</a></h2>
<p>See the <a class="reference internal" href="../internals/deprecation.html#deprecation-timeline"><span class="std std-ref">Celery 弃用时间表</span></a>.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="changelog-4.0.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Change history</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="changelog-4.1.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Change history</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2009-2023, Ask Solem &amp; contributors
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">What's new in Celery 4.0 (latentcall)</a><ul>
<li><a class="reference internal" href="#preface">Preface</a><ul>
<li><a class="reference internal" href="#wall-of-contributors">Wall of Contributors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-from-celery-3-1">Upgrading from Celery 3.1</a><ul>
<li><a class="reference internal" href="#step-1-upgrade-to-celery-3-1-25">Step 1: Upgrade to Celery 3.1.25</a></li>
<li><a class="reference internal" href="#step-2-update-your-configuration-with-the-new-setting-names">Step 2: Update your configuration with the new setting names</a></li>
<li><a class="reference internal" href="#step-3-read-the-important-notes-in-this-document">Step 3: Read the important notes in this document</a></li>
<li><a class="reference internal" href="#step-4-upgrade-to-celery-4-0">Step 4: Upgrade to Celery 4.0</a></li>
</ul>
</li>
<li><a class="reference internal" href="#important-notes">Important Notes</a><ul>
<li><a class="reference internal" href="#dropped-support-for-python-2-6">Dropped support for Python 2.6</a></li>
<li><a class="reference internal" href="#last-major-version-to-support-python-2">Last major version to support Python 2</a></li>
<li><a class="reference internal" href="#django-support">Django support</a></li>
<li><a class="reference internal" href="#removed-features">Removed features</a><ul>
<li><a class="reference internal" href="#features-removed-for-simplicity">Features removed for simplicity</a></li>
<li><a class="reference internal" href="#features-removed-for-lack-of-funding">Features removed for lack of funding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-task-message-protocol">New Task Message Protocol</a></li>
<li><a class="reference internal" href="#lowercase-setting-names">Lowercase setting names</a></li>
<li><a class="reference internal" href="#json-is-now-the-default-serializer">Json is now the default serializer</a></li>
<li><a class="reference internal" href="#the-task-base-class-no-longer-automatically-register-tasks">The Task base class no longer automatically register tasks</a></li>
<li><a class="reference internal" href="#task-argument-checking">Task argument checking</a></li>
<li><a class="reference internal" href="#redis-events-not-backward-compatible">Redis Events not backward compatible</a></li>
<li><a class="reference internal" href="#redis-priorities-reversed">Redis Priorities Reversed</a></li>
<li><a class="reference internal" href="#django-auto-discover-now-supports-django-app-configurations">Django: Auto-discover now supports Django app configurations</a></li>
<li><a class="reference internal" href="#worker-direct-queues-no-longer-use-auto-delete">Worker direct queues no longer use auto-delete</a></li>
<li><a class="reference internal" href="#old-command-line-programs-removed">Old command-line programs removed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#news">News</a><ul>
<li><a class="reference internal" href="#new-protocol-highlights">New protocol highlights</a></li>
<li><a class="reference internal" href="#prefork-pool-improvements">Prefork Pool Improvements</a><ul>
<li><a class="reference internal" href="#tasks-now-log-from-the-child-process">Tasks now log from the child process</a></li>
<li><a class="reference internal" href="#ofair-is-now-the-default-scheduling-strategy"><code class="docutils literal notranslate"><span class="pre">-Ofair</span></code> is now the default scheduling strategy</a></li>
<li><a class="reference internal" href="#limit-child-process-resident-memory-size">Limit child process resident memory size</a></li>
<li><a class="reference internal" href="#one-log-file-per-child-process">One log-file per child process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transports">Transports</a><ul>
<li><a class="reference internal" href="#rabbitmq-priority-queue-support">RabbitMQ priority queue support</a></li>
<li><a class="reference internal" href="#configure-broker-url-for-read-write-separately">Configure broker URL for read/write separately</a></li>
<li><a class="reference internal" href="#rabbitmq-queue-extensions-support">RabbitMQ queue extensions support</a></li>
<li><a class="reference internal" href="#amazon-sqs-transport-now-officially-supported">Amazon SQS transport now officially supported</a></li>
<li><a class="reference internal" href="#apache-qpid-transport-now-officially-supported">Apache QPid transport now officially supported</a></li>
</ul>
</li>
<li><a class="reference internal" href="#redis-support-for-sentinel">Redis: Support for Sentinel</a></li>
<li><a class="reference internal" href="#tasks">Tasks</a><ul>
<li><a class="reference internal" href="#task-auto-retry-decorator">Task Auto-retry Decorator</a></li>
<li><a class="reference internal" href="#task-replace-improvements"><code class="docutils literal notranslate"><span class="pre">Task.replace</span></code> Improvements</a></li>
<li><a class="reference internal" href="#remote-task-tracebacks">Remote Task Tracebacks</a></li>
<li><a class="reference internal" href="#handling-task-connection-errors">Handling task connection errors</a></li>
<li><a class="reference internal" href="#gevent-eventlet-dedicated-thread-for-consuming-results">Gevent/Eventlet: Dedicated thread for consuming results</a></li>
<li><a class="reference internal" href="#asyncresult-then-on-success-on-error"><code class="docutils literal notranslate"><span class="pre">AsyncResult.then(on_success,</span> <span class="pre">on_error)</span></code></a></li>
<li><a class="reference internal" href="#new-task-router-api">New Task Router API</a></li>
<li><a class="reference internal" href="#canvas-refactor">Canvas Refactor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#periodic-tasks">Periodic Tasks</a><ul>
<li><a class="reference internal" href="#new-api-for-configuring-periodic-tasks">New API for configuring periodic tasks</a></li>
<li><a class="reference internal" href="#optimized-beat-implementation">Optimized Beat implementation</a></li>
<li><a class="reference internal" href="#schedule-tasks-based-on-sunrise-sunset-dawn-and-dusk">Schedule tasks based on sunrise, sunset, dawn and dusk</a></li>
</ul>
</li>
<li><a class="reference internal" href="#result-backends">Result Backends</a><ul>
<li><a class="reference internal" href="#rpc-result-backend-matured">RPC Result Backend matured</a></li>
<li><a class="reference internal" href="#redis-result-backend-optimizations">Redis: Result backend optimizations</a><ul>
<li><a class="reference internal" href="#result-get-is-now-using-pub-sub-for-streaming-task-results"><code class="docutils literal notranslate"><span class="pre">result.get()</span></code> is now using pub/sub for streaming task results</a></li>
<li><a class="reference internal" href="#new-optimized-chord-join-implementation">New optimized chord join implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-riak-result-backend-introduced">New Riak result backend introduced</a></li>
<li><a class="reference internal" href="#new-couchdb-result-backend-introduced">New CouchDB result backend introduced</a></li>
<li><a class="reference internal" href="#new-consul-result-backend-introduced">New Consul result backend introduced</a></li>
<li><a class="reference internal" href="#brand-new-cassandra-result-backend">Brand new Cassandra result backend</a></li>
<li><a class="reference internal" href="#new-elasticsearch-result-backend-introduced">New Elasticsearch result backend introduced</a></li>
<li><a class="reference internal" href="#new-file-system-result-backend-introduced">New File-system result backend introduced</a></li>
</ul>
</li>
<li><a class="reference internal" href="#event-batching">Event Batching</a></li>
<li><a class="reference internal" href="#in-other-news">In Other News...</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#id1">Tasks</a></li>
<li><a class="reference internal" href="#beat">Beat</a></li>
<li><a class="reference internal" href="#app">App</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#execution-pools">Execution Pools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#id2">Transports</a></li>
<li><a class="reference internal" href="#programs">Programs</a></li>
<li><a class="reference internal" href="#worker">Worker</a></li>
<li><a class="reference internal" href="#debugging-utilities">Debugging Utilities</a></li>
<li><a class="reference internal" href="#signals">Signals</a></li>
<li><a class="reference internal" href="#events">Events</a></li>
<li><a class="reference internal" href="#deployment">Deployment</a></li>
<li><a class="reference internal" href="#id3">Result Backends</a></li>
<li><a class="reference internal" href="#documentation-improvements">Documentation Improvements</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#reorganization-deprecations-and-removals">Reorganization, Deprecations, and Removals</a><ul>
<li><a class="reference internal" href="#incompatible-changes">Incompatible changes</a></li>
<li><a class="reference internal" href="#unscheduled-removals">Unscheduled Removals</a></li>
<li><a class="reference internal" href="#reorganization-deprecations">Reorganization Deprecations</a></li>
<li><a class="reference internal" href="#scheduled-removals">Scheduled Removals</a><ul>
<li><a class="reference internal" href="#modules">Modules</a></li>
<li><a class="reference internal" href="#result">Result</a></li>
<li><a class="reference internal" href="#taskset">TaskSet</a></li>
<li><a class="reference internal" href="#id4">Events</a></li>
<li><a class="reference internal" href="#magic-keyword-arguments">Magic keyword arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#removed-settings">Removed Settings</a><ul>
<li><a class="reference internal" href="#logging-settings">Logging Settings</a></li>
<li><a class="reference internal" href="#task-settings">Task Settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes-to-internal-api">Changes to internal API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deprecation-time-line-changes">Deprecation Time-line Changes</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=8156d91f"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=5eb1bb1e"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>