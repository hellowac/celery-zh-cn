<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="copyright" title="版权所有" href="copyright.html" /><link rel="next" title="更改历史" href="changelog.html" /><link rel="prev" title="Task Cookbook" href="tutorials/task-cookbook.html" />

    <link rel="shortcut icon" href="_static/favicon.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>常见问题 - Celery 5.5.1 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=3ee1c6c6" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/my.css?v=112ca36d" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Celery 5.5.1 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/celery_512_1.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Celery 5.5.1 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">版权</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="getting-started/index.html">快速开始</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 快速开始</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started/introduction.html">Celery 简介</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="getting-started/backends-and-brokers/index.html">Backends 和 Brokers</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Backends 和 Brokers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="getting-started/backends-and-brokers/rabbitmq.html">使用 RabbitMQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting-started/backends-and-brokers/redis.html">使用 Redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting-started/backends-and-brokers/sqs.html">使用 Amazon SQS</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting-started/backends-and-brokers/kafka.html">使用 Kafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting-started/backends-and-brokers/gcpubsub.html">使用 Google Pub/Sub</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="getting-started/first-steps-with-celery.html">使用 Celery 的第一步</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started/next-steps.html">下一步</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started/resources.html">资源</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="userguide/index.html">用户指南</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 用户指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="userguide/application.html">应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/tasks.html">任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/calling.html">调用任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/canvas.html">Canvas：设计工作流</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/workers.html">Workers 指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/daemonizing.html">守护进程</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/periodic-tasks.html">周期性任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/routing.html">路由任务/Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/monitoring.html">监控和管理指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/security.html">安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/optimizing.html">优化</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/debugging.html">调试</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="userguide/concurrency/index.html">并发</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 并发</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="userguide/concurrency/eventlet.html">Eventlet 并发</a></li>
<li class="toctree-l3"><a class="reference internal" href="userguide/concurrency/gevent.html">gevent 并发</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="userguide/signals.html">信号</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/testing.html">使用 Celery 进行测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/extending.html">扩展 和 Bootsteps</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/configuration.html">配置和默认值</a></li>
<li class="toctree-l2"><a class="reference internal" href="userguide/sphinx.html">使用 Sphinx 文档化任务</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="django/index.html">Django</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Django</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="django/first-steps-with-django.html">使用 Django 的第一步</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">社区资源</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials/index.html">教程</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials/task-cookbook.html">Task Cookbook</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">更改历史</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference/index.html">API 参考</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API 参考</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/cli.html">命令行接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">celery</span></code> --- Distributed processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.html">Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.task.html"><code class="docutils literal notranslate"><span class="pre">celery.app.task</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.amqp.html">AMQP</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.amqp.html#queues">Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.defaults.html"><code class="docutils literal notranslate"><span class="pre">celery.app.defaults</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.control.html"><code class="docutils literal notranslate"><span class="pre">celery.app.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.registry.html"><code class="docutils literal notranslate"><span class="pre">celery.app.registry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.backends.html"><code class="docutils literal notranslate"><span class="pre">celery.app.backends</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.builtins.html"><code class="docutils literal notranslate"><span class="pre">celery.app.builtins</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.events.html"><code class="docutils literal notranslate"><span class="pre">celery.app.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.log.html"><code class="docutils literal notranslate"><span class="pre">celery.app.log</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.app.utils</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.app.autoretry.html"><code class="docutils literal notranslate"><span class="pre">celery.app.autoretry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bootsteps.html"><code class="docutils literal notranslate"><span class="pre">celery.bootsteps</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.result.html"><code class="docutils literal notranslate"><span class="pre">celery.result</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.schedules.html"><code class="docutils literal notranslate"><span class="pre">celery.schedules</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.signals.html"><code class="docutils literal notranslate"><span class="pre">celery.signals</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.security.html"><code class="docutils literal notranslate"><span class="pre">celery.security</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.utils.debug.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.debug</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.exceptions.html"><code class="docutils literal notranslate"><span class="pre">celery.exceptions</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.loaders.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.loaders.app.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.app</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.loaders.default.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.default</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.loaders.base.html"><code class="docutils literal notranslate"><span class="pre">celery.loaders.base</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html">States</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#sets">Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#misc">Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.FAILURE"><code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.PENDING"><code class="docutils literal notranslate"><span class="pre">PENDING</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.RECEIVED"><code class="docutils literal notranslate"><span class="pre">RECEIVED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.RETRY"><code class="docutils literal notranslate"><span class="pre">RETRY</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.REVOKED"><code class="docutils literal notranslate"><span class="pre">REVOKED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.STARTED"><code class="docutils literal notranslate"><span class="pre">STARTED</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.SUCCESS"><code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.precedence"><code class="docutils literal notranslate"><span class="pre">precedence()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.states.html#celery.states.state"><code class="docutils literal notranslate"><span class="pre">state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.abortable.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.abortable</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.django.task.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.django.task</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.migrate.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.migrate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.pytest.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.pytest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.sphinx.html">celery.contrib.sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.testing.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.testing.app.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.app</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.testing.manager.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.manager</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.testing.mocks.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.testing.mocks</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.contrib.rdb.html"><code class="docutils literal notranslate"><span class="pre">celery.contrib.rdb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.events.html"><code class="docutils literal notranslate"><span class="pre">celery.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.events.receiver.html"><code class="docutils literal notranslate"><span class="pre">celery.events.receiver</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.events.dispatcher.html"><code class="docutils literal notranslate"><span class="pre">celery.events.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.events.event.html"><code class="docutils literal notranslate"><span class="pre">celery.events.event</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.events.state.html"><code class="docutils literal notranslate"><span class="pre">celery.events.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.apps.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.apps.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.apps.multi.html"><code class="docutils literal notranslate"><span class="pre">celery.apps.multi</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.request.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.request</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.state.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.strategy.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.strategy</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.agent.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.agent</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.connection.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.connection</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.consumer.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.consumer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.control.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.events.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.gossip.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.gossip</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.heart.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.heart</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.mingle.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.mingle</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.consumer.tasks.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.consumer.tasks</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.worker.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.base.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.base</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.celery.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.celery</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.worker.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.worker</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.beat.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.beat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.events.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.events</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.logtool.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.logtool</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.amqp.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.amqp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.graph.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.graph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.multi.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.multi</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.call.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.call</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.control.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.control</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.list.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.list</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.migrate.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.migrate</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.purge.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.purge</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.result.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.result</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.shell.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.shell</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/celery.bin.upgrade.html"><code class="docutils literal notranslate"><span class="pre">celery.bin.upgrade</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="internals/index.html">内部</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="internals/guide.html">代码贡献指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals/deprecation.html">Celery 弃用时间表</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals/worker.html">内部的 worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals/protocol.html">消息协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals/app-overview.html">“大实例”重构</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="internals/reference/index.html">内部模块参考</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 内部模块参考</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.worker.components.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.components</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.worker.loops.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.loops</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.worker.heartbeat.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.heartbeat</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.worker.control.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.control</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.worker.pidbox.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.pidbox</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.worker.autoscale.html"><code class="docutils literal notranslate"><span class="pre">celery.worker.autoscale</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.solo.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.solo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.prefork.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.prefork</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.eventlet.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.eventlet</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.gevent.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.gevent</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.thread.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.thread</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.concurrency.base.html"><code class="docutils literal notranslate"><span class="pre">celery.concurrency.base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.html"><code class="docutils literal notranslate"><span class="pre">celery.backends</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.base.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.base</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.asynchronous.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.asynchronous</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.azureblockblob.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.azureblockblob</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.rpc.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.rpc</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.database.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.cache.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cache</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.consul.html">celery.backends.consul</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.couchdb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.couchdb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.mongodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.mongodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.elasticsearch.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.elasticsearch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.redis.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.redis</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.cassandra.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cassandra</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.couchbase.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.couchbase</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.arangodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.arangodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.dynamodb.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.dynamodb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.filesystem.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.filesystem</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.cosmosdbsql.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.cosmosdbsql</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.s3.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.s3</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.gcs.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.gcs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.app.trace.html"><code class="docutils literal notranslate"><span class="pre">celery.app.trace</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.app.annotations.html"><code class="docutils literal notranslate"><span class="pre">celery.app.annotations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.app.routes.html"><code class="docutils literal notranslate"><span class="pre">celery.app.routes</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.security.certificate.html"><code class="docutils literal notranslate"><span class="pre">celery.security.certificate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.security.key.html"><code class="docutils literal notranslate"><span class="pre">celery.security.key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.security.serialization.html"><code class="docutils literal notranslate"><span class="pre">celery.security.serialization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.security.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.security.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.events.snapshot.html"><code class="docutils literal notranslate"><span class="pre">celery.events.snapshot</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.events.cursesmon.html"><code class="docutils literal notranslate"><span class="pre">celery.events.cursesmon</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.events.dumper.html"><code class="docutils literal notranslate"><span class="pre">celery.events.dumper</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.database.models.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database.models</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.backends.database.session.html"><code class="docutils literal notranslate"><span class="pre">celery.backends.database.session</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.html"><code class="docutils literal notranslate"><span class="pre">celery.utils</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.abstract.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.abstract</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.collections.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.collections</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.nodenames.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.nodenames</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.deprecated.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.functional.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.functional</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.graph.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.graph</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.objects.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.objects</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.term.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.term</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.time.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.iso8601.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.iso8601</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.saferepr.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.saferepr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.serialization.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.serialization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.sysinfo.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.sysinfo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.threads.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.threads</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.timer2.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.timer2</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.imports.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.imports</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.log.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.log</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.text.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.text</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.dispatch.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.dispatch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.utils.dispatch.signal.html"><code class="docutils literal notranslate"><span class="pre">celery.utils.dispatch.signal</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery.platforms.html"><code class="docutils literal notranslate"><span class="pre">celery.platforms</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="internals/reference/celery._state.html"><code class="docutils literal notranslate"><span class="pre">celery._state</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="history/index.html">历史</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 历史</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-5.5.html">What's new in Celery 5.5 (Immunity)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-5.5.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-5.4.html">What's new in Celery 5.4 (Opalescent)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-5.4.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-5.3.html">What's new in Celery 5.3 (Emerald Rush)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-5.3.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-5.1.html">What's new in Celery 5.1 (Sun Harmonics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-5.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-5.0.html">What's new in Celery 5.0 (singularity)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-5.0.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-4.4.html">What's new in Celery 4.4 (Cliffs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-4.4.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-4.3.html">What's new in Celery 4.3 (rhubarb)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-4.3.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-4.2.html">What's new in Celery 4.2 (windowlicker)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-4.2.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-4.1.html">What's new in Celery 4.1 (latentcall)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-4.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-4.0.html">What's new in Celery 4.0 (latentcall)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-4.0.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-3.1.html">What's new in Celery 3.1 (Cipater)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-3.1.html">Change history</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-3.0.html">What's new in Celery 3.0 (Chiastic Slide)</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-3.0.html">Change history for Celery 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/whatsnew-2.5.html">What's new in Celery 2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-2.5.html">Change history for Celery 2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-2.4.html">Change history for Celery 2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-2.3.html">Change history for Celery 2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-2.2.html">Change history for Celery 2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-2.1.html">Change history for Celery 2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-2.0.html">Change history for Celery 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="history/changelog-1.0.html">Change history for Celery 1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">术语</a></li>
</ul>

</div>
<!-- <iframe src="https://ghbtns.com/github-btn.html?user=celery&repo=celery&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe> -->
<div id="donate">
  <h5>捐赠</h5>
  <p>请捐赠以支持这个社区项目</p>
  <a href="https://opencollective.com/celery/donate" target="_blank">
    <!-- <img src="https://opencollective.com/celery/donate/button@2x.png?color=blue" /> -->
    <img src="https://opencollective.com/celery/donate/button.png?color=blue" />
  </a>
</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/faq.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="faq">
<span id="id1"></span><h1>常见问题<a class="headerlink" href="#faq" title="Link to this heading">¶</a></h1>
<p>Frequently Asked Questions</p>
<section id="faq-general">
<span id="id2"></span><h2>常见<a class="headerlink" href="#faq-general" title="Link to this heading">¶</a></h2>
<p>General</p>
<section id="what-kinds-of-things-should-i-use-celery-for">
<span id="faq-when-to-use"></span><h3>What kinds of things should I use Celery for?<a class="headerlink" href="#what-kinds-of-things-should-i-use-celery-for" title="Link to this heading">¶</a></h3>
<p>What kinds of things should I use Celery for?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> <a class="reference external" href="https://decafbad.com/blog/2008/07/04/queue-everything-and-delight-everyone">Queue everything and delight everyone</a> 是一篇很好的文章，
描述了为什么在 Web 环境中要使用队列。</p>
<p>以下是一些常见的使用场景：</p>
<ul class="simple">
<li><p>在后台运行任务。例如，为了尽快完成 Web 请求，然后逐步更新用户页面。这样即使真正的处理需要一些时间，也会给用户带来性能良好、响应迅速的印象。</p></li>
<li><p>在 Web 请求完成后再运行某些任务。</p></li>
<li><p>通过异步执行并使用重试机制，确保某件事最终会完成。</p></li>
<li><p>定期调度任务。</p></li>
</ul>
<p>在某种程度上还包括：</p>
<ul class="simple">
<li><p>分布式计算。</p></li>
<li><p>并行执行。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> <a class="reference external" href="https://decafbad.com/blog/2008/07/04/queue-everything-and-delight-everyone">Queue everything and delight everyone</a> is a good article
describing why you'd use a queue in a web context.</p>
<p>These are some common use cases:</p>
<ul class="simple">
<li><p>Running something in the background. For example, to finish the web request
as soon as possible, then update the users page incrementally.
This gives the user the impression of good performance and &quot;snappiness&quot;, even
though the real work might actually take some time.</p></li>
<li><p>Running something after the web request has finished.</p></li>
<li><p>Making sure something is done, by executing it asynchronously and using</p></li>
</ul>
<p>retries.</p>
<ul class="simple">
<li><p>Scheduling periodic work.</p></li>
</ul>
<p>And to some degree:</p>
<ul class="simple">
<li><p>Distributed computing.</p></li>
<li><p>Parallel execution.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="faq-misconceptions">
<span id="id3"></span><h2>误解<a class="headerlink" href="#faq-misconceptions" title="Link to this heading">¶</a></h2>
<p>Misconceptions</p>
<section id="celery-50-000">
<span id="faq-loc"></span><h3>Celery 真的由 50,000 行代码组成吗？<a class="headerlink" href="#celery-50-000" title="Link to this heading">¶</a></h3>
<p>Does Celery really consist of 50.000 lines of code?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 不，这样的大数字在多个地方都有报告。</p>
<p>截至目前的代码行数如下：</p>
<blockquote>
<div><ul class="simple">
<li><p>核心代码：7,141 行。</p></li>
<li><p>测试代码：14,209 行。</p></li>
<li><p>后端、contrib、兼容性工具等：9,032 行。</p></li>
</ul>
</div></blockquote>
<p>代码行数并不是一个有用的度量标准，
即使 Celery 包含了 5 万行代码，你也无法从这个数字得出任何结论。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> No, this and similarly large numbers have
been reported at various locations.</p>
<p>The numbers as of this writing are:</p>
<blockquote>
<div><ul class="simple">
<li><p>core: 7,141 lines of code.</p></li>
<li><p>tests: 14,209 lines.</p></li>
<li><p>backends, contrib, compat utilities: 9,032 lines.</p></li>
</ul>
</div></blockquote>
<p>Lines of code isn't a useful metric, so
even if Celery did consist of 50k lines of code you wouldn't
be able to draw any conclusions from such a number.</p>
</div>
</div>
</section>
<section id="celery">
<h3>Celery 依赖项多吗？<a class="headerlink" href="#celery" title="Link to this heading">¶</a></h3>
<p>Does Celery have many dependencies?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>一个常见的批评是 Celery 使用了过多的依赖项。
这种担忧的合理性很难理解，尤其是考虑到代码重用已成为现代软件开发中对抗复杂性的既定方式，
而且由于 pip 和 PyPI 等软件包管理器的存在，安装和维护依赖项的成本现在已经非常低，几乎可以忽略不计。</p>
<p>Celery 在发展过程中已经替换了若干依赖项，当前的依赖列表如下：</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>A common criticism is that Celery uses too many dependencies.
The rationale behind such a fear is hard to imagine, especially considering
code reuse as the established way to combat complexity in modern software
development, and that the cost of adding dependencies is very low now
that package managers like pip and PyPI makes the hassle of installing
and maintaining dependencies a thing of the past.</p>
<p>Celery has replaced several dependencies along the way, and
the current list of dependencies are:</p>
</div>
</div>
<section id="id4">
<h4>celery<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<p>celery</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<ul>
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/kombu/">https://pypi.org/project/kombu/</a></p>
<p>Kombu 是 Celery 生态系统的一部分，是用于发送和接收消息的库。
它也是支持多种消息代理的关键所在。
Kombu 同样被 OpenStack 项目和许多其他项目所使用，验证了将其从 Celery 代码库中独立出来的选择是正确的。</p>
</li>
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/billiard/">https://pypi.org/project/billiard/</a></p>
<p>Billiard 是 Python <cite>multiprocessing</cite> 模块的一个分支，包含了许多性能和稳定性的改进。
我们的最终目标是将这些改进回合并到 Python 官方代码中。</p>
<p>它还用于兼容不自带 <cite>multiprocessing</cite> 模块的旧版本 Python。</p>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<ul>
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/kombu/">https://pypi.org/project/kombu/</a></p>
<p>Kombu is part of the Celery ecosystem and is the library used
to send and receive messages. It's also the library that enables
us to support many different message brokers. It's also used by the
OpenStack project, and many others, validating the choice to separate
it from the Celery code-base.</p>
</li>
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/billiard/">https://pypi.org/project/billiard/</a></p>
<p>Billiard is a fork of the Python multiprocessing module containing
many performance and stability improvements. It's an eventual goal
that these improvements will be merged back into Python one day.</p>
<p>It's also used for compatibility with older Python versions
that don't come with the multiprocessing module.</p>
</li>
</ul>
</div>
</div>
</section>
<section id="kombu">
<h4>kombu<a class="headerlink" href="#kombu" title="Link to this heading">¶</a></h4>
<p>kombu</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>Kombu 依赖以下软件包：</p>
<ul>
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/amqp/">https://pypi.org/project/amqp/</a></p>
<p>底层的纯 Python AMQP 客户端实现。由于 AMQP 是默认的代理协议，因此这是一个自然的依赖项。</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>为了便于处理常见配置的依赖项，Celery 定义了多个“捆绑包”（bundle package），
参见 <a class="reference internal" href="getting-started/introduction.html#bundles"><span class="std std-ref">软件包</span></a>。</p>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>Kombu depends on the following packages:</p>
<ul>
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/amqp/">https://pypi.org/project/amqp/</a></p>
<p>The underlying pure-Python amqp client implementation. AMQP being the default
broker this is a natural dependency.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>To handle the dependencies for popular configuration
choices Celery defines a number of &quot;bundle&quot; packages,
see <a class="reference internal" href="getting-started/introduction.html#bundles"><span class="std std-ref">软件包</span></a>.</p>
</div>
</div>
</div>
</section>
</section>
<section id="faq-heavyweight">
<span id="id5"></span><h3>Celery 是重量级的吗？<a class="headerlink" href="#faq-heavyweight" title="Link to this heading">¶</a></h3>
<p>Is Celery heavy-weight?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>Celery 在内存占用和性能方面带来的开销都非常小。</p>
<p>但请注意，默认配置并未针对时间或空间进行优化，
详情请参见 <a class="reference internal" href="userguide/optimizing.html#guide-optimizing"><span class="std std-ref">优化</span></a> 指南。</p>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>Celery poses very little overhead both in memory footprint and
performance.</p>
<p>But please note that the default configuration isn't optimized for time nor
space, see the <a class="reference internal" href="userguide/optimizing.html#guide-optimizing"><span class="std std-ref">优化</span></a> guide for more information.</p>
</div>
</div>
</section>
<section id="celery-pickle">
<span id="faq-serialization-is-a-choice"></span><h3>Celery 依赖于 pickle 吗？<a class="headerlink" href="#celery-pickle" title="Link to this heading">¶</a></h3>
<p>Is Celery dependent on pickle?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 不，Celery 可以支持任何序列化方案。</p>
<p>我们内置支持 JSON、YAML、Pickle 和 msgpack。
每个任务都关联一个内容类型，因此你甚至可以让一个任务使用 Pickle，另一个使用 JSON。</p>
<p>默认的序列化格式过去是 Pickle，但从 4.0 版本开始，默认已改为 JSON。
如果你需要将复杂的 Python 对象作为任务参数发送，可以使用 Pickle 作为序列化格式，
但请参考 <a class="reference internal" href="userguide/security.html#security-serializers"><span class="std std-ref">序列化器</span></a> 中的相关安全说明。</p>
<p>如果你需要与其他语言通信，应使用适合该目的的序列化格式，也就是说，基本上除了 Pickle 以外的任何格式。</p>
<p>你可以设置一个全局默认序列化器、特定任务的默认序列化器，甚至是在发送某个任务实例时使用的序列化器。</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> No, Celery can support any serialization scheme.</p>
<p>We have built-in support for JSON, YAML, Pickle, and msgpack.
Every task is associated with a content type, so you can even send one task using pickle,
another using JSON.</p>
<p>The default serialization support used to be pickle, but since 4.0 the default
is now JSON.  If you require sending complex Python objects as task arguments,
you can use pickle as the serialization format, but see notes in
<a class="reference internal" href="userguide/security.html#security-serializers"><span class="std std-ref">序列化器</span></a>.</p>
<p>If you need to communicate with other languages you should use
a serialization format suited to that task, which pretty much means any
serializer that's not pickle.</p>
<p>You can set a global default serializer, the default serializer for a
particular Task, or even what serializer to use when sending a single task
instance.</p>
</div>
</div>
</section>
<section id="celery-django">
<span id="faq-is-celery-for-django-only"></span><h3>Celery 只适用于 Django 吗？<a class="headerlink" href="#celery-django" title="Link to this heading">¶</a></h3>
<p>Is Celery for Django only?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 不，Celery 可以配合任何框架使用，无论是 Web 框架还是其他类型框架。</p>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> No, you can use Celery with any framework, web or otherwise.</p>
</div>
</div>
</section>
<section id="amqp-rabbitmq">
<span id="faq-is-celery-for-rabbitmq-only"></span><h3>我必须使用 AMQP/RabbitMQ 吗？<a class="headerlink" href="#amqp-rabbitmq" title="Link to this heading">¶</a></h3>
<p>Do I have to use AMQP/RabbitMQ?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 不，虽然推荐使用 RabbitMQ，但你也可以使用 Redis、SQS 或 Qpid。</p>
<p>参见 <a class="reference internal" href="getting-started/backends-and-brokers/index.html#brokers"><span class="std std-ref">Backends 和 Brokers</span></a> 了解更多信息。</p>
<p>使用 Redis 作为 broker 的性能不如 AMQP broker，
但将 RabbitMQ 用作消息代理、Redis 用作结果存储的组合是很常见的做法。
如果你对可靠性有严格要求，建议使用 RabbitMQ 或其他 AMQP broker。
一些传输方案采用轮询机制，因此可能会消耗更多资源。
但如果由于某些原因你无法使用 AMQP，完全可以使用这些替代方案。
它们在大多数用例中都能良好运行。需要注意的是，以上讨论并非 Celery 特有；
如果你之前使用 Redis/数据库作为队列没有问题，现在也应该不会有问题。
如果将来有需要，你随时可以升级。</p>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: No, although using RabbitMQ is recommended you can also
use Redis, SQS, or Qpid.</p>
<p>See <a class="reference internal" href="getting-started/backends-and-brokers/index.html#brokers"><span class="std std-ref">Backends 和 Brokers</span></a> for more information.</p>
<p>Redis as a broker won't perform as well as
an AMQP broker, but the combination RabbitMQ as broker and Redis as a result
store is commonly used. If you have strict reliability requirements you're
encouraged to use RabbitMQ or another AMQP broker. Some transports also use
polling, so they're likely to consume more resources. However, if you for
some reason aren't able to use AMQP, feel free to use these alternatives.
They will probably work fine for most use cases, and note that the above
points are not specific to Celery; If using Redis/database as a queue worked
fine for you before, it probably will now. You can always upgrade later
if you need to.</p>
</div>
</div>
</section>
<section id="faq-is-celery-multilingual">
<span id="id6"></span><h3>Celery 支持多种语言吗？<a class="headerlink" href="#faq-is-celery-multilingual" title="Link to this heading">¶</a></h3>
<p>Is Celery multilingual?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 可以。</p>
<p><a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a> 是用 Python 编写的 Celery Worker 实现。
如果某个语言有 AMQP 客户端，那么在该语言中创建一个 Worker 所需的工作并不多。
一个 Celery Worker 本质上就是一个连接到消息代理以处理消息的程序。</p>
<p>此外，还有一种更独立于语言的方式，那就是使用 REST 任务。
任务不再是函数，而是 URL。
有了这个信息，你甚至可以创建简单的 Web 服务器来预加载代码：
只需暴露一个执行操作的端点，并创建一个任务来对该端点发起 HTTP 请求即可。</p>
<p>你也可以使用 <a class="reference external" href="https://flower.readthedocs.io">Flower</a> 提供的 <a class="reference external" href="https://flower.readthedocs.io/en/latest/api.html#post--api-task-async-apply-(.+)">REST API</a> 来调用任务。</p>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> Yes.</p>
<p><a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a> is an implementation of Celery in Python. If the
language has an AMQP client, there shouldn't be much work to create a worker
in your language. A Celery worker is just a program connecting to the broker
to process messages.</p>
<p>Also, there's another way to be language-independent, and that's to use REST
tasks, instead of your tasks being functions, they're URLs. With this
information you can even create simple web servers that enable preloading of
code. Simply expose an endpoint that performs an operation, and create a task
that just performs an HTTP request to that endpoint.</p>
<p>You can also use <a class="reference external" href="https://flower.readthedocs.io">Flower's</a> <a class="reference external" href="https://flower.readthedocs.io/en/latest/api.html#post--api-task-async-apply-(.+)">REST API</a> to invoke tasks.</p>
</div>
</div>
</section>
</section>
<section id="faq-troubleshooting">
<span id="id8"></span><h2>故障排除<a class="headerlink" href="#faq-troubleshooting" title="Link to this heading">¶</a></h2>
<p>Troubleshooting</p>
<section id="mysql">
<span id="faq-mysql-deadlocks"></span><h3>MySQL 抛出死锁错误，我该怎么办？<a class="headerlink" href="#mysql" title="Link to this heading">¶</a></h3>
<p>MySQL is throwing deadlock errors, what can I do?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> MySQL 的默认隔离级别是 <cite>REPEATABLE-READ</cite>，
如果你不需要这么高的隔离性，可以将其设置为 <cite>READ-COMMITTED</cite>。
你可以通过在 <code class="file docutils literal notranslate"><span class="pre">my.cnf</span></code> 中添加以下内容来实现这一设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mysqld</span><span class="p">]</span>
<span class="n">transaction</span><span class="o">-</span><span class="n">isolation</span> <span class="o">=</span> <span class="n">READ</span><span class="o">-</span><span class="n">COMMITTED</span>
</pre></div>
</div>
<p>关于 InnoDB 的事务模型的更多信息，请参阅 MySQL 用户手册中的 <a class="reference external" href="https://dev.mysql.com/doc/refman/5.1/en/innodb-transaction-model.html">MySQL - The InnoDB Transaction Model and Locking</a>。</p>
<p>（感谢 Honza Kral 和 Anton Tsigularov 提供该方案）</p>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> MySQL has default isolation level set to <cite>REPEATABLE-READ</cite>,
if you don't really need that, set it to <cite>READ-COMMITTED</cite>.
You can do that by adding the following to your <code class="file docutils literal notranslate"><span class="pre">my.cnf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mysqld</span><span class="p">]</span>
<span class="n">transaction</span><span class="o">-</span><span class="n">isolation</span> <span class="o">=</span> <span class="n">READ</span><span class="o">-</span><span class="n">COMMITTED</span>
</pre></div>
</div>
<p>For more information about InnoDB’s transaction model see <a class="reference external" href="https://dev.mysql.com/doc/refman/5.1/en/innodb-transaction-model.html">MySQL - The InnoDB
Transaction Model and Locking</a> in the MySQL user manual.</p>
<p>(Thanks to Honza Kral and Anton Tsigularov for this solution)</p>
</div>
</div>
</section>
<section id="faq-worker-hanging">
<span id="id9"></span><h3>工作线程什么都没做，只是挂了<a class="headerlink" href="#faq-worker-hanging" title="Link to this heading">¶</a></h3>
<p>The worker isn't doing anything, just hanging</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 请参见 <a href="#id37"><span class="problematic" id="id38">`MySQL is throwing deadlock errors, what can I do?`_</span></a>，或
<a href="#id39"><span class="problematic" id="id40">`Why is Task.delay/apply\*/the worker just hanging?`_</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> See <a href="#id41"><span class="problematic" id="id42">`MySQL is throwing deadlock errors, what can I do?`_</span></a>,
or <a href="#id43"><span class="problematic" id="id44">`Why is Task.delay/apply\*/the worker just hanging?`_</span></a>.</p>
</div>
</div>
</section>
<section id="faq-results-unreliable">
<span id="id10"></span><h3>任务结果无法可靠返回<a class="headerlink" href="#faq-results-unreliable" title="Link to this heading">¶</a></h3>
<p>Task results aren't reliably returning</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 如果你使用数据库后端来存储结果，特别是使用 MySQL，
请参见 <a href="#id45"><span class="problematic" id="id46">`MySQL is throwing deadlock errors, what can I do?`_</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> If you're using the database backend for results, and in particular
using MySQL, see <a href="#id47"><span class="problematic" id="id48">`MySQL is throwing deadlock errors, what can I do?`_</span></a>.</p>
</div>
</div>
</section>
<section id="task-delay-apply">
<span id="faq-publish-hanging"></span><h3>为什么 Task.delay/apply*/ 工作线程挂了？<a class="headerlink" href="#task-delay-apply" title="Link to this heading">¶</a></h3>
<p>Why is Task.delay/apply*/the worker just hanging?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--13-input--1" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 某些 AMQP 客户端存在一个 bug，当它无法验证当前用户身份、密码错误，
或用户没有访问指定虚拟主机的权限时，可能会导致挂起。
请务必检查你的消息代理日志（RabbitMQ 的日志通常位于大多数系统的 <code class="file docutils literal notranslate"><span class="pre">/var/log/rabbitmq/rabbit.log</span></code>），
通常会包含描述问题原因的消息。</p>
</div>
<input class="tab-input" id="tab-set--13-input--2" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> There's a bug in some AMQP clients that'll make it hang if
it's not able to authenticate the current user, the password doesn't match or
the user doesn't have access to the virtual host specified. Be sure to check
your broker logs (for RabbitMQ that's <code class="file docutils literal notranslate"><span class="pre">/var/log/rabbitmq/rabbit.log</span></code> on
most systems), it usually contains a message describing the reason.</p>
</div>
</div>
</section>
<section id="freebsd">
<span id="faq-worker-on-freebsd"></span><h3>它在 FreeBSD 上能正常工作吗？<a class="headerlink" href="#freebsd" title="Link to this heading">¶</a></h3>
<p>Does it work on FreeBSD?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--14-input--1" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 视情况而定；</p>
<p>当使用 RabbitMQ（AMQP）或 Redis 传输时，应该可以开箱即用。</p>
<p>对于其他传输方式，将使用兼容的 prefork 池，这要求系统提供可用的 POSIX 信号量实现，
该功能自 FreeBSD 8.x 起默认启用。对于更早版本的 FreeBSD，你需要在内核中启用 POSIX 信号量并手动重新编译 billiard。</p>
<p>幸运的是，Viktor Petersson 撰写了一篇教程帮助你在 FreeBSD 上开始使用 Celery：
<a class="reference external" href="http://www.playingwithwire.com/2009/10/how-to-get-celeryd-to-work-on-freebsd/">http://www.playingwithwire.com/2009/10/how-to-get-celeryd-to-work-on-freebsd/</a></p>
</div>
<input class="tab-input" id="tab-set--14-input--2" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> Depends;</p>
<p>When using the RabbitMQ (AMQP) and Redis transports it should work
out of the box.</p>
<p>For other transports the compatibility prefork pool is
used and requires a working POSIX semaphore implementation,
this is enabled in FreeBSD by default since FreeBSD 8.x.
For older version of FreeBSD, you have to enable
POSIX semaphores in the kernel and manually recompile billiard.</p>
<p>Luckily, Viktor Petersson has written a tutorial to get you started with
Celery on FreeBSD here:
<a class="reference external" href="http://www.playingwithwire.com/2009/10/how-to-get-celeryd-to-work-on-freebsd/">http://www.playingwithwire.com/2009/10/how-to-get-celeryd-to-work-on-freebsd/</a></p>
</div>
</div>
</section>
<section id="integrityerror-duplicate-key">
<span id="faq-duplicate-key-errors"></span><h3>我遇到了“IntegrityError: Duplicate Key”错误。为什么？<a class="headerlink" href="#integrityerror-duplicate-key" title="Link to this heading">¶</a></h3>
<p>I'm having <cite>IntegrityError: Duplicate Key</cite> errors. Why?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--15-input--1" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 请参见 <a href="#id49"><span class="problematic" id="id50">`MySQL is throwing deadlock errors, what can I do?`_</span></a>。
感谢 <a class="extlink-github_user reference external" href="https://github.com/&#64;howsthedotcom/">&#64;&#64;howsthedotcom</a> 提供建议。</p>
</div>
<input class="tab-input" id="tab-set--15-input--2" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--2">英文--</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> See <a href="#id51"><span class="problematic" id="id52">`MySQL is throwing deadlock errors, what can I do?`_</span></a>.
Thanks to <a class="extlink-github_user reference external" href="https://github.com/&#64;howsthedotcom/">&#64;&#64;howsthedotcom</a>.</p>
</div>
</div>
</section>
<section id="faq-worker-stops-processing">
<span id="id11"></span><h3>为什么我的任务没有被处理？<a class="headerlink" href="#faq-worker-stops-processing" title="Link to this heading">¶</a></h3>
<p>Why aren't my tasks processed?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--16-input--1" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--1">中文</label><div class="tab-content docutils container">
<p><strong>回答：</strong> 使用 RabbitMQ 时，你可以通过以下命令查看当前有多少个消费者在接收任务：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rabbitmqctl<span class="w"> </span>list_queues<span class="w"> </span>-p<span class="w"> </span>&lt;myvhost&gt;<span class="w"> </span>name<span class="w"> </span>messages<span class="w"> </span>consumers
<span class="go">Listing queues ...</span>
<span class="go">celery     2891    2</span>
</pre></div>
</div>
<p>上面的输出表示任务队列中还有 2891 条待处理的消息，当前有 2 个消费者正在处理。</p>
<p>队列一直未清空的一个可能原因是某个过期的 worker 进程“劫持”了消息。
这可能是因为该 worker 没有正确关闭。</p>
<p>当消息被某个 worker 接收后，broker 会等待其发送确认（ack）信号，才会标记该消息为已处理。
在此之前，broker 不会将该消息重新发送给其他消费者，除非当前消费者已正确关闭。</p>
<p>如果遇到这种情况，你需要手动终止所有 worker 并重新启动：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pkill<span class="w"> </span><span class="s1">&#39;celery worker&#39;</span>

<span class="gp">$ </span><span class="c1"># - 如果系统没有 pkill，可以使用：</span>
<span class="gp">$ </span><span class="c1"># ps auxww | awk &#39;/celery worker/ {print $2}&#39; | xargs kill</span>
</pre></div>
</div>
<p>你可能需要等待一段时间直到所有 worker 执行完任务。
如果长时间仍处于挂起状态，可以使用强制方式终止它们：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pkill<span class="w"> </span>-9<span class="w"> </span><span class="s1">&#39;celery worker&#39;</span>

<span class="gp">$ </span><span class="c1"># - 如果系统没有 pkill，可以使用：</span>
<span class="gp">$ </span><span class="c1"># ps auxww | awk &#39;/celery worker/ {print $2}&#39; | xargs kill -9</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--16-input--2" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> With RabbitMQ you can see how many consumers are currently
receiving tasks by running the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rabbitmqctl<span class="w"> </span>list_queues<span class="w"> </span>-p<span class="w"> </span>&lt;myvhost&gt;<span class="w"> </span>name<span class="w"> </span>messages<span class="w"> </span>consumers
<span class="go">Listing queues ...</span>
<span class="go">celery     2891    2</span>
</pre></div>
</div>
<p>This shows that there's 2891 messages waiting to be processed in the task
queue, and there are two consumers processing them.</p>
<p>One reason that the queue is never emptied could be that you have a stale
worker process taking the messages hostage. This could happen if the worker
wasn't properly shut down.</p>
<p>When a message is received by a worker the broker waits for it to be
acknowledged before marking the message as processed. The broker won't
re-send that message to another consumer until the consumer is shut down
properly.</p>
<p>If you hit this problem you have to kill all workers manually and restart
them:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pkill<span class="w"> </span><span class="s1">&#39;celery worker&#39;</span>

<span class="gp">$ </span><span class="c1"># - If you don&#39;t have pkill use:</span>
<span class="gp">$ </span><span class="c1"># ps auxww | awk &#39;/celery worker/ {print $2}&#39; | xargs kill</span>
</pre></div>
</div>
<p>You may have to wait a while until all workers have finished executing
tasks. If it's still hanging after a long time you can kill them by force
with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pkill<span class="w"> </span>-9<span class="w"> </span><span class="s1">&#39;celery worker&#39;</span>

<span class="gp">$ </span><span class="c1"># - If you don&#39;t have pkill use:</span>
<span class="gp">$ </span><span class="c1"># ps auxww | awk &#39;/celery worker/ {print $2}&#39; | xargs kill -9</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="faq-task-does-not-run">
<span id="id12"></span><h3>为什么我的任务无法运行？<a class="headerlink" href="#faq-task-does-not-run" title="Link to this heading">¶</a></h3>
<p>Why won't my Task run?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--17-input--1" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 可能存在语法错误，导致任务模块无法被导入。</p>
<p>你可以手动执行任务，查看 Celery 是否能够运行该任务：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyPeriodicTask</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyPeriodicTask</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
</pre></div>
</div>
<p>查看 worker 的日志文件，以确定是否能够找到任务，或者是否发生了其他错误。</p>
</div>
<input class="tab-input" id="tab-set--17-input--2" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> There might be syntax errors preventing the tasks module being imported.</p>
<p>You can find out if Celery is able to run the task by executing the
task manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyPeriodicTask</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyPeriodicTask</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
</pre></div>
</div>
<p>Watch the workers log file to see if it's able to find the task, or if some
other error is happening.</p>
</div>
</div>
</section>
<section id="faq-periodic-task-does-not-run">
<span id="id13"></span><h3>为什么我的周期性任务无法运行？<a class="headerlink" href="#faq-periodic-task-does-not-run" title="Link to this heading">¶</a></h3>
<p>Why won't my periodic task run?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--18-input--1" name="tab-set--18" type="radio"><label class="tab-label" for="tab-set--18-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 参见 <a class="reference external" href="Whywon'tmyTaskrun?">为什么我的任务无法运行？</a>。</p>
</div>
<input class="tab-input" id="tab-set--18-input--2" name="tab-set--18" type="radio"><label class="tab-label" for="tab-set--18-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> See <a href="#id53"><span class="problematic" id="id54">`Why won't my Task run?`_</span></a>.</p>
</div>
</div>
</section>
<section id="faq-purge-the-queue">
<span id="id15"></span><h3>如何清除所有等待中的任务？<a class="headerlink" href="#faq-purge-the-queue" title="Link to this heading">¶</a></h3>
<p>How do I purge all waiting tasks?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--19-input--1" name="tab-set--19" type="radio"><label class="tab-label" for="tab-set--19-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 你可以使用 <code class="docutils literal notranslate"><span class="pre">celery</span> <span class="pre">purge</span></code> 命令清空所有配置的任务队列：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>purge
</pre></div>
</div>
<p>或通过编程方式清空：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proj.celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>
<span class="go">1753</span>
</pre></div>
</div>
<p>如果你只想清空特定队列中的消息，则需要使用 AMQP API 或 <strong class="program">celery amqp</strong> 工具：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>amqp<span class="w"> </span>queue.purge<span class="w"> </span>&lt;queue<span class="w"> </span>name&gt;
</pre></div>
</div>
<p>数字 1753 表示删除的消息数量。</p>
<p>你也可以在启动 worker 时启用
<a class="reference internal" href="reference/cli.html#cmdoption-celery-worker-purge"><code class="xref std std-option docutils literal notranslate"><span class="pre">--purge</span></code></a> 选项，在 worker 启动时自动清空消息。</p>
</div>
<input class="tab-input" id="tab-set--19-input--2" name="tab-set--19" type="radio"><label class="tab-label" for="tab-set--19-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> You can use the <code class="docutils literal notranslate"><span class="pre">celery</span> <span class="pre">purge</span></code> command to purge
all configured task queues:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>purge
</pre></div>
</div>
<p>or programmatically:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proj.celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>
<span class="go">1753</span>
</pre></div>
</div>
<p>If you only want to purge messages from a specific queue
you have to use the AMQP API or the <strong class="program">celery amqp</strong> utility:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>amqp<span class="w"> </span>queue.purge<span class="w"> </span>&lt;queue<span class="w"> </span>name&gt;
</pre></div>
</div>
<p>The number 1753 is the number of messages deleted.</p>
<p>You can also start the worker with the
<a class="reference internal" href="reference/cli.html#cmdoption-celery-worker-purge"><code class="xref std std-option docutils literal notranslate"><span class="pre">--purge</span></code></a> option enabled to purge messages
when the worker starts.</p>
</div>
</div>
</section>
<section id="faq-messages-left-after-purge">
<span id="id16"></span><h3>我已经清除了消息，但队列中仍然有消息？<a class="headerlink" href="#faq-messages-left-after-purge" title="Link to this heading">¶</a></h3>
<p>I've purged messages, but there are still messages left in the queue?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--20-input--1" name="tab-set--20" type="radio"><label class="tab-label" for="tab-set--20-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 任务会在实际执行后才会被确认（即从队列中移除）。worker 接收到任务后到实际执行之间可能有延迟，特别是当等待执行的任务很多时。未确认的消息会一直被 worker 持有，直到与 broker（AMQP 服务器）的连接关闭。当连接关闭（例如 worker 被停止）时，这些任务会由 broker 重新投递给下一个可用的 worker（或重启后的同一个 worker），因此如果要彻底清空等待中的任务队列，必须先停止所有 worker，然后使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">celery.control.purge()</span></code> 清空任务。</p>
</div>
<input class="tab-input" id="tab-set--20-input--2" name="tab-set--20" type="radio"><label class="tab-label" for="tab-set--20-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> Tasks are acknowledged (removed from the queue) as soon
as they're actually executed. After the worker has received a task, it will
take some time until it's actually executed, especially if there are a lot
of tasks already waiting for execution. Messages that aren't acknowledged are
held on to by the worker until it closes the connection to the broker (AMQP
server). When that connection is closed (e.g., because the worker was stopped)
the tasks will be re-sent by the broker to the next available worker (or the
same worker when it has been restarted), so to properly purge the queue of
waiting tasks you have to stop all the workers, and then purge the tasks
using <code class="xref py py-func docutils literal notranslate"><span class="pre">celery.control.purge()</span></code>.</p>
</div>
</div>
</section>
</section>
<section id="faq-results">
<span id="id17"></span><h2>结果<a class="headerlink" href="#faq-results" title="Link to this heading">¶</a></h2>
<p>Results</p>
<section id="faq-get-result-by-task-id">
<span id="id"></span><h3>如果我有指向任务结果的 ID，该如何获取结果？<a class="headerlink" href="#faq-get-result-by-task-id" title="Link to this heading">¶</a></h3>
<p>How do I get the result of a task if I have the ID that points there?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--21-input--1" name="tab-set--21" type="radio"><label class="tab-label" for="tab-set--21-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 使用 <cite>task.AsyncResult</cite>：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">my_task</span><span class="o">.</span><span class="n">AsyncResult</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>这将返回一个 <a class="reference internal" href="reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a> 实例，使用当前任务的结果后端。</p>
<p>如果你需要指定自定义结果后端，或者希望使用当前应用默认的后端，可以使用
<a class="reference internal" href="reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">app.AsyncResult</span></code></a>：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">AsyncResult</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--21-input--2" name="tab-set--21" type="radio"><label class="tab-label" for="tab-set--21-input--2">英文-</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Use <cite>task.AsyncResult</cite>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">my_task</span><span class="o">.</span><span class="n">AsyncResult</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>This will give you a <a class="reference internal" href="reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncResult</span></code></a> instance
using the tasks current result backend.</p>
<p>If you need to specify a custom result backend, or you want to use
the current application's default backend you can use
<a class="reference internal" href="reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">app.AsyncResult</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">AsyncResult</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="faq-security">
<span id="id18"></span><h2>安全性<a class="headerlink" href="#faq-security" title="Link to this heading">¶</a></h2>
<p>Security</p>
<section id="pickle">
<h3>使用 <cite>pickle</cite> 是否存在安全隐患？<a class="headerlink" href="#pickle" title="Link to this heading">¶</a></h3>
<p>Isn't using <cite>pickle</cite> a security concern?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--22-input--1" name="tab-set--22" type="radio"><label class="tab-label" for="tab-set--22-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 的确，自 Celery 4.0 起，默认的序列化格式为 JSON，这是为了让用户有意识地选择合适的序列化方式并关注安全问题。</p>
<p>保护 broker、数据库和其他传输 pickled 数据的服务不被未授权访问是至关重要的。</p>
<p>这不仅仅是 Celery 的问题，例如 Django 的缓存客户端也使用了 pickle。</p>
<p>对于任务消息，可以通过设置 <a class="reference internal" href="userguide/configuration.html#std-setting-task_serializer"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_serializer</span></code></a> 为 &quot;json&quot; 或 &quot;yaml&quot; 来替代 pickle。</p>
<p>同样地，任务结果的序列化方式可以通过 <a class="reference internal" href="userguide/configuration.html#std-setting-result_serializer"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_serializer</span></code></a> 来配置。</p>
<p>关于使用格式的详细说明以及在判断使用何种格式时的查找顺序，请参见 <a class="reference internal" href="userguide/calling.html#calling-serializers"><span class="std std-ref">序列化器</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--22-input--2" name="tab-set--22" type="radio"><label class="tab-label" for="tab-set--22-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Indeed, since Celery 4.0 the default serializer is now JSON
to make sure people are choosing serializers consciously and aware of this concern.</p>
<p>It's essential that you protect against unauthorized
access to your broker, databases and other services transmitting pickled
data.</p>
<p>Note that this isn't just something you should be aware of with Celery, for
example also Django uses pickle for its cache client.</p>
<p>For the task messages you can set the <a class="reference internal" href="userguide/configuration.html#std-setting-task_serializer"><code class="xref std std-setting docutils literal notranslate"><span class="pre">task_serializer</span></code></a>
setting to &quot;json&quot; or &quot;yaml&quot; instead of pickle.</p>
<p>Similarly for task results you can set <a class="reference internal" href="userguide/configuration.html#std-setting-result_serializer"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_serializer</span></code></a>.</p>
<p>For more details of the formats used and the lookup order when
checking what format to use for a task see <a class="reference internal" href="userguide/calling.html#calling-serializers"><span class="std std-ref">序列化器</span></a></p>
</div>
</div>
</section>
<section id="id19">
<h3>消息可以加密吗？<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h3>
<p>Can messages be encrypted?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--23-input--1" name="tab-set--23" type="radio"><label class="tab-label" for="tab-set--23-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 某些 AMQP broker（包括 RabbitMQ）支持 SSL。你可以通过设置 <a class="reference internal" href="userguide/configuration.html#std-setting-broker_use_ssl"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_use_ssl</span></code></a> 来启用 SSL。</p>
<p>如果你还需要为消息添加额外的加密或安全机制，请联系 <span class="xref std std-ref">mailing-list</span> 以获取更多信息。</p>
</div>
<input class="tab-input" id="tab-set--23-input--2" name="tab-set--23" type="radio"><label class="tab-label" for="tab-set--23-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Some AMQP brokers supports using SSL (including RabbitMQ).
You can enable this using the <a class="reference internal" href="userguide/configuration.html#std-setting-broker_use_ssl"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_use_ssl</span></code></a> setting.</p>
<p>It's also possible to add additional encryption and security to messages,
if you have a need for this then you should contact the <span class="xref std std-ref">mailing-list</span>.</p>
</div>
</div>
</section>
<section id="root-program-celery-worker">
<h3>以 root 身份运行 <cite>:program:`celery worker</cite> 是否安全？<a class="headerlink" href="#root-program-celery-worker" title="Link to this heading">¶</a></h3>
<p>Is it safe to run <strong class="program">celery worker</strong> as root?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--24-input--1" name="tab-set--24" type="radio"><label class="tab-label" for="tab-set--24-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 不可以！</p>
<p>虽然我们目前尚未发现安全漏洞，但假设不存在安全问题是非常天真的，因此强烈建议以非特权用户身份运行 Celery 服务（<strong class="program">celery worker</strong>、<strong class="program">celery beat</strong>、<strong class="program">celeryev</strong> 等）。</p>
</div>
<input class="tab-input" id="tab-set--24-input--2" name="tab-set--24" type="radio"><label class="tab-label" for="tab-set--24-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: No!</p>
<p>We're not currently aware of any security issues, but it would
be incredibly naive to assume that they don't exist, so running
the Celery services (<strong class="program">celery worker</strong>, <strong class="program">celery beat</strong>,
<strong class="program">celeryev</strong>, etc) as an unprivileged user is recommended.</p>
</div>
</div>
</section>
</section>
<section id="faq-brokers">
<span id="id20"></span><h2>代理<a class="headerlink" href="#faq-brokers" title="Link to this heading">¶</a></h2>
<p>Brokers</p>
<section id="rabbitmq">
<h3>为什么 RabbitMQ 会崩溃？<a class="headerlink" href="#rabbitmq" title="Link to this heading">¶</a></h3>
<p>Why is RabbitMQ crashing?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--25-input--1" name="tab-set--25" type="radio"><label class="tab-label" for="tab-set--25-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答：</strong> 如果 RabbitMQ 内存耗尽，会导致崩溃。这个问题将在 RabbitMQ 的未来版本中修复。请参考 RabbitMQ FAQ： <a class="reference external" href="https://www.rabbitmq.com/faq.html#node-runs-out-of-memory">https://www.rabbitmq.com/faq.html#node-runs-out-of-memory</a></p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>该问题在 RabbitMQ 2.0 及以上版本中已被修复。新版本引入了一个新的持久化机制，能够容忍内存溢出错误。推荐 Celery 用户使用 RabbitMQ 2.1 或更高版本。</p>
<p>如果你仍在运行旧版本 RabbitMQ，并遇到崩溃问题，请尽快升级！</p>
</div>
<p>在旧版 RabbitMQ 中，如果 Celery 配置不当，可能导致崩溃。即便不会崩溃，也可能占用大量系统资源，因此必须注意一些常见陷阱。</p>
<ul class="simple">
<li><p>事件（Events）</p></li>
</ul>
<p>使用 <a class="reference internal" href="reference/cli.html#cmdoption-celery-worker-E"><code class="xref std std-option docutils literal notranslate"><span class="pre">-E</span></code></a> 启动 <a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a> 时，会发送反映 worker 内部事件的消息。</p>
<p>只有在有事件监控器实时消费这些事件，或者定期清空事件队列的情况下，才应启用事件。</p>
<ul class="simple">
<li><p>AMQP 结果后端</p></li>
</ul>
<p>当使用 AMQP 结果后端时，每个任务的结果都会以消息的形式发送。如果你没有收集这些结果，它们将持续堆积，最终可能导致 RabbitMQ 内存耗尽。</p>
<p>该结果后端已被弃用，因此不应再使用。建议使用 RPC 后端用于 rpc 样式的调用，或者使用持久化后端以支持多消费者访问结果。</p>
<p>结果默认在 1 天后过期。你可以通过设置 <a class="reference internal" href="userguide/configuration.html#std-setting-result_expires"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_expires</span></code></a> 配置该值。</p>
<p>如果你不需要任务结果，务必设置 <cite>ignore_result</cite> 选项：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">ignore_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mytask</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">ignore_result</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--25-input--2" name="tab-set--25" type="radio"><label class="tab-label" for="tab-set--25-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> RabbitMQ will crash if it runs out of memory. This will be fixed in a
future release of RabbitMQ. please refer to the RabbitMQ FAQ:
<a class="reference external" href="https://www.rabbitmq.com/faq.html#node-runs-out-of-memory">https://www.rabbitmq.com/faq.html#node-runs-out-of-memory</a></p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This is no longer the case, RabbitMQ versions 2.0 and above
includes a new persister, that's tolerant to out of memory
errors. RabbitMQ 2.1 or higher is recommended for Celery.</p>
<p>If you're still running an older version of RabbitMQ and experience
crashes, then please upgrade!</p>
</div>
<p>Misconfiguration of Celery can eventually lead to a crash
on older version of RabbitMQ. Even if it doesn't crash, this
can still consume a lot of resources, so it's
important that you're aware of the common pitfalls.</p>
<ul class="simple">
<li><p>Events.</p></li>
</ul>
<p>Running <a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a> with the <a class="reference internal" href="reference/cli.html#cmdoption-celery-worker-E"><code class="xref std std-option docutils literal notranslate"><span class="pre">-E</span></code></a>
option will send messages for events happening inside of the worker.</p>
<p>Events should only be enabled if you have an active monitor consuming them,
or if you purge the event queue periodically.</p>
<ul class="simple">
<li><p>AMQP backend results.</p></li>
</ul>
<p>When running with the AMQP result backend, every task result will be sent
as a message. If you don't collect these results, they will build up and
RabbitMQ will eventually run out of memory.</p>
<p>This result backend is now deprecated so you shouldn't be using it.
Use either the RPC backend for rpc-style calls, or a persistent backend
if you need multi-consumer access to results.</p>
<p>Results expire after 1 day by default. It may be a good idea
to lower this value by configuring the <a class="reference internal" href="userguide/configuration.html#std-setting-result_expires"><code class="xref std std-setting docutils literal notranslate"><span class="pre">result_expires</span></code></a>
setting.</p>
<p>If you don't use the results for a task, make sure you set the
<cite>ignore_result</cite> option:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">ignore_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mytask</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">ignore_result</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="celery-activemq-stomp">
<span id="faq-use-celery-with-stomp"></span><h3>我可以将 Celery 与 ActiveMQ/STOMP 一起使用吗？<a class="headerlink" href="#celery-activemq-stomp" title="Link to this heading">¶</a></h3>
<p>Can I use Celery with ActiveMQ/STOMP?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--26-input--1" name="tab-set--26" type="radio"><label class="tab-label" for="tab-set--26-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：不支持。此前在 <a class="extlink-pypi reference external" href="https://pypi.org/project/Carrot`（我们早期使用的消息库）中曾提供该支持， 但目前的消息库 :pypi:`Kombu/">https://pypi.org/project/Carrot`（我们早期使用的消息库）中曾提供该支持，
但目前的消息库 :pypi:`Kombu/</a> 并不支持该功能。</p>
</div>
<input class="tab-input" id="tab-set--26-input--2" name="tab-set--26" type="radio"><label class="tab-label" for="tab-set--26-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: No. It used to be supported by <a class="extlink-pypi reference external" href="https://pypi.org/project/Carrot/">https://pypi.org/project/Carrot/</a> (our old messaging library)
but isn't currently supported in <a class="extlink-pypi reference external" href="https://pypi.org/project/Kombu/">https://pypi.org/project/Kombu/</a> (our new messaging library).</p>
</div>
</div>
</section>
<section id="amqp">
<span id="faq-non-amqp-missing-features"></span><h3>不使用 AMQP 代理时，哪些功能不受支持？<a class="headerlink" href="#amqp" title="Link to this heading">¶</a></h3>
<p>What features aren't supported when not using an AMQP broker?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--27-input--1" name="tab-set--27" type="radio"><label class="tab-label" for="tab-set--27-input--1">中文</label><div class="tab-content docutils container">
<p>以下是使用虚拟传输（virtual transports）时不可用功能的非完整列表：</p>
<blockquote>
<div><ul class="simple">
<li><p>远程控制命令（仅 Redis 支持）。</p></li>
<li><p>事件监控在部分虚拟传输中可能无法正常工作。</p></li>
<li><dl class="simple">
<dt><cite>header</cite> 和 <cite>fanout</cite> 类型的交换机</dt><dd><p>（其中 <cite>fanout</cite> 类型由 Redis 支持）。</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<input class="tab-input" id="tab-set--27-input--2" name="tab-set--27" type="radio"><label class="tab-label" for="tab-set--27-input--2">英文</label><div class="tab-content docutils container">
<p>This is an incomplete list of features not available when
using the virtual transports:</p>
<blockquote>
<div><ul class="simple">
<li><p>Remote control commands (supported only by Redis).</p></li>
<li><p>Monitoring with events may not work in all virtual transports.</p></li>
<li><dl class="simple">
<dt>The <cite>header</cite> and <cite>fanout</cite> exchange types</dt><dd><p>(<cite>fanout</cite> is supported by Redis).</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
</div>
</section>
</section>
<section id="faq-tasks">
<span id="id21"></span><h2>任务<a class="headerlink" href="#faq-tasks" title="Link to this heading">¶</a></h2>
<p>Tasks</p>
<section id="faq-tasks-connection-reuse">
<span id="id22"></span><h3>如何在调用任务时重用相同的连接？<a class="headerlink" href="#faq-tasks-connection-reuse" title="Link to this heading">¶</a></h3>
<p>How can I reuse the same connection when calling tasks?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--28-input--1" name="tab-set--28" type="radio"><label class="tab-label" for="tab-set--28-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：参见 <a class="reference internal" href="userguide/configuration.html#std-setting-broker_pool_limit"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_pool_limit</span></code></a> 配置项。
自 2.5 版本起，连接池默认启用。</p>
</div>
<input class="tab-input" id="tab-set--28-input--2" name="tab-set--28" type="radio"><label class="tab-label" for="tab-set--28-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: See the <a class="reference internal" href="userguide/configuration.html#std-setting-broker_pool_limit"><code class="xref std std-setting docutils literal notranslate"><span class="pre">broker_pool_limit</span></code></a> setting.
The connection pool is enabled by default since version 2.5.</p>
</div>
</div>
</section>
<section id="subprocess-command-sudo-const-none">
<span id="faq-sudo-subprocess"></span><h3><a class="reference external" href="https://docs.python.org/dev/library/subprocess.html#module-subprocess" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code></a> 中的 <cite>:command:`sudo</cite> 返回 <cite>:const:`None</cite><a class="headerlink" href="#subprocess-command-sudo-const-none" title="Link to this heading">¶</a></h3>
<p><strong class="command">sudo</strong> in a <a class="reference external" href="https://docs.python.org/dev/library/subprocess.html#module-subprocess" title="（在 Python v3.15）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code></a> returns <code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--29-input--1" name="tab-set--29" type="radio"><label class="tab-label" for="tab-set--29-input--1">中文</label><div class="tab-content docutils container">
<p>有一个 <strong class="command">sudo</strong> 的配置选项会禁止无 tty 的进程使用 <strong class="command">sudo</strong>：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Defaults requiretty
</pre></div>
</div>
<p>如果你在 <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> 文件中配置了该选项，
当 worker 以守护进程（daemon）方式运行时，任务将无法调用 <strong class="command">sudo</strong>。
如果你希望允许此行为，请从 <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> 文件中移除该行。</p>
<p>参见：<a class="reference external" href="https://timelordz.com/wiki/Apache_Sudo_Commands">https://timelordz.com/wiki/Apache_Sudo_Commands</a></p>
</div>
<input class="tab-input" id="tab-set--29-input--2" name="tab-set--29" type="radio"><label class="tab-label" for="tab-set--29-input--2">英文</label><div class="tab-content docutils container">
<p>There's a <strong class="command">sudo</strong> configuration option that makes it illegal
for process without a tty to run <strong class="command">sudo</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Defaults requiretty
</pre></div>
</div>
<p>If you have this configuration in your <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> file then
tasks won't be able to call <strong class="command">sudo</strong> when the worker is
running as a daemon. If you want to enable that, then you need to remove
the line from <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code>.</p>
<p>See: <a class="reference external" href="http://timelordz.com/wiki/Apache_Sudo_Commands">http://timelordz.com/wiki/Apache_Sudo_Commands</a></p>
</div>
</div>
</section>
<section id="faq-deletes-unknown-tasks">
<span id="id23"></span><h3>为什么工作进程无法处理队列中的任务时会将其删除？<a class="headerlink" href="#faq-deletes-unknown-tasks" title="Link to this heading">¶</a></h3>
<p>Why do workers delete tasks from the queue if they're unable to process them?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--30-input--1" name="tab-set--30" type="radio"><label class="tab-label" for="tab-set--30-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：</p>
<p>Worker 会拒绝未知任务、编码错误的消息以及不符合任务消息协议的消息。</p>
<p>如果不进行拒绝，这些消息可能会被不断重投递，形成死循环。</p>
<p>较新版本的 RabbitMQ 支持为交换机配置死信队列（dead-letter queue），
从而将被拒绝的消息转发至该队列。</p>
</div>
<input class="tab-input" id="tab-set--30-input--2" name="tab-set--30" type="radio"><label class="tab-label" for="tab-set--30-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>:</p>
<p>The worker rejects unknown tasks, messages with encoding errors and messages
that don't contain the proper fields (as per the task message protocol).</p>
<p>If it didn't reject them they could be redelivered again and again,
causing a loop.</p>
<p>Recent versions of RabbitMQ has the ability to configure a dead-letter
queue for exchange, so that rejected messages is moved there.</p>
</div>
</div>
</section>
<section id="faq-execute-task-by-name">
<span id="id24"></span><h3>我可以通过名称调用任务吗？<a class="headerlink" href="#faq-execute-task-by-name" title="Link to this heading">¶</a></h3>
<p>Can I call a task by name?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--31-input--1" name="tab-set--31" type="radio"><label class="tab-label" for="tab-set--31-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，使用 <a class="reference internal" href="reference/celery.html#celery.Celery.send_task" title="celery.Celery.send_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.send_task()</span></code></a> 方法。</p>
<p>你还可以通过 AMQP 客户端，以任务名称方式从任意语言调用任务：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">send_task</span><span class="p">(</span><span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="go">&lt;AsyncResult: 373550e8-b9a0-4666-bc61-ace01fa4f91d&gt;</span>
</pre></div>
</div>
<p>如果你希望结合 <code class="docutils literal notranslate"><span class="pre">chain</span></code>、<code class="docutils literal notranslate"><span class="pre">chord</span></code> 或 <code class="docutils literal notranslate"><span class="pre">group</span></code> 使用按名称调用的任务，
可以使用 <a class="reference internal" href="reference/celery.html#celery.Celery.signature" title="celery.Celery.signature"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Celery.signature()</span></code></a> 方法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">app</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{}),</span>
<span class="gp">... </span>    <span class="n">app</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
<span class="go">&lt;AsyncResult: e9d52312-c161-46f0-9013-2713e6df812d&gt;</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--31-input--2" name="tab-set--31" type="radio"><label class="tab-label" for="tab-set--31-input--2">英文---</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, use <a class="reference internal" href="reference/celery.html#celery.Celery.send_task" title="celery.Celery.send_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app.send_task()</span></code></a>.</p>
<p>You can also call a task by name, from any language,
using an AMQP client:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">send_task</span><span class="p">(</span><span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="go">&lt;AsyncResult: 373550e8-b9a0-4666-bc61-ace01fa4f91d&gt;</span>
</pre></div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">chain</span></code>, <code class="docutils literal notranslate"><span class="pre">chord</span></code> or <code class="docutils literal notranslate"><span class="pre">group</span></code> with tasks called by name,
use the <a class="reference internal" href="reference/celery.html#celery.Celery.signature" title="celery.Celery.signature"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Celery.signature()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">app</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{}),</span>
<span class="gp">... </span>    <span class="n">app</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="s1">&#39;tasks.add&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{})</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
<span class="go">&lt;AsyncResult: e9d52312-c161-46f0-9013-2713e6df812d&gt;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="faq-get-current-task-id">
<span id="id25"></span><h3>我可以获取当前任务的任务 ID 吗？<a class="headerlink" href="#faq-get-current-task-id" title="Link to this heading">¶</a></h3>
<p>Can I get the task id of the current task?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--32-input--1" name="tab-set--32" type="radio"><label class="tab-label" for="tab-set--32-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，当前任务的 id 及其他信息可通过 task request 获取:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mytask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Running&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>详见 <a class="reference internal" href="userguide/tasks.html#task-request-info"><span class="std std-ref">任务请求</span></a>。</p>
<p>如果你无法获取任务实例的引用，也可以使用
<a class="reference internal" href="reference/celery.html#celery.Celery.current_task" title="celery.Celery.current_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app.current_task</span></code></a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">current_task</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p>但需注意，这个任务可能是任意任务，
包括被 worker 执行的任务、由该任务调用的子任务，或以 eager 模式执行的任务。</p>
<p>若希望获取当前 worker 实际正在处理的任务，请使用
<a class="reference internal" href="reference/celery.html#celery.Celery.current_worker_task" title="celery.Celery.current_worker_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">current_worker_task</span></code></a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">current_worker_task</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference internal" href="reference/celery.html#celery.Celery.current_task" title="celery.Celery.current_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">current_task</span></code></a> 与 <a class="reference internal" href="reference/celery.html#celery.Celery.current_worker_task" title="celery.Celery.current_worker_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">current_worker_task</span></code></a> 的值
都可能为 <code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code>。</p>
</div>
</div>
<input class="tab-input" id="tab-set--32-input--2" name="tab-set--32" type="radio"><label class="tab-label" for="tab-set--32-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, the current id and more is available in the task request:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mytask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Running&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information see <a class="reference internal" href="userguide/tasks.html#task-request-info"><span class="std std-ref">任务请求</span></a>.</p>
<p>If you don't have a reference to the task instance you can use
<a class="reference internal" href="reference/celery.html#celery.Celery.current_task" title="celery.Celery.current_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app.current_task</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">current_task</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p>But note that this will be any task, be it one executed by the worker, or a
task called directly by that task, or a task called eagerly.</p>
<p>To get the current task being worked on specifically, use
<a class="reference internal" href="reference/celery.html#celery.Celery.current_worker_task" title="celery.Celery.current_worker_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">current_worker_task</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">current_worker_task</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Both <a class="reference internal" href="reference/celery.html#celery.Celery.current_task" title="celery.Celery.current_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">current_task</span></code></a>, and <a class="reference internal" href="reference/celery.html#celery.Celery.current_worker_task" title="celery.Celery.current_worker_task"><code class="xref py py-attr docutils literal notranslate"><span class="pre">current_worker_task</span></code></a> can be
<code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
</div>
</div>
</section>
<section id="task-id">
<span id="faq-custom-task-ids"></span><h3>我可以指定自定义的 task_id 吗？<a class="headerlink" href="#task-id" title="Link to this heading">¶</a></h3>
<p>Can I specify a custom task_id?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--33-input--1" name="tab-set--33" type="radio"><label class="tab-label" for="tab-set--33-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Task.apply_async()</span></code> 方法中的 <cite>task_id</cite> 参数：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;…&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--33-input--2" name="tab-set--33" type="radio"><label class="tab-label" for="tab-set--33-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, use the <cite>task_id</cite> argument to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Task.apply_async()</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;…&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id26">
<h3>我可以对任务使用装饰器吗？<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h3>
<p>Can I use decorators with tasks?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--34-input--1" name="tab-set--34" type="radio"><label class="tab-label" for="tab-set--34-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，但请参见 <a class="reference internal" href="userguide/tasks.html#task-basics"><span class="std std-ref">基础知识</span></a> 侧边栏中的说明。</p>
</div>
<input class="tab-input" id="tab-set--34-input--2" name="tab-set--34" type="radio"><label class="tab-label" for="tab-set--34-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, but please see note in the sidebar at <a class="reference internal" href="userguide/tasks.html#task-basics"><span class="std std-ref">基础知识</span></a>.</p>
</div>
</div>
</section>
<section id="faq-natural-task-ids">
<span id="id27"></span><h3>我可以使用自然的任务 ID 吗？<a class="headerlink" href="#faq-natural-task-ids" title="Link to this heading">¶</a></h3>
<p>Can I use natural task ids?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--35-input--1" name="tab-set--35" type="radio"><label class="tab-label" for="tab-set--35-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，但必须确保 ID 是唯一的。
因为存在两个任务具有相同 ID 的行为是未定义的。</p>
<p>虽然世界可能不会因此爆炸，但这些任务确实可能会互相覆盖其结果。</p>
</div>
<input class="tab-input" id="tab-set--35-input--2" name="tab-set--35" type="radio"><label class="tab-label" for="tab-set--35-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, but make sure it's unique, as the behavior
for two tasks existing with the same id is undefined.</p>
<p>The world will probably not explode, but they can
definitely overwrite each others results.</p>
</div>
</div>
</section>
<section id="faq-task-callbacks">
<span id="id28"></span><h3>我可以在某个任务完成后再运行另一个任务吗？<a class="headerlink" href="#faq-task-callbacks" title="Link to this heading">¶</a></h3>
<p>Can I run a task once another task has finished?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--36-input--1" name="tab-set--36" type="radio"><label class="tab-label" for="tab-set--36-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，你可以在一个任务中安全地启动另一个任务。</p>
<p>一个常见模式是为任务添加回调函数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.utils.log</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_task_logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_task_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">ignore_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">log_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;log_result got: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>调用示例：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">log_result</span><span class="o">.</span><span class="n">s</span><span class="p">())</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
</pre></div>
</div>
<p>更多信息参见 <a class="reference internal" href="userguide/canvas.html"><span class="doc">Canvas：设计工作流</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--36-input--2" name="tab-set--36" type="radio"><label class="tab-label" for="tab-set--36-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, you can safely launch a task inside a task.</p>
<p>A common pattern is to add callbacks to tasks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.utils.log</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_task_logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_task_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">ignore_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">log_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;log_result got: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Invocation:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">log_result</span><span class="o">.</span><span class="n">s</span><span class="p">())</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="userguide/canvas.html"><span class="doc">Canvas：设计工作流</span></a> for more information.</p>
</div>
</div>
</section>
<section id="faq-cancel-task">
<span id="id29"></span><h3>我可以取消正在执行的任务吗？<a class="headerlink" href="#faq-cancel-task" title="Link to this heading">¶</a></h3>
<p>Can I cancel the execution of a task?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--37-input--1" name="tab-set--37" type="radio"><label class="tab-label" for="tab-set--37-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，使用 <a class="reference internal" href="reference/celery.result.html#celery.result.AsyncResult.revoke" title="celery.result.AsyncResult.revoke"><code class="xref py py-meth docutils literal notranslate"><span class="pre">result.revoke()</span></code></a>：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">revoke</span><span class="p">()</span>
</pre></div>
</div>
<p>如果你只有任务 ID，也可以这样撤销：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proj.celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</pre></div>
</div>
<p>此外也支持传入任务 ID 列表作为参数。</p>
</div>
<input class="tab-input" id="tab-set--37-input--2" name="tab-set--37" type="radio"><label class="tab-label" for="tab-set--37-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, Use <a class="reference internal" href="reference/celery.result.html#celery.result.AsyncResult.revoke" title="celery.result.AsyncResult.revoke"><code class="xref py py-meth docutils literal notranslate"><span class="pre">result.revoke()</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">revoke</span><span class="p">()</span>
</pre></div>
</div>
<p>or if you only have the task id:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proj.celery</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">revoke</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</pre></div>
</div>
<p>The latter also support passing a list of task-ids as argument.</p>
</div>
</div>
</section>
<section id="faq-node-not-receiving-broadcast-commands">
<span id="id30"></span><h3>为什么我的远程控制命令没有被所有工作进程接收？<a class="headerlink" href="#faq-node-not-receiving-broadcast-commands" title="Link to this heading">¶</a></h3>
<p>Why aren't my remote control commands received by all workers?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--38-input--1" name="tab-set--38" type="radio"><label class="tab-label" for="tab-set--38-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：为了接收广播式的远程控制命令，每个 worker 节点会基于其节点名（nodename）
创建一个唯一的队列名称。</p>
<p>如果多个 worker 具有相同的主机名，则控制命令将在它们之间轮询（round-robin）分发。</p>
<p>为避免这种情况，你可以通过 <a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a> 的
<a class="reference internal" href="reference/cli.html#cmdoption-celery-worker-n"><code class="xref std std-option docutils literal notranslate"><span class="pre">-n</span></code></a> 参数为每个 worker 显式设置节点名：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>worker<span class="w"> </span>-n<span class="w"> </span>worker1@%h
<span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>worker<span class="w"> </span>-n<span class="w"> </span>worker2@%h
</pre></div>
</div>
<p>其中 <code class="docutils literal notranslate"><span class="pre">%h</span></code> 会扩展为当前主机名。</p>
</div>
<input class="tab-input" id="tab-set--38-input--2" name="tab-set--38" type="radio"><label class="tab-label" for="tab-set--38-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: To receive broadcast remote control commands, every worker node
creates a unique queue name, based on the nodename of the worker.</p>
<p>If you have more than one worker with the same host name, the
control commands will be received in round-robin between them.</p>
<p>To work around this you can explicitly set the nodename for every worker
using the <a class="reference internal" href="reference/cli.html#cmdoption-celery-worker-n"><code class="xref std std-option docutils literal notranslate"><span class="pre">-n</span></code></a> argument to
<a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>worker<span class="w"> </span>-n<span class="w"> </span>worker1@%h
<span class="gp">$ </span>celery<span class="w"> </span>-A<span class="w"> </span>proj<span class="w"> </span>worker<span class="w"> </span>-n<span class="w"> </span>worker2@%h
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">%h</span></code> expands into the current hostname.</p>
</div>
</div>
</section>
<section id="faq-task-routing">
<span id="id31"></span><h3>我可以只将某些任务发送到某些服务器吗？<a class="headerlink" href="#faq-task-routing" title="Link to this heading">¶</a></h3>
<p>Can I send some tasks to only some servers?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--39-input--1" name="tab-set--39" type="radio"><label class="tab-label" for="tab-set--39-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以。你可以使用不同的消息路由拓扑将任务路由到一个或多个 worker，
一个 worker 实例也可以绑定多个队列。</p>
<p>详见 <a class="reference internal" href="userguide/routing.html"><span class="doc">路由任务/Tasks</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--39-input--2" name="tab-set--39" type="radio"><label class="tab-label" for="tab-set--39-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer:</strong> Yes, you can route tasks to one or more workers,
using different message routing topologies, and a worker instance
can bind to multiple queues.</p>
<p>See <a class="reference internal" href="userguide/routing.html"><span class="doc">路由任务/Tasks</span></a> for more information.</p>
</div>
</div>
</section>
<section id="faq-disable-prefetch">
<span id="id32"></span><h3>我可以禁用任务预取吗？<a class="headerlink" href="#faq-disable-prefetch" title="Link to this heading">¶</a></h3>
<p>Can I disable prefetching of tasks?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--40-input--1" name="tab-set--40" type="radio"><label class="tab-label" for="tab-set--40-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可能可以！AMQP 中的 “prefetch” 一词容易让人误解，
它实际上仅用于描述任务预取的 <em>限制</em>，并不意味着真正的预取行为。</p>
<p>可以禁用预取限制，但这意味着 worker 会尽可能快地消费尽可能多的任务。</p>
<p>关于预取限制的讨论，以及配置 worker 每次仅保留一个任务的设置，详见：
<a class="reference internal" href="userguide/optimizing.html#optimizing-prefetch-limit"><span class="std std-ref">预取限制</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--40-input--2" name="tab-set--40" type="radio"><label class="tab-label" for="tab-set--40-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Maybe! The AMQP term &quot;prefetch&quot; is confusing, as it's only used
to describe the task prefetching <em>limit</em>.  There's no actual prefetching involved.</p>
<p>Disabling the prefetch limits is possible, but that means the worker will
consume as many tasks as it can, as fast as possible.</p>
<p>A discussion on prefetch limits, and configuration settings for a worker
that only reserves one task at a time is found here:
<a class="reference internal" href="userguide/optimizing.html#optimizing-prefetch-limit"><span class="std std-ref">预取限制</span></a>.</p>
</div>
</div>
</section>
<section id="faq-change-periodic-task-interval-at-runtime">
<span id="id33"></span><h3>我可以运行时更改周期性任务的执行间隔吗？<a class="headerlink" href="#faq-change-periodic-task-interval-at-runtime" title="Link to this heading">¶</a></h3>
<p>Can I change the interval of a periodic task at runtime?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--41-input--1" name="tab-set--41" type="radio"><label class="tab-label" for="tab-set--41-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，你可以使用 Django 的数据库调度器，
或自定义一个新的调度类，并重写
<a class="reference internal" href="reference/celery.schedules.html#celery.schedules.schedule.is_due" title="celery.schedules.schedule.is_due"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_due()</span></code></a> 方法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.schedules</span><span class="w"> </span><span class="kn">import</span> <span class="n">schedule</span>

<span class="k">class</span><span class="w"> </span><span class="nc">my_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_due</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_run_at</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">run_now</span><span class="p">,</span> <span class="n">next_time_to_check</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--41-input--2" name="tab-set--41" type="radio"><label class="tab-label" for="tab-set--41-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, you can use the Django database scheduler, or you can
create a new schedule subclass and override
<a class="reference internal" href="reference/celery.schedules.html#celery.schedules.schedule.is_due" title="celery.schedules.schedule.is_due"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_due()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">celery.schedules</span><span class="w"> </span><span class="kn">import</span> <span class="n">schedule</span>

<span class="k">class</span><span class="w"> </span><span class="nc">my_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_due</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_run_at</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">run_now</span><span class="p">,</span> <span class="n">next_time_to_check</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="faq-task-priorities">
<span id="id34"></span><h3>Celery 支持任务优先级吗？<a class="headerlink" href="#faq-task-priorities" title="Link to this heading">¶</a></h3>
<p>Does Celery support task priorities?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--42-input--1" name="tab-set--42" type="radio"><label class="tab-label" for="tab-set--42-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以。RabbitMQ 从 3.5.0 版本起支持消息优先级，
Redis 传输方式则是对优先级支持进行模拟。</p>
<p>你也可以通过将高优先级任务路由到专用的 worker 来实现优先处理。
在实践中，这种方式通常比消息级别的优先级更有效。
你还可以结合速率限制和消息优先级来构建响应式系统。</p>
</div>
<input class="tab-input" id="tab-set--42-input--2" name="tab-set--42" type="radio"><label class="tab-label" for="tab-set--42-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, RabbitMQ supports priorities since version 3.5.0,
and the Redis transport emulates priority support.</p>
<p>You can also prioritize work by routing high priority tasks
to different workers. In the real world this usually works better
than per message priorities. You can use this in combination with rate
limiting, and per message priorities to achieve a responsive system.</p>
</div>
</div>
</section>
<section id="retry-acks-late">
<span id="faq-acks-late-vs-retry"></span><h3>我应该使用 retry 还是 acks_late？<a class="headerlink" href="#retry-acks-late" title="Link to this heading">¶</a></h3>
<p>Should I use retry or acks_late?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--43-input--1" name="tab-set--43" type="radio"><label class="tab-label" for="tab-set--43-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：视情况而定。这两者并非互斥，你可能需要同时使用。</p>
<p><cite>Task.retry</cite> 用于重试任务，主要适用于通过 <a class="reference external" href="https://docs.python.org/dev/reference/compound_stmts.html#try" title="（在 Python v3.15）"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> 块可以捕获的预期错误。
这类错误不会触发 AMQP 事务： <strong>即使任务抛出异常，消息也会被确认（acknowledged）！</strong></p>
<p><cite>acks_late</cite> 设置用于 worker 在执行任务中途崩溃时，允许任务被重新执行。
需要注意的是，worker 崩溃是非常罕见的情况，通常属于不可恢复的错误，需要人工介入
（如 worker 或任务代码中的 bug）。</p>
<p>理想情况下，任何失败的任务都可以安全重试，但现实中往往并非如此。
例如如下任务：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_upload</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">):</span>
    <span class="c1"># 增加数据库中存储的文件计数</span>
    <span class="n">increment_file_counter</span><span class="p">()</span>
    <span class="n">add_file_metadata_to_db</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">)</span>
    <span class="n">copy_file_to_destination</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">)</span>
</pre></div>
</div>
<p>如果在将文件复制到目标位置时发生崩溃，系统状态就会不一致。
当然，这个例子并不致命，但你可以想象更严重的场景。
因此，为了编程便利性，我们选择了牺牲一定的可靠性；
但对于有需要且清楚其含义的用户，仍然可以启用 <cite>acks_late</cite>，
并期望将来支持手动确认（manual acknowledgment）。</p>
<p>另外，<cite>Task.retry</cite> 提供了 AMQP 事务不具备的一些特性：
如重试间隔、最大重试次数等。</p>
<p>因此，对于 Python 错误，请使用 <cite>retry</cite>；
若你的任务是幂等的，并且需要更高的可靠性，
可以结合使用 <cite>acks_late</cite>。</p>
</div>
<input class="tab-input" id="tab-set--43-input--2" name="tab-set--43" type="radio"><label class="tab-label" for="tab-set--43-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Depends. It's not necessarily one or the other, you may want
to use both.</p>
<p><cite>Task.retry</cite> is used to retry tasks, notably for expected errors that
is catch-able with the <a class="reference external" href="https://docs.python.org/dev/reference/compound_stmts.html#try" title="（在 Python v3.15）"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> block. The AMQP transaction isn't used
for these errors: <strong>if the task raises an exception it's still acknowledged!</strong></p>
<p>The <cite>acks_late</cite> setting would be used when you need the task to be
executed again if the worker (for some reason) crashes mid-execution.
It's important to note that the worker isn't known to crash, and if
it does it's usually an unrecoverable error that requires human
intervention (bug in the worker, or task code).</p>
<p>In an ideal world you could safely retry any task that's failed, but
this is rarely the case. Imagine the following task:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">task</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_upload</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">):</span>
    <span class="c1"># Increment a file count stored in a database</span>
    <span class="n">increment_file_counter</span><span class="p">()</span>
    <span class="n">add_file_metadata_to_db</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">)</span>
    <span class="n">copy_file_to_destination</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">)</span>
</pre></div>
</div>
<p>If this crashed in the middle of copying the file to its destination
the world would contain incomplete state. This isn't a critical
scenario of course, but you can probably imagine something far more
sinister. So for ease of programming we have less reliability;
It's a good default, users who require it and know what they
are doing can still enable acks_late (and in the future hopefully
use manual acknowledgment).</p>
<p>In addition <cite>Task.retry</cite> has features not available in AMQP
transactions: delay between retries, max retries, etc.</p>
<p>So use retry for Python errors, and if your task is idempotent
combine that with <cite>acks_late</cite> if that level of reliability
is required.</p>
</div>
</div>
</section>
<section id="faq-schedule-at-specific-time">
<span id="id35"></span><h3>我可以安排任务在特定时间执行吗？<a class="headerlink" href="#faq-schedule-at-specific-time" title="Link to this heading">¶</a></h3>
<p>Can I schedule tasks to execute at a specific time?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--44-input--1" name="tab-set--44" type="radio"><label class="tab-label" for="tab-set--44-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以。你可以使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Task.apply_async()</span></code> 的 <cite>eta</cite> 参数。
需要注意的是，不建议使用过远的 <cite>eta</cite> 时间，此类情况推荐使用
<a class="reference internal" href="userguide/periodic-tasks.html#guide-beat"><span class="std std-ref">周期性任务</span></a>。</p>
<p>详见 <a class="reference internal" href="userguide/calling.html#calling-eta"><span class="std std-ref">预计到达时间和倒计时</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--44-input--2" name="tab-set--44" type="radio"><label class="tab-label" for="tab-set--44-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes. You can use the <cite>eta</cite> argument of <code class="xref py py-meth docutils literal notranslate"><span class="pre">Task.apply_async()</span></code>.
Note that using distant <cite>eta</cite> times is not recommended, and in such case
<a class="reference internal" href="userguide/periodic-tasks.html#guide-beat"><span class="std std-ref">periodic tasks</span></a> should be preferred.</p>
<p>See <a class="reference internal" href="userguide/calling.html#calling-eta"><span class="std std-ref">预计到达时间和倒计时</span></a> for more details.</p>
</div>
</div>
</section>
<section id="faq-safe-worker-shutdown">
<span id="id36"></span><h3>我可以安全地关闭工作进程吗？<a class="headerlink" href="#faq-safe-worker-shutdown" title="Link to this heading">¶</a></h3>
<p>Can I safely shut down the worker?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--45-input--1" name="tab-set--45" type="radio"><label class="tab-label" for="tab-set--45-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，使用 <code class="xref std std-sig docutils literal notranslate"><span class="pre">TERM</span></code> 信号。</p>
<p>这将通知 worker 完成当前正在执行的所有任务，并尽快关闭。
即使使用的是实验性的传输方式，只要 shutdown 完成，任务也不会丢失。</p>
<p><strong>绝不应该</strong> 使用 <code class="xref std std-sig docutils literal notranslate"><span class="pre">KILL</span></code> 信号（即 <code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-9</span></code>）强制终止 <a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a>，
除非你已经尝试过多次使用 <code class="xref std std-sig docutils literal notranslate"><span class="pre">TERM</span></code> 并等待了几分钟以便让其有机会正常退出。</p>
<p>同时，确保你终止的是主 worker 进程，而不是其子进程。
如果你知道某个子进程正在执行任务，并且该任务阻碍了 worker 的关闭，
可以将 kill 信号发送给该特定子进程，但这也会导致该任务被标记为
<code class="docutils literal notranslate"><span class="pre">WorkerLostError</span></code> 状态，因此该任务不会被重新执行。</p>
<p>若你安装了 <a class="extlink-pypi reference external" href="https://pypi.org/project/setproctitle/">https://pypi.org/project/setproctitle/</a> 模块，识别进程类型会更容易：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>setproctitle
</pre></div>
</div>
<p>安装该库后，你可以在 <strong class="command">ps</strong> 输出中看到进程类型，
但需重启 worker 进程后此功能才会生效。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="userguide/workers.html#worker-stopping"><span class="std std-ref">停止 worker</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--45-input--2" name="tab-set--45" type="radio"><label class="tab-label" for="tab-set--45-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, use the <code class="xref std std-sig docutils literal notranslate"><span class="pre">TERM</span></code> signal.</p>
<p>This will tell the worker to finish all currently
executing jobs and shut down as soon as possible. No tasks should be lost
even with experimental transports as long as the shutdown completes.</p>
<p>You should never stop <a class="reference internal" href="reference/celery.bin.worker.html#module-celery.bin.worker" title="celery.bin.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">worker</span></code></a> with the <code class="xref std std-sig docutils literal notranslate"><span class="pre">KILL</span></code> signal
(<code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-9</span></code>), unless you've tried <code class="xref std std-sig docutils literal notranslate"><span class="pre">TERM</span></code> a few times and waited a few
minutes to let it get a chance to shut down.</p>
<p>Also make sure you kill the main worker process only, not any of its child
processes.  You can direct a kill signal to a specific child process if
you know the process is currently executing a task the worker shutdown
is depending on, but this also means that a <code class="docutils literal notranslate"><span class="pre">WorkerLostError</span></code> state will
be set for the task so the task won't run again.</p>
<p>Identifying the type of process is easier if you have installed the
<a class="extlink-pypi reference external" href="https://pypi.org/project/setproctitle/">https://pypi.org/project/setproctitle/</a> module:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>setproctitle
</pre></div>
</div>
<p>With this library installed you'll be able to see the type of process in
<strong class="command">ps</strong> listings, but the worker must be restarted for this to take effect.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="userguide/workers.html#worker-stopping"><span class="std std-ref">停止 worker</span></a></p>
</div>
</div>
</div>
</section>
<section id="platform">
<span id="faq-daemonizing"></span><h3>我可以在 [platform] 上在后台运行工作进程吗？<a class="headerlink" href="#platform" title="Link to this heading">¶</a></h3>
<p>Can I run the worker in the background on [platform]?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--46-input--1" name="tab-set--46" type="radio"><label class="tab-label" for="tab-set--46-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：可以，详见 <a class="reference internal" href="userguide/daemonizing.html#daemonizing"><span class="std std-ref">守护进程</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--46-input--2" name="tab-set--46" type="radio"><label class="tab-label" for="tab-set--46-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: Yes, please see <a class="reference internal" href="userguide/daemonizing.html#daemonizing"><span class="std std-ref">守护进程</span></a>.</p>
</div>
</div>
</section>
</section>
<section id="django">
<span id="faq-django"></span><h2>Django<a class="headerlink" href="#django" title="Link to this heading">¶</a></h2>
<section id="django-celery-beat">
<span id="faq-django-beat-database-tables"></span><h3>“django-celery-beat”创建的数据库表有什么用途？<a class="headerlink" href="#django-celery-beat" title="Link to this heading">¶</a></h3>
<p>What purpose does the database tables created by <code class="docutils literal notranslate"><span class="pre">django-celery-beat</span></code> have?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--47-input--1" name="tab-set--47" type="radio"><label class="tab-label" for="tab-set--47-input--1">中文</label><div class="tab-content docutils container">
<p>当使用数据库支持的调度器时，周期性任务的调度信息来自 <code class="docutils literal notranslate"><span class="pre">PeriodicTask</span></code> 模型，
此外还会涉及一些辅助表（如 <code class="docutils literal notranslate"><span class="pre">IntervalSchedule</span></code>、 <code class="docutils literal notranslate"><span class="pre">CrontabSchedule</span></code>、 <code class="docutils literal notranslate"><span class="pre">PeriodicTasks</span></code>）。</p>
</div>
<input class="tab-input" id="tab-set--47-input--2" name="tab-set--47" type="radio"><label class="tab-label" for="tab-set--47-input--2">英文</label><div class="tab-content docutils container">
<p>When the database-backed schedule is used the periodic task
schedule is taken from the <code class="docutils literal notranslate"><span class="pre">PeriodicTask</span></code> model, there are
also several other helper tables (<code class="docutils literal notranslate"><span class="pre">IntervalSchedule</span></code>,
<code class="docutils literal notranslate"><span class="pre">CrontabSchedule</span></code>, <code class="docutils literal notranslate"><span class="pre">PeriodicTasks</span></code>).</p>
</div>
</div>
</section>
<section id="django-celery-results">
<span id="faq-django-result-database-tables"></span><h3>“django-celery-results”创建的数据库表有什么用途？<a class="headerlink" href="#django-celery-results" title="Link to this heading">¶</a></h3>
<p>What purpose does the database tables created by <code class="docutils literal notranslate"><span class="pre">django-celery-results</span></code> have?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--48-input--1" name="tab-set--48" type="radio"><label class="tab-label" for="tab-set--48-input--1">中文</label><div class="tab-content docutils container">
<p>Django 的数据库结果后端扩展需要额外的两个模型：
<code class="docutils literal notranslate"><span class="pre">TaskResult</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GroupResult</span></code>。</p>
</div>
<input class="tab-input" id="tab-set--48-input--2" name="tab-set--48" type="radio"><label class="tab-label" for="tab-set--48-input--2">英文</label><div class="tab-content docutils container">
<p>The Django database result backend extension requires
two extra models: <code class="docutils literal notranslate"><span class="pre">TaskResult</span></code> and <code class="docutils literal notranslate"><span class="pre">GroupResult</span></code>.</p>
</div>
</div>
</section>
</section>
<section id="windows">
<span id="faq-windows"></span><h2>Windows<a class="headerlink" href="#windows" title="Link to this heading">¶</a></h2>
<section id="celery-windows">
<span id="faq-windows-worker-embedded-beat"></span><h3>Celery 支持 Windows 吗？<a class="headerlink" href="#celery-windows" title="Link to this heading">¶</a></h3>
<p>Does Celery support Windows?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--49-input--1" name="tab-set--49" type="radio"><label class="tab-label" for="tab-set--49-input--1">中文</label><div class="tab-content docutils container">
<p><strong>答复</strong>：不支持。</p>
<p>自 Celery 4.x 起，因资源限制已不再支持 Windows 平台。</p>
<p>不过它可能仍可工作，并且我们欢迎相关补丁提交。</p>
</div>
<input class="tab-input" id="tab-set--49-input--2" name="tab-set--49" type="radio"><label class="tab-label" for="tab-set--49-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Answer</strong>: No.</p>
<p>Since Celery 4.x, Windows is no longer supported due to lack of resources.</p>
<p>But it may still work and we are happy to accept patches.</p>
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="changelog.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">更改历史</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="tutorials/task-cookbook.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Task Cookbook</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="copyright.html">Copyright</a> &#169; 2009-2023, Ask Solem &amp; contributors
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">常见问题</a><ul>
<li><a class="reference internal" href="#faq-general">常见</a><ul>
<li><a class="reference internal" href="#what-kinds-of-things-should-i-use-celery-for">What kinds of things should I use Celery for?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-misconceptions">误解</a><ul>
<li><a class="reference internal" href="#celery-50-000">Celery 真的由 50,000 行代码组成吗？</a></li>
<li><a class="reference internal" href="#celery">Celery 依赖项多吗？</a><ul>
<li><a class="reference internal" href="#id4">celery</a></li>
<li><a class="reference internal" href="#kombu">kombu</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-heavyweight">Celery 是重量级的吗？</a></li>
<li><a class="reference internal" href="#celery-pickle">Celery 依赖于 pickle 吗？</a></li>
<li><a class="reference internal" href="#celery-django">Celery 只适用于 Django 吗？</a></li>
<li><a class="reference internal" href="#amqp-rabbitmq">我必须使用 AMQP/RabbitMQ 吗？</a></li>
<li><a class="reference internal" href="#faq-is-celery-multilingual">Celery 支持多种语言吗？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-troubleshooting">故障排除</a><ul>
<li><a class="reference internal" href="#mysql">MySQL 抛出死锁错误，我该怎么办？</a></li>
<li><a class="reference internal" href="#faq-worker-hanging">工作线程什么都没做，只是挂了</a></li>
<li><a class="reference internal" href="#faq-results-unreliable">任务结果无法可靠返回</a></li>
<li><a class="reference internal" href="#task-delay-apply">为什么 Task.delay/apply*/ 工作线程挂了？</a></li>
<li><a class="reference internal" href="#freebsd">它在 FreeBSD 上能正常工作吗？</a></li>
<li><a class="reference internal" href="#integrityerror-duplicate-key">我遇到了“IntegrityError: Duplicate Key”错误。为什么？</a></li>
<li><a class="reference internal" href="#faq-worker-stops-processing">为什么我的任务没有被处理？</a></li>
<li><a class="reference internal" href="#faq-task-does-not-run">为什么我的任务无法运行？</a></li>
<li><a class="reference internal" href="#faq-periodic-task-does-not-run">为什么我的周期性任务无法运行？</a></li>
<li><a class="reference internal" href="#faq-purge-the-queue">如何清除所有等待中的任务？</a></li>
<li><a class="reference internal" href="#faq-messages-left-after-purge">我已经清除了消息，但队列中仍然有消息？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-results">结果</a><ul>
<li><a class="reference internal" href="#faq-get-result-by-task-id">如果我有指向任务结果的 ID，该如何获取结果？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-security">安全性</a><ul>
<li><a class="reference internal" href="#pickle">使用 <cite>pickle</cite> 是否存在安全隐患？</a></li>
<li><a class="reference internal" href="#id19">消息可以加密吗？</a></li>
<li><a class="reference internal" href="#root-program-celery-worker">以 root 身份运行 <cite>:program:`celery worker</cite> 是否安全？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-brokers">代理</a><ul>
<li><a class="reference internal" href="#rabbitmq">为什么 RabbitMQ 会崩溃？</a></li>
<li><a class="reference internal" href="#celery-activemq-stomp">我可以将 Celery 与 ActiveMQ/STOMP 一起使用吗？</a></li>
<li><a class="reference internal" href="#amqp">不使用 AMQP 代理时，哪些功能不受支持？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-tasks">任务</a><ul>
<li><a class="reference internal" href="#faq-tasks-connection-reuse">如何在调用任务时重用相同的连接？</a></li>
<li><a class="reference internal" href="#subprocess-command-sudo-const-none"><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code> 中的 <cite>:command:`sudo</cite> 返回 <cite>:const:`None</cite></a></li>
<li><a class="reference internal" href="#faq-deletes-unknown-tasks">为什么工作进程无法处理队列中的任务时会将其删除？</a></li>
<li><a class="reference internal" href="#faq-execute-task-by-name">我可以通过名称调用任务吗？</a></li>
<li><a class="reference internal" href="#faq-get-current-task-id">我可以获取当前任务的任务 ID 吗？</a></li>
<li><a class="reference internal" href="#task-id">我可以指定自定义的 task_id 吗？</a></li>
<li><a class="reference internal" href="#id26">我可以对任务使用装饰器吗？</a></li>
<li><a class="reference internal" href="#faq-natural-task-ids">我可以使用自然的任务 ID 吗？</a></li>
<li><a class="reference internal" href="#faq-task-callbacks">我可以在某个任务完成后再运行另一个任务吗？</a></li>
<li><a class="reference internal" href="#faq-cancel-task">我可以取消正在执行的任务吗？</a></li>
<li><a class="reference internal" href="#faq-node-not-receiving-broadcast-commands">为什么我的远程控制命令没有被所有工作进程接收？</a></li>
<li><a class="reference internal" href="#faq-task-routing">我可以只将某些任务发送到某些服务器吗？</a></li>
<li><a class="reference internal" href="#faq-disable-prefetch">我可以禁用任务预取吗？</a></li>
<li><a class="reference internal" href="#faq-change-periodic-task-interval-at-runtime">我可以运行时更改周期性任务的执行间隔吗？</a></li>
<li><a class="reference internal" href="#faq-task-priorities">Celery 支持任务优先级吗？</a></li>
<li><a class="reference internal" href="#retry-acks-late">我应该使用 retry 还是 acks_late？</a></li>
<li><a class="reference internal" href="#faq-schedule-at-specific-time">我可以安排任务在特定时间执行吗？</a></li>
<li><a class="reference internal" href="#faq-safe-worker-shutdown">我可以安全地关闭工作进程吗？</a></li>
<li><a class="reference internal" href="#platform">我可以在 [platform] 上在后台运行工作进程吗？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django">Django</a><ul>
<li><a class="reference internal" href="#django-celery-beat">“django-celery-beat”创建的数据库表有什么用途？</a></li>
<li><a class="reference internal" href="#django-celery-results">“django-celery-results”创建的数据库表有什么用途？</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windows">Windows</a><ul>
<li><a class="reference internal" href="#celery-windows">Celery 支持 Windows 吗？</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=8156d91f"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/tabs.js?v=3ee01567"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=5eb1bb1e"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>